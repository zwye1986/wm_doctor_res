<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pinde.res.dao.eval.ext.EvalAppMapper">

	<select id="getExpertEvalOrg" parameterType="map" resultMap="com.pinde.sci.dao.base.SysOrgMapper.BaseResultMap">
        SELECT * FROM SYS_ORG ORG
        WHERE ORG.RECORD_STATUS='Y'
        AND (
            EXISTS (SELECT 1 FROM EXPERT_ORG EO
                   WHERE EO.RECORD_STATUS='Y'
                   AND EO.ORG_FLOW=ORG.ORG_FLOW
                   AND EO.EVAL_YEAR=#{evalYear}
            )
            OR
            EXISTS (SELECT 1 FROM EXPERT_ORG_SPE EO1
                   WHERE EO1.RECORD_STATUS='Y'
                   AND EO1.ORG_FLOW=ORG.ORG_FLOW
                   AND EO1.EVAL_YEAR=#{evalYear}
            )
        )
        AND (
            EXISTS (SELECT 1 FROM EXPERT_EVAL_ORG EO2
                   WHERE EO2.RECORD_STATUS='Y'
                   AND EO2.ORG_FLOW=ORG.ORG_FLOW
                   AND EO2.EXPERT_USER_FLOW=#{userFlow}
                   AND EO2.EVAL_YEAR=#{evalYear}
            )
            OR
            EXISTS (SELECT 1 FROM EXPERT_EVAL_ORG_SPE EO3
                   WHERE EO3.RECORD_STATUS='Y'
                   AND EO3.ORG_FLOW=ORG.ORG_FLOW
                   AND EO3.EXPERT_USER_FLOW=#{userFlow}
                   AND EO3.EVAL_YEAR=#{evalYear}
            )
        )
	</select>
	<select id="getExpertCfgChildrens" parameterType="map" resultMap="com.pinde.sci.dao.base.ExpertEvalCfgMapper.BaseResultMap">
        SELECT * FROM EXPERT_EVAL_CFG CFG
        WHERE CFG.RECORD_STATUS='Y'
        AND CFG.PARENT_CFG_FLOW=#{cfgFlow}
        AND (
            EXISTS (SELECT 1 FROM EXPERT_EVAL_ORG_CFG EO2
                   WHERE EO2.RECORD_STATUS='Y'
                   AND EO2.CFG_FLOW=CFG.CFG_FLOW
                   AND EO2.EXPERT_USER_FLOW=#{userFlow}
                   AND EO2.ORG_FLOW=#{orgFlow}
                   AND EO2.EVAL_YEAR=#{evalYear}
            )
            OR
            EXISTS (SELECT 1 FROM EXPERT_EVAL_ORG_SPE_CFG EO3
                   WHERE EO3.RECORD_STATUS='Y'
                   AND EO3.CFG_FLOW=CFG.CFG_FLOW
                   AND EO3.ORG_FLOW=#{orgFlow}
                   AND EO3.EXPERT_USER_FLOW=#{userFlow}
                   AND EO3.EVAL_YEAR=#{evalYear}
            )
        )
        ORDER by ordinal
	</select>
</mapper>