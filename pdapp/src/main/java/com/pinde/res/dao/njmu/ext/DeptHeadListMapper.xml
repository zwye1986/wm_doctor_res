<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pinde.res.dao.njmu.ext.DeptHeadListMapper">
	<resultMap id="deptHeadMap" type="hashmap">
		<result column="deptHeadFlow" property="deptHeadFlow" javaType="java.lang.String"/>
		<result column="deptHeadName" property="deptHeadName" javaType="java.lang.String"/>
		<result column="deptName" property="deptName" javaType="java.lang.String"/>
		<result column="deptHeadSex" property="deptHeadSex" javaType="java.lang.String"/>
	</resultMap>
	<select id="search" parameterType="string" resultMap="deptHeadMap">
		SELECT *
			FROM 
			( SELECT ROW_NUMBER() OVER (order by T.deptHeadFlow desc)AS Row, T.* from
			
				(
					select userinfo.userid as deptHeadFlow, truename as deptHeadName,hossecname as deptName,case sex when 1 then '男' else '女' end as deptHeadSex from  userinfo 
					inner join UserRole on UserRole.userid = userinfo.userid
					inner join hossection on hossection.hossecid = userinfo.szks
					where UserRole.roleid = 14  and userinfo.hosid = (select hosid from UserCycleSec where ucsid = ${deptFlow})
					and TrueName like '${deptHeadName}'
					union
					select userinfo.userid as deptHeadFlow, truename as deptHeadName,hossecname as deptName,case sex when 1 then '男' else '女' end as deptHeadSex  from  userinfo 
					inner join DirectorSection on DirectorSection.userid = userinfo.userid
					inner join hossection on hossection.hossecid = DirectorSection.secid
					where  userinfo.hosid = (select hosid from UserCycleSec where ucsid = ${deptFlow})
				 	and TrueName like '${deptHeadName}') as T
			
			) TT
			WHERE TT.Row between ${startRow} and ${endRow}
			ORDER BY deptHeadFlow
	</select>
</mapper>