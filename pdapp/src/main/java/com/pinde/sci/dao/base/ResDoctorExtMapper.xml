<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pinde.sci.dao.base.ResDoctorExtMapper" >
	<resultMap type="HashMap" id="signUserInfo">
		<result property="userName" column="user_name" javaType="string"/>
		<result property="signDate" column="sign_date" javaType="string"/>
		<result property="schDeptName" column="sch_dept_name" javaType="string"/>
		<result property="userHeadImg" column="user_head_img" javaType="string"/>
	</resultMap>
    <select id="searchSign" parameterType="java.util.Map" resultMap="signUserInfo">
    	select 
    	su.user_name user_name,
    	rs.sign_date sign_date,
    	rs.sch_dept_name sch_dept_name,
    	su.user_head_img
    	from res_signin rs
    	inner join sys_user su
    	on rs.user_flow = su.user_flow
    	where rs.record_status = 'Y'
    	and su.record_status = 'Y'
    	<if test='signDate!=null and signDate!=""'>
    		<bind name="signDate" value="signDate+'%'"/>
   			and rs.sign_date like #{signDate}
    	</if>
    	<if test='deptFlows!=null'>
    		and rs.dept_flow in
    		<foreach collection="deptFlows" open="(" separator="," close=")" item="deptFlow">
    			#{deptFlow}
    		</foreach>
    	</if>
    </select>
	<resultMap id="ResDoctorExt" type="com.pinde.core.model.ResDoctorExt" extends="com.pinde.sci.dao.base.ResDoctorMapper.BaseResultMap">
		<association property="sysUser" column="USER_FLOW" javaType="com.pinde.core.model.SysUser" resultMap="com.pinde.sci.dao.base.SysUserMapper.BaseResultMap"/>
	</resultMap>
	<select id="searchResDoctorUser" parameterType="com.pinde.core.model.ResDoctorExt" resultMap="ResDoctorExt">
		select * from res_doctor INNER JOIN  sys_user on  res_doctor.DOCTOR_FLOW = sys_user.USER_FLOW  AND sys_user.RECORD_STATUS = 'Y'
		<if test='sessionNumber != null and sessionNumber != ""'>
			AND res_doctor.SESSION_NUMBER = #{sessionNumber}
		</if>
		<if test='groupId != null and groupId != ""'>
			AND res_doctor.GROUP_ID = #{groupId}
		</if>
		<if test='trainingSpeId != null and trainingSpeId != ""'>
			AND res_doctor.TRAINING_SPE_ID = #{trainingSpeId}
		</if>
		<if test='doctorCategoryId != null and doctorCategoryId != ""'>
			AND res_doctor.DOCTOR_CATEGORY_ID = #{doctorCategoryId}
		</if>
		<if test='doctorTypeId != null and doctorTypeId != ""'>
			AND res_doctor.DOCTOR_TYPE_ID = #{doctorTypeId}
		</if>
		<if test='graduatedId != null and graduatedId != ""'>
			AND res_doctor.GRADUATED_ID = #{graduatedId}
		</if>
		<if test='recordStatus != null and recordStatus != ""'>
			AND res_doctor.RECORD_STATUS = #{recordStatus}
		</if>
		<if test="specialized != null and specialized != ''">
			AND RES_DOCTOR.SPECIALIZED LIKE CONCAT(CONCAT('%', #{specialized}),'%')
		</if>
		<if test="doctorCode != null and doctorCode != ''">
			AND RES_DOCTOR.doctor_code LIKE CONCAT(CONCAT('%', #{doctorCode}),'%')
		</if>
		<if test='doctorName != null and doctorName != ""'>
			AND RES_DOCTOR.doctor_name LIKE CONCAT(CONCAT('%', #{doctorName}),'%')
		</if>
		<if test='orgName != null and orgName != ""'>
			AND RES_DOCTOR.org_name like CONCAT(CONCAT('%', #{orgName}),'%')
		</if>
		<if test='orgFlow != null and orgFlow != ""'>
			AND RES_DOCTOR.org_flow = #{orgFlow}
		</if>

		<if test='sysUser != null'>
			<if test='sysUser.userName != null and sysUser.userName != ""'>
				AND sys_user.USER_NAME like CONCAT(CONCAT('%', #{sysUser.userName}),'%')
			</if>
			<if test='sysUser.statusId != null and sysUser.statusId  != ""'>
				AND sys_user.status_Id  = #{sysUser.statusId}
			</if>
			<if test='sysUser.recordStatus != null and sysUser.recordStatus  != ""'>
				AND sys_user.RECORD_STATUS=#{recordStatus}
			</if>
			<if test="sysUser.orgFlow != null and sysUser.orgFlow != ''">
				AND SYS_USER.ORG_FLOW = #{sysUser.orgFlow}
			</if>
			<if test="sysUser.educationId != null and sysUser.educationId != ''">
				AND SYS_USER.EDUCATION_ID = #{sysUser.educationId}
			</if>
			<if test="sysUser.idNo != null and sysUser.idNo != ''">
				AND SYS_USER.id_No = #{sysUser.idNo}
			</if>
			<if test="sysUser.deptFlow != null and sysUser.deptFlow != ''">
				AND SYS_USER.dept_Flow = #{sysUser.deptFlow}
			</if>
		</if>
		ORDER BY res_doctor.session_number desc, res_doctor.DOCTOR_CODE,res_doctor.CREATE_TIME
	</select>
</mapper>