<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pinde.sci.dao.jsres.MonthlyReportExtMapper">
    <select id="getParticipateInNum" resultType="java.lang.Integer" parameterType="java.util.HashMap">
      select count(DISTINCT d.DOCTOR_FLOW)
      from SYS_MONTHLY_DOC_CYCLE_INFO d
      where
      d.record_status='Y' and d.EXAM_NUM>0
      <if test='monthDate!=null and monthDate!=""'>
        and d.DATE_MONTH = #{monthDate}
      </if>
        <if test='doctorTypeId=="Graduate"'>
            and d.DOCTOR_TYPE_ID = 'Graduate'
        </if>
        <if test='doctorTypeId!="Graduate"'>
            and d.DOCTOR_TYPE_ID != 'Graduate'
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and d.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO sm
        where sm.record_status='Y' and sm.doctor_flow = d.doctor_flow and sm.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        <if test='sendSchoolFlag=="Y"'>
            and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
            where smd.doctor_flow = d.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId} or smd.WORK_ORG_NAME = #{sendSchoolName})
            )
        </if>
    </select>

    <select id="getTheoryAll" resultType="java.lang.Integer" parameterType="java.util.HashMap">
        select sum(EXAM_NUM) from (
        SELECT d.EXAM_NUM
        from SYS_MONTHLY_DOC_CYCLE_INFO d
        where
        d.record_status='Y' and d.EXAM_NUM>0
        <if test='monthDate!=null and monthDate!=""'>
            and d.DATE_MONTH = #{monthDate}
        </if>
        <if test='doctorTypeId=="Graduate"'>
            and d.DOCTOR_TYPE_ID = 'Graduate'
        </if>
        <if test='doctorTypeId!="Graduate"'>
            and d.DOCTOR_TYPE_ID != 'Graduate'
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and d.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO sm
        where sm.record_status='Y' and sm.doctor_flow = d.doctor_flow and sm.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        <if test='sendSchoolFlag=="Y"'>
            and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
            where smd.doctor_flow = d.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId} or smd.WORK_ORG_NAME = #{sendSchoolName})
            )
        </if>
        union all
        select 0 EXAM_NUM from SYS.DUAL)
    </select>

    <select id="getPassNum" resultType="java.lang.Integer" parameterType="java.util.HashMap">
        select count(0)
        from SYS_MONTHLY_DOC_CYCLE_INFO d
        where
        d.record_status='Y'
        and to_number((REGEXP_REPLACE(d.THEORY_SCORE,'-','0')))>=60 and to_number((REGEXP_REPLACE(d.SKILL_SCORE,'-','0')))>=60
        <if test='monthDate!=null and monthDate!=""'>
            and d.DATE_MONTH = #{monthDate}
        </if>
        <if test='doctorTypeId=="Graduate"'>
            and d.DOCTOR_TYPE_ID = 'Graduate'
        </if>
        <if test='doctorTypeId!="Graduate"'>
            and d.DOCTOR_TYPE_ID != 'Graduate'
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and d.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO sm
        where sm.record_status='Y' and sm.doctor_flow = d.doctor_flow and sm.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        <if test='sendSchoolFlag=="Y"'>
            and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
            where smd.doctor_flow = d.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId} or smd.WORK_ORG_NAME = #{sendSchoolName})
            )
        </if>
    </select>

    <select id="getNotPassNum" resultType="java.lang.Integer" parameterType="java.util.HashMap">
        select count(0)
        from SYS_MONTHLY_DOC_CYCLE_INFO d
        where
        d.record_status='Y'
        and (60>to_number((REGEXP_REPLACE(d.THEORY_SCORE,'-','0'))) or 60>to_number((REGEXP_REPLACE(d.SKILL_SCORE,'-','0'))))
        <if test='monthDate!=null and monthDate!=""'>
            and d.DATE_MONTH = #{monthDate}
        </if>
        <if test='doctorTypeId=="Graduate"'>
            and d.DOCTOR_TYPE_ID = 'Graduate'
        </if>
        <if test='doctorTypeId!="Graduate"'>
            and d.DOCTOR_TYPE_ID != 'Graduate'
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and d.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO sm
        where sm.record_status='Y' and sm.doctor_flow = d.doctor_flow and sm.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        <if test='sendSchoolFlag=="Y"'>
            and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
            where smd.doctor_flow = d.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId} or smd.WORK_ORG_NAME = #{sendSchoolName})
            )
        </if>
    </select>

    <select id="getActivitySum" resultType="java.lang.Integer" parameterType="java.util.HashMap">
        select nvl(sum(nvl(s.ACTIVTIY_NUM,0)),0)
        from SYS_MONTHLY_ACTIVITY_INFO s
        where
        s.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
    </select>

    <select id="getActivityMostDept" resultType="java.util.HashMap" parameterType="java.util.HashMap">
        select s.DEPT_FLOW,s.DEPT_NAME,sum(nvl(s.ACTIVTIY_NUM,0)) activitySum
        from SYS_MONTHLY_ACTIVITY_INFO s
        where
        s.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        group by s.DEPT_FLOW,s.DEPT_NAME
        ORDER by activitySum desc
    </select>

    <select id="getActivityLeastDept" resultType="java.util.HashMap" parameterType="java.util.HashMap">
        select s.DEPT_FLOW,s.DEPT_NAME,sum(nvl(s.ACTIVTIY_NUM,0)) activitySum
        from SYS_MONTHLY_ACTIVITY_INFO s
        where
        s.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        group by s.DEPT_FLOW,s.DEPT_NAME
        ORDER by activitySum
    </select>

    <select id="getActivityMostOrg" resultType="java.util.HashMap" parameterType="java.util.HashMap">
        select s.ORG_FLOW,s.ORG_NAME,sum(nvl(s.ACTIVTIY_NUM,0)) activitySum
        from SYS_MONTHLY_ACTIVITY_INFO s
        where
        s.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        group by s.ORG_FLOW,s.ORG_NAME
        ORDER by activitySum desc
    </select>

    <select id="getActivityLeastOrg" resultType="java.util.HashMap" parameterType="java.util.HashMap">
        select s.ORG_FLOW,s.ORG_NAME,sum(nvl(s.ACTIVTIY_NUM,0)) activitySum
        from SYS_MONTHLY_ACTIVITY_INFO s
        where
        s.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        group by s.ORG_FLOW,s.ORG_NAME
        ORDER by activitySum
    </select>

    <select id="getActivityByType" resultType="java.util.HashMap" parameterType="java.util.HashMap">
        select a.*
        from
        (
        select s.ACTIVITY_TYPE_ID,s.ACTIVITY_TYPE_NAME,sum(nvl(s.ACTIVTIY_NUM,0)) activitySum
        from SYS_MONTHLY_ACTIVITY_INFO s
        where
        s.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        group by s.ACTIVITY_TYPE_ID,s.ACTIVITY_TYPE_NAME
        ORDER by activitySum
        ) a
        where a.activitySum!=0
    </select>

    <select id="getSysMonthlyChangeInfo" resultMap="com.pinde.sci.dao.base.SysMonthlyChangeInfoMapper.BaseResultMap"
            parameterType="map">
        select s.* from
        Sys_Monthly_Change_Info s
        where record_status='Y'
        <if test="orgFlow!=null and orgFlow!=''">
            and (org_flow = #{orgFlow} or history_org_flow = #{orgFlow})
        </if>
        <if test='monthDate!=null and monthDate!=""'>
            and s.date_Month = #{monthDate}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s.session_Number = #{sessionNumber}
        </if>
        <if test='changeTypeId!=null and changeTypeId!=""'>
            and s.change_Type_Id = #{changeTypeId}
        </if>
        <if test='doctorTypeId!=null and doctorTypeId!=""'>
            <if test='doctorTypeId=="Graduate"'>and s.doctor_Type_Id = 'Graduate'</if>
            <if test='doctorTypeId!="Graduate"'>and s.doctor_Type_Id != 'Graduate'</if>
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO sm
        where sm.record_status='Y' and sm.doctor_flow = s.doctor_flow and sm.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        <if test='sendSchoolFlag=="Y"'>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
        where smd.doctor_flow = s.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId} or smd.WORK_ORG_NAME = #{sendSchoolName})
            )
        </if>
    </select>

    <select id="getSysMonthlyReturnDelayInfo" resultMap="com.pinde.sci.dao.base.SysMonthlyReturnDelayInfoMapper.BaseResultMap"
            parameterType="map">
        select s.* from
        Sys_Monthly_Return_Delay_Info s
        where record_status='Y'
        <if test="orgFlow!=null and orgFlow!=''">
            and org_flow = #{orgFlow}
        </if>
        <if test='monthDate!=null and monthDate!=""'>
            and s.date_Month = #{monthDate}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s.session_Number = #{sessionNumber}
        </if>
        <if test='typeId!=null and typeId!=""'>
            and s.type_Id = #{typeId}
        </if>
        <if test='doctorTypeId!=null and doctorTypeId!=""'>
            <if test='doctorTypeId=="Graduate"'>and s.doctor_Type_Id = 'Graduate'</if>
            <if test='doctorTypeId!="Graduate"'>and s.doctor_Type_Id != 'Graduate'</if>
        </if>
        and (s.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s.TRAINING_TYPE_ID = 'WMFirst')
        <if test='sendSchoolFlag=="Y"'>
            and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
            where smd.doctor_flow = s.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId} or smd.WORK_ORG_NAME = #{sendSchoolName})
            )
        </if>
    </select>

    <select id="getSysMonthlyDocCycleInfo" resultMap="com.pinde.sci.dao.base.SysMonthlyDocCycleInfoMapper.BaseResultMap"
            parameterType="map">
        select s.* from
        Sys_Monthly_Doc_Cycle_Info s
        where record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.date_Month = #{monthDate}
        </if>
        <if test='doctorTypeId!=null and doctorTypeId!=""'>
            <if test='doctorTypeId=="Graduate"'>and s.doctor_Type_Id = 'Graduate'</if>
            <if test='doctorTypeId!="Graduate"'>and s.doctor_Type_Id != 'Graduate'</if>
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO sm
        where sm.record_status='Y' and sm.doctor_flow = s.doctor_flow and sm.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        <if test='sendSchoolFlag=="Y"'>
            and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
            where smd.doctor_flow = s.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId} or smd.WORK_ORG_NAME = #{sendSchoolName})
            )
        </if>
    </select>

    <select id="findInNum" resultType="java.lang.Integer" parameterType="java.util.Map">
        SELECT count(1)
        FROM SYS_MONTHLY_DOC_CYCLE_INFO s
        where s.record_status='Y'
        AND SUBSTR(s.SCH_START_DATE,0,7) = #{monthDate,jdbcType=VARCHAR}
        AND s.DOCTOR_TYPE_ID='Graduate'
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
            where smd.doctor_flow = s.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId,jdbcType=VARCHAR} or smd.WORK_ORG_NAME = #{sendSchoolName,jdbcType=VARCHAR})
            )
    </select>
    <select id="findOutNum" resultType="java.lang.Integer" parameterType="java.util.Map">
        SELECT count(1)
        FROM SYS_MONTHLY_DOC_CYCLE_INFO s
        where s.record_status='Y'
        AND SUBSTR(s.SCH_END_DATE,0,7) = #{monthDate,jdbcType=VARCHAR}
        AND s.SCH_STATUS='isSch'
        AND s.DOCTOR_TYPE_ID='Graduate'
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
            where smd.doctor_flow = s.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId,jdbcType=VARCHAR} or smd.WORK_ORG_NAME = #{sendSchoolName,jdbcType=VARCHAR})
            )
    </select>
    <select id="findErrorOutNum" resultType="java.lang.Integer" parameterType="java.util.Map">
        SELECT count(1)
        FROM SYS_MONTHLY_DOC_CYCLE_INFO s
        where s.record_status='Y'
        AND SUBSTR(s.SCH_END_DATE,0,7) = #{monthDate,jdbcType=VARCHAR}
        AND s.SCH_STATUS='isCurrent'
        AND s.DOCTOR_TYPE_ID='Graduate'
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
            where smd.doctor_flow = s.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId,jdbcType=VARCHAR} or smd.WORK_ORG_NAME = #{sendSchoolName,jdbcType=VARCHAR})
            )
    </select>

    <select id="getNoAppNum" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT s.ORG_FLOW, s.ORG_NAME, count(0) num
        FROM SYS_MONTHLY_NOT_USEAPP_INFO s
        where s.record_status='Y'
        <if test='dateMonthList!=null and dateMonthList.size>0'>
            and s.DATE_MONTH in
            <foreach collection="dateMonthList" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='doctorTypeId!=null and doctorTypeId!=""'>
            <if test='doctorTypeId=="Graduate"'>and s.doctor_Type_Id = 'Graduate'</if>
            <if test='doctorTypeId!="Graduate"'>and s.doctor_Type_Id != 'Graduate'</if>
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO sm
        where sm.record_status='Y' and sm.doctor_flow = s.doctor_flow and sm.CHANGE_TYPE_ID = 'DoctorTrainingSpe'
        and sm.doctor_status_id='20')
        <if test='sendSchoolFlag=="Y"'>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
        where smd.doctor_flow = s.doctor_flow and
        (smd.WORK_ORG_ID = #{sendSchoolId} or smd.WORK_ORG_NAME = #{sendSchoolName})
        and smd.Doctor_Status_Id = '20'
        and smd.Change_Type_Id = 'DoctorTrainingSpe'
        )
        </if>
        GROUP BY s.ORG_FLOW, s.ORG_NAME
    </select>

    <select id="getAppData" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT s.ORG_FLOW, s.ORG_NAME,
        (select count(0) from SYS_MONTHLY_NOT_USEAPP_INFO s2
        where s2.doctor_type_id != 'Graduate' and s2.org_flow = s.org_flow and s2.RECORD_STATUS='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s2.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s2.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s2.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s2.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s2.session_Number = #{sessionNumber}
        </if>
        and (s2.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s2.TRAINING_TYPE_ID = 'WMFirst')
        AND s2.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
        ) A,
        (select count(0) from SYS_MONTHLY_NOT_USEAPP_INFO s2
        where s2.doctor_type_id = 'Graduate' and s2.org_flow = s.org_flow and s2.RECORD_STATUS='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s2.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s2.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s2.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s2.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s2.session_Number = #{sessionNumber}
        </if>
        and (s2.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s2.TRAINING_TYPE_ID = 'WMFirst')
        AND s2.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
        ) B,
        count(0) C
        FROM SYS_MONTHLY_NOT_USEAPP_INFO s
        where s.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and s.org_Flow = #{orgFlow}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s.session_Number = #{sessionNumber}
        </if>
        and (s.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s.TRAINING_TYPE_ID = 'WMFirst')
        AND s.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
        GROUP BY s.ORG_FLOW, s.ORG_NAME
    </select>
    <!--根据高校名称查找用户信息和培训基地信息yuh-->
    <select id="getUserInfoAndOrgNameByUniversity" parameterType="java.util.Map" resultMap="com.pinde.sci.dao.jsres.JsResDoctorRecruitExtMapper.DoctorRecruit">
SELECT
	dr.*, U .USER_FLOW,
	U .USER_CODE,
	U .USER_NAME,
	U .SEX_ID,
	U .SEX_NAME,
	U .USER_PHONE,
	U .USER_EMAIL,
	U .ID_NO,
	U .USER_BIRTHDAY,
	U .TITLE_ID,
	U .TITLE_NAME,
	U .DEGREE_ID,
	U .DEGREE_NAME,
	U .EDUCATION_ID,
	U .EDUCATION_NAME,
	U .POST_ID,
	U .POST_NAME,
	ed.ORG_FLOW AS edOrgFlow,
	ed.ORG_Name AS edOrgName,
	ed.doctor_type_name,
	ed.doctor_type_id,
    (select bb.org_code from PDSCI.SYS_ORG bb where dr.org_flow=bb.org_flow) org_code
FROM
	pdsci.RES_DOCTOR_RECRUIT dr
LEFT JOIN pdsci.SYS_USER U ON dr.DOCTOR_FLOW = U .USER_FLOW
LEFT JOIN RES_DOCTOR ed ON dr.DOCTOR_FLOW = ed.DOCTOR_FLOW
WHERE
	dr.RECORD_STATUS = 'Y'
AND U .RECORD_STATUS = 'Y'
AND dr.org_flow IN (
	SELECT
		ORG_FLOW
	FROM
		PDSCI.SYS_ORG
	WHERE
		PDSCI.SYS_ORG.RECORD_STATUS = 'Y'
	AND dr.AUDIT_STATUS_ID != 'NotSubmit'
   AND ORG_PROV_ID ='320000'
	AND ed.DOCTOR_TYPE_ID IN ('Graduate', 'Graduate')
	AND dr.TRAIN_YEAR IN (
		'OneYear',
		'TwoYear',
		'ThreeYear'
	)
)
AND dr.AUDIT_STATUS_ID = 'Passed'
AND dr.CAT_SPE_ID = 'DoctorTrainingSpe'
AND dr.doctor_Status_Id = '20'
        <if test="universityName!=null and universityName!=''">
          AND  ed.work_org_name LIKE CONCAT(CONCAT('%', #{universityName}),'%')
        </if>
ORDER BY
	dr.session_number DESC,
	dr.org_flow,
	dr.spe_id,
	NLSSORT (
		U .USER_NAME,
		'NLS_SORT = SCHINESE_PINYIN_M'
	),
	dr.doctor_flow,
	dr.CREATE_TIME DESC
    </select>
    <!--（学员出科情况）查询学员的培训数据完成个数和总数yuh-->
    <select id="findOutOfficeFinishSumAndTotalSum" resultMap="com.pinde.sci.dao.res.ResDoctorSchProcessExtMapper.workListMap" >
        SELECT A.DOCTOR_FLOW,
        A.RECRUIT_FLOW,
        A.ORG_NAME,
        A.ORG_FLOW,
        A.USER_NAME,
        A.TRAINING_SPE_ID,
        A.TRAINING_SPE_NAME,
        A.SESSION_NUMBER,
        A.REQ_NUM,
        A.COMPLETE_NUM,
        A.AUDIT_NUM,
        A.ROTATION_NUM,
        A.YLZ_NUM,
        A.SCH_NUM,
        A.AFTER_NUM,
        A.COMPLETE_BI,
        A.AUDIT_BI
        FROM (SELECT rd.DOCTOR_FLOW,
        DR.RECRUIT_FLOW,
        DR.ORG_NAME,
        DR.ORG_FLOW,
        SU.USER_NAME,
        DR.SPE_ID TRAINING_SPE_ID,
        DR.SPE_NAME TRAINING_SPE_NAME,
        DR.SESSION_NUMBER,
        NVL(JDW.REQ_NUM,0) REQ_NUM,
        NVL(JDW.COMPLETE_NUM, 0) COMPLETE_NUM,
        NVL(JDW.AUDIT_NUM, 0) AUDIT_NUM,
        NVL(JDW.YLZ_NUM, 0) YLZ_NUM,
        NVL(JDW.SCH_NUM, 0) SCH_NUM,
        NVL(JDW.AFTER_NUM, 0) AFTER_NUM,
        to_number(NVL(JDW.COMPLETE_BI,0)) COMPLETE_BI,
        to_number(NVL(JDW.AUDIT_BI,0)) AUDIT_BI,
        NVL(JDW.rotation_Num,0) rotation_Num
        FROM RES_DOCTOR_RECRUIT dr
        LEFT JOIN RES_DOCTOR RD
        ON DR.DOCTOR_FLOW = RD.DOCTOR_FLOW
        INNER JOIN SYS_USER SU
        ON RD.DOCTOR_FLOW = SU.USER_FLOW
        LEFT JOIN JSRES_DOCTOR_WORK JDW
        ON RD.DOCTOR_FLOW =JDW.DOCTOR_FLOW
        and dr.org_flow=jdw.org_flow
        AND DR.RECRUIT_FLOW =JDW.RECRUIT_FLOW
        WHERE  RD.RECORD_STATUS = 'Y'
        AND DR.RECORD_STATUS='Y'
        AND SU.RECORD_STATUS = 'Y'
        AND dr.AUDIT_STATUS_ID = 'Passed'
        <if test="docTypeList!=null">
            and rd.DOCTOR_TYPE_ID in
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        <choose >
            <when test='baseFlag != null and baseFlag != "" '>
                AND RD.SECOND_ORG_FLOW =#{userOrgFlow}
            </when>
            <otherwise>
                AND DR.ORG_FLOW IN
                ( SELECT ORG_FLOW FROM SYS_ORG ORG
                WHERE ORG.RECORD_STATUS = 'Y'
                AND ORG.ORG_PROV_ID = '320000'
                AND ORG.ORG_TYPE_ID = 'Hospital'
                <if test='	jointOrgFlag == null or jointOrgFlag == ""'>
                    <if test='orgLevel != null and orgLevel != ""'>
                        AND ORG.ORG_LEVEL_ID = #{orgLevel}
                    </if>
                    <if test='orgFlow != null and orgFlow!=""'>
                        AND	ORG.ORG_FLOW =#{orgFlow,jdbcType=VARCHAR}
                    </if>
                </if>
                )
            </otherwise>
        </choose>

        <if test="roleFlag =='Uni'">
            and (
            <trim prefix="" prefixOverrides="OR">
                <if test="workOrgId != null and workOrgId != ''">OR rd.work_org_id = #{workOrgId}</if>
                <if test="workOrgName != null and workOrgName != ''">OR rd.work_org_name = #{workOrgName}</if>
            </trim>
            )
        </if>
        <if test="doctorFlowList!=null">
            AND rd.DOCTOR_FLOW in
            <foreach collection="doctorFlowList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        AND rd.TRAINING_TYPE_ID ='DoctorTrainingSpe'
        ) A
    </select>
    <!--(学员出科情况)查询住院医生所有学员出科信息yuh-->
    <select id="findOutOfficeDoctorInfo" parameterType="java.util.Map" resultMap="com.pinde.sci.dao.sch.SchArrangeResultExtMapper.docResultsMap">
        SELECT
        U .USER_NAME AS user_name,
        dr.TRAINING_TYPE_NAME AS training_Type_name,
        dr.TRAINING_SPE_NAME AS training_spe_name,
        dr.SESSION_NUMBER AS session_number,
        dr.DOCTOR_Flow AS doctor_flow,
        rdr.graduation_year AS graduation_year,
        dr.org_name AS org_name
        FROM
        RES_DOCTOR dr
        INNER JOIN SYS_USER U ON dr.DOCTOR_FLOW = U .USER_FLOW
        LEFT JOIN RES_DOCTOR_RECRUIT rdr ON dr.DOCTOR_FLOW = rdr.DOCTOR_FLOW and  rdr.AUDIT_STATUS_ID = 'Passed' AND rdr.RECORD_STATUS = 'Y'
        WHERE
        dr.RECORD_STATUS = 'Y'
        AND U .RECORD_STATUS = 'Y'
        AND rdr.record_status = 'Y'
        AND dr.TRAINING_TYPE_ID = 'DoctorTrainingSpe'

        <if test="docTypeList!=null">
            and dr.DOCTOR_TYPE_ID in
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        <if test="orgFlow!=null and orgFlow!=''">
            AND rdr.ORG_FLOW =#{orgFlow}
        </if>
        ORDER BY
            dr.SESSION_NUMBER DESC,
            dr.TRAINING_Type_ID,
            dr.TRAINING_SPE_ID,
            U .user_flow
    </select>

    <!--（教学活动统计）根据基地获取在培学员总数yuh-->
    <select id="getTrainerSum" resultType="java.lang.Integer" parameterType="java.util.Map">
		SELECT count(1) <!-- dr.*, u.USER_FLOW, u.USER_CODE, u.USER_NAME, u.SEX_ID
			, u.SEX_NAME, u.USER_PHONE, u.USER_EMAIL, u.ID_NO, u.USER_BIRTHDAY
			, u.TITLE_ID, u.TITLE_NAME, u.DEGREE_ID, u.DEGREE_NAME, u.EDUCATION_ID
			, u.EDUCATION_NAME, u.POST_ID, u.POST_NAME, ed.ORG_FLOW AS edOrgFlow, ed.ORG_Name AS edOrgName
			, ed.doctor_type_name, ed.doctor_type_id -->
		FROM pdsci.RES_DOCTOR_RECRUIT dr
		LEFT JOIN pdsci.SYS_USER u ON dr.DOCTOR_FLOW = u.USER_FLOW
			LEFT JOIN RES_DOCTOR ed ON dr.DOCTOR_FLOW = ed.DOCTOR_FLOW
		WHERE dr.RECORD_STATUS = 'Y'
			AND u.RECORD_STATUS = 'Y'
			AND dr.org_flow IN (SELECT ORG_FLOW
				FROM PDSCI.SYS_ORG
				WHERE PDSCI.SYS_ORG.RECORD_STATUS = 'Y'
					AND dr.AUDIT_STATUS_ID != 'NotSubmit'
        <if test='orgFlow!=null and orgFlow!=""'>
			   AND dr.ORG_FLOW =#{orgFlow}
        </if>
            AND ed.DOCTOR_TYPE_ID IN ('Company', 'CompanyEntrust', 'Social', 'Graduate', 'Company', 'CompanyEntrust', 'Social', 'Graduate')
            AND dr.TRAIN_YEAR IN ('OneYear', 'TwoYear', 'ThreeYear'))
			AND dr.AUDIT_STATUS_ID = 'Passed'
			AND dr.CAT_SPE_ID = 'DoctorTrainingSpe'
			AND dr.doctor_Status_Id = '20'
        <if test='universityDoctorFlows!=null '>
            and dr.DOCTOR_FLOW in
            <trim suffixOverrides=" OR dr.DOCTOR_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR dr.DOCTOR_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
            <!--<foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
        </if>
		ORDER BY dr.session_number DESC, dr.org_flow, dr.spe_id, NLSSORT(u.USER_NAME, 'NLS_SORT = SCHINESE_PINYIN_M'), dr.doctor_flow, dr.CREATE_TIME DESC

    </select>
    <!--（教学活动统计）根据基地获取教学活动信息yuh-->
    <select id="findActivityListyuh" resultMap="com.pinde.sci.dao.jsres.TeachingActivityInfoExtMapper.activityMap" parameterType="java.util.Map">
        SELECT INFO.*, SU.USER_NAME, D.DEPT_NAME, RESULT.EVAL_SCORE, F.FILE_NAME
,
 NVL (RESULT.SCAN_NUM, 0) AS SCAN_NUM,
 RESULT2.REGIEST_NUM
		FROM TEACHING_ACTIVITY_INFO INFO
		LEFT JOIN SYS_USER SU ON INFO.SPEAKER_FLOW = SU.USER_FLOW
		LEFT JOIN SYS_DEPT D ON D.DEPT_FLOW = INFO.DEPT_FLOW
		LEFT JOIN (
			SELECT ACTIVITY_FLOW, To_char(ROUND(SUM(EVAL_SCORE) / COUNT(EVAL_SCORE))) AS EVAL_SCORE, COUNT(1) AS SCAN_NUM
			FROM TEACHING_ACTIVITY_RESULT T
			WHERE T.RECORD_STATUS = 'Y'
				AND T.IS_SCAN = 'Y'
				AND T.IS_SCAN2 = 'Y'
        <if test='universityDoctorFlows!=null '>
            and T.USER_FLOW in
            <trim suffixOverrides=" OR T.USER_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR T.USER_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
            <!--<foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
        </if>
			GROUP BY ACTIVITY_FLOW
		) RESULT ON RESULT.ACTIVITY_FLOW = INFO.ACTIVITY_FLOW
		LEFT JOIN (
			SELECT ACTIVITY_FLOW, COUNT(1) AS REGIEST_NUM
			FROM TEACHING_ACTIVITY_RESULT T
			WHERE T.RECORD_STATUS = 'Y'
				AND T.IS_REGIEST = 'Y'
        <if test='universityDoctorFlows!=null '>
            and T.USER_FLOW in
            <trim suffixOverrides=" OR T.USER_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR T.USER_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
            <!--<foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
        </if>
			GROUP BY ACTIVITY_FLOW
		) RESULT2 ON RESULT2.ACTIVITY_FLOW = INFO.ACTIVITY_FLOW
			LEFT JOIN PUB_FILE F ON INFO.FILE_FLOW = F.FILE_FLOW
		AND F.RECORD_STATUS = 'Y'
		WHERE INFO.RECORD_STATUS = 'Y'
			AND SU.RECORD_STATUS = 'Y'
			AND D.RECORD_STATUS = 'Y'
        <if test='orgFlow!=null and orgFlow!=""'>
			 AND INFO.ORG_FLOW = #{orgFlow}
        </if>
				AND INFO.DEPT_FLOW IN (SELECT DEPT_FLOW
					FROM SYS_DEPT
					WHERE 1=1
        <if test='orgFlow!=null and orgFlow!=""'>
					AND	ORG_FLOW = #{orgFlow}
        </if>
						AND RECORD_STATUS = 'Y')
		AND activity_status = 'pass'<!--审核通过-->
        AND INFO.IS_EFFECTIVE='Y' <!--管理员认可-->
        and result.SCAN_NUM>0  <!--有效的-->
		ORDER BY START_TIME DESC, END_TIME DESC, RESULT.EVAL_SCORE DESC
    </select>
    <select id="getScanTime1AndScanTime2" parameterType="java.lang.String" resultMap="com.pinde.sci.dao.base.TeachingActivityResultMapper.BaseResultMap" >
        select *
        from TEACHING_ACTIVITY_RESULT
        WHERE ACTIVITY_FLOW=#{activityFlow}
        AND IS_SCAN='Y' AND IS_SCAN2='Y'
    </select>
    <select id="getScanTime1AndScanTime2LeftjoinUserFlow" parameterType="java.util.Map" resultMap="com.pinde.sci.dao.base.TeachingActivityResultMapper.BaseResultMap" >
        select RES.*
        from TEACHING_ACTIVITY_RESULT res
        LEFT JOIN RES_DOCTOR_RECRUIT a ON res.user_flow=a.doctor_flow

        LEFT JOIN RES_DOCTOR b ON a.DOCTOR_FLOW=b.DOCTOR_FLOW

        WHERE
         a.RECORD_STATUS='Y' AND b.RECORD_STATUS='Y'
        <if test="orgFlow!=null and  orgFlow!=''">
            AND ( a.ORG_FLOW=#{orgFlow} OR b.ORG_FLOW=#{orgFlow} )
        </if>
       <!-- <if test="userFlow!=null and  userFlow!=''">
            AND ( a.DOCTOR_FLOW=#{userFlow} OR b.DOCTOR_FLOW=#{userFlow})
        </if>-->
        <if test="speId!=null and  speId!=''">
            AND a.SPE_id=#{speId}
        </if>
        <if test="sessionNumber!=null and  sessionNumber!=''">
            AND a.SESSION_NUMBER=#{sessionNumber}
        </if>
        <if test="docTypeList!=null ">
            AND b.DOCTOR_TYPE_ID in
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        AND  res.ACTIVITY_FLOW=#{activityFlow}
        AND res.IS_SCAN='Y' AND res.IS_SCAN2='Y'
    </select>
    <!--获取notuseapp在培人数之和、住院医生人数、在职专硕人数-->
    <select id="getAppDatayuh" resultType="com.pinde.core.model.SysOrg" parameterType="java.util.Map">
        SELECT s.ORG_FLOW as orgflow, s.ORG_NAME as orgName,
        (select count(0) from SYS_MONTHLY_NOT_USEAPP_INFO s2
        where s2.doctor_type_id != 'Graduate' and s2.org_flow = s.org_flow and s2.RECORD_STATUS='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s2.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s2.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        <if test='universityDoctorFlows!=null '>
            and s2.DOCTOR_FLOW in
            <trim suffixOverrides=" OR s2.DOCTOR_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR s2.DOCTOR_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
            <!--<foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and s2.ORG_FLOW = #{orgFlow}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s2.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s2.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s2.session_Number = #{sessionNumber}
        </if>
        and (s2.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s2.TRAINING_TYPE_ID = 'WMFirst')
        AND s2.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
        ) doctorSum,
        (select count(0) from SYS_MONTHLY_NOT_USEAPP_INFO s2
        where s2.doctor_type_id = 'Graduate' and s2.org_flow = s.org_flow and s2.RECORD_STATUS='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s2.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s2.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        <if test='universityDoctorFlows!=null '>
            and s2.DOCTOR_FLOW in
            <trim suffixOverrides=" OR s2.DOCTOR_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR s2.DOCTOR_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
           <!-- <foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and s2.ORG_FLOW = #{orgFlow}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s2.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s2.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s2.session_Number = #{sessionNumber}
        </if>
        and (s2.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s2.TRAINING_TYPE_ID = 'WMFirst')
        AND s2.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
        ) masterSum,
        count(0) trainDoctorTotal
        FROM SYS_MONTHLY_NOT_USEAPP_INFO s
        where s.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        <if test='universityDoctorFlows!=null '>
            and s.DOCTOR_FLOW in
            <trim suffixOverrides=" OR s.DOCTOR_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR s.DOCTOR_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
            <!--<foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and s.org_Flow = #{orgFlow}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s.session_Number = #{sessionNumber}
        </if>
        and (s.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s.TRAINING_TYPE_ID = 'WMFirst')
        AND s.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
        GROUP BY s.ORG_FLOW, s.ORG_NAME
    </select>


    <!--（使用率）在培的总人数-->
    <select id="getTrainTotal" parameterType="java.util.Map" resultType="java.lang.Integer">
        select count(1)
        from RES_DOCTOR a
        LEFT JOIN  RES_DOCTOR_RECRUIT b ON a.DOCTOR_FLOW=b.DOCTOR_FLOW
        WHERE a.RECORD_STATUS='Y'
        AND a.DOCTOR_STATUS_ID='20'

        AND b.RECORD_STATUS='Y'
        AND  b.AUDIT_STATUS_ID = 'Passed'
        AND b.CAT_SPE_ID = 'DoctorTrainingSpe'
        AND b.doctor_Status_Id = '20'
        <if test='orgFlow!=null and orgFlow!=""'>
            and a.ORG_FLOW = #{orgFlow}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and a.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        <if test='universityDoctorFlows!=null '>
            and a.DOCTOR_FLOW in
            <trim suffixOverrides=" OR a.DOCTOR_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR a.DOCTOR_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
            <!--<foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
        </if>
    </select>

    <select id="getAppDataDetail" resultMap="com.pinde.sci.dao.base.SysMonthlyNotUseappInfoMapper.BaseResultMap" parameterType="java.util.Map">
        SELECT *
        FROM SYS_MONTHLY_NOT_USEAPP_INFO s
        where s.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and s.org_Flow = #{orgFlow}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s.session_Number = #{sessionNumber}
        </if>
        and (s.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s.TRAINING_TYPE_ID = 'WMFirst')
        AND s.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
    </select>

    <select id="getAppData3" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT s.ORG_FLOW, s.ORG_NAME,
        (select count(0) from (select a.* from (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth1} ) a
        left join (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth2} ) b
        on a.doctor_FLOW=b.doctor_FLOW
        left join (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth3} ) c
        on b.doctor_FLOW=c.doctor_FLOW
        where a.record_status='Y'
        and b.record_status='Y'
        and c.record_status='Y' ) s2
        where s2.doctor_type_id != 'Graduate' and s2.org_flow = s.org_flow
        <if test='monthDate!=null and monthDate!=""'>
            and s2.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s2.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and s2.org_Flow = #{orgFlow}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s2.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s2.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s2.session_Number = #{sessionNumber}
        </if>
        and (s2.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s2.TRAINING_TYPE_ID = 'WMFirst')
        AND s2.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
        ) A,
        (select count(0) from (select a.* from (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth1} ) a
        left join (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth2} ) b
        on a.doctor_FLOW=b.doctor_FLOW
        left join (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth3} ) c
        on b.doctor_FLOW=c.doctor_FLOW
        where a.record_status='Y'
        and b.record_status='Y'
        and c.record_status='Y' ) s2
        where s2.doctor_type_id = 'Graduate' and s2.org_flow = s.org_flow
        <if test='monthDate!=null and monthDate!=""'>
            and s2.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s2.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s2.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s2.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s2.session_Number = #{sessionNumber}
        </if>
        and (s2.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s2.TRAINING_TYPE_ID = 'WMFirst')
        AND s2.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
        ) B,
        count(0) C
        FROM (select a.* from (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth1} ) a
        left join (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth2} ) b
        on a.doctor_FLOW=b.doctor_FLOW
        left join (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth3} ) c
        on b.doctor_FLOW=c.doctor_FLOW
        where a.record_status='Y'
        and b.record_status='Y'
        and c.record_status='Y' ) s
        where 1=1
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and s.org_Flow = #{orgFlow}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s.session_Number = #{sessionNumber}
        </if>
        and (s.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s.TRAINING_TYPE_ID = 'WMFirst')
        AND s.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
        GROUP BY s.ORG_FLOW, s.ORG_NAME
    </select>

    <select id="getAppData3Detail" resultMap="com.pinde.sci.dao.base.SysMonthlyNotUseappInfoMapper.BaseResultMap" parameterType="java.util.Map">
        SELECT s.*
        FROM (select a.* from (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth1} ) a
        left join (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth2} ) b
        on a.doctor_FLOW=b.doctor_FLOW
        left join (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH = #{dateMonth3} ) c
        on b.doctor_FLOW=c.doctor_FLOW
        where a.record_status='Y'
        and b.record_status='Y'
        and c.record_status='Y' ) s
        where s.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and s.DATE_MONTH = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and s.org_Flow = #{orgFlow}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s.training_Type_Id = #{trainingTypeId}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s.training_Spe_Id = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s.session_Number = #{sessionNumber}
        </if>
        and (s.TRAINING_TYPE_ID = 'DoctorTrainingSpe' or s.TRAINING_TYPE_ID = 'WMFirst')
        AND s.DOCTOR_FLOW NOT IN (SELECT DOCTOR_FLOW
        FROM RES_DOCOTR_DELAY_TETURN
        WHERE RECORD_STATUS = 'Y'
        AND TYPE_ID IN ('Delay', 'ReturnTraining'))
    </select>

    <select id="getNoAppNum3" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT s.ORG_FLOW, s.ORG_NAME, count(0) num
        FROM (select a.* from (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH IN #{dateMonth1} ) a
        left join (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH IN #{dateMonth2} ) b
        on a.doctor_FLOW=b.doctor_FLOW
        left join (
        select * from SYS_MONTHLY_NOT_USEAPP_INFO smn where smn.DATE_MONTH IN #{dateMonth3} ) c
        on b.doctor_FLOW=c.doctor_FLOW
        where a.DATE_MONTH = #{dateMonth1}
        and b.DATE_MONTH = #{dateMonth2}
        and c.DATE_MONTH = #{dateMonth3}) s
        where s.record_status='Y'
        <if test='doctorTypeId!=null and doctorTypeId!=""'>
            <if test='doctorTypeId=="Graduate"'>and s.doctor_Type_Id = 'Graduate'</if>
            <if test='doctorTypeId!="Graduate"'>and s.doctor_Type_Id != 'Graduate'</if>
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and s.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO sm
        where sm.record_status='Y' and sm.doctor_flow = s.doctor_flow and sm.CHANGE_TYPE_ID = 'DoctorTrainingSpe'
        and sm.doctor_status_id='20')
        <if test='sendSchoolFlag=="Y"'>
            and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
            where smd.doctor_flow = s.doctor_flow and
            (smd.WORK_ORG_ID = #{sendSchoolId} or smd.WORK_ORG_NAME = #{sendSchoolName})
            and smd.Doctor_Status_Id = '20'
            and smd.Change_Type_Id = 'DoctorTrainingSpe'
            )
        </if>
        GROUP BY s.ORG_FLOW, s.ORG_NAME
    </select>

    <select id="getUserList" resultMap="com.pinde.core.common.sci.dao.SysUserMapper.BaseResultMap" parameterType="map">
        SELECT su.* from
        sys_user su
        where su.record_status = 'Y'
        and EXISTS (select null from Sys_Monthly_Doctor_Info smdi
        where smdi.DOCTOR_FLOW = su.user_flow
        and smdi.Doctor_Status_Id = '20'
        and smdi.Change_Type_Id = 'DoctorTrainingSpe'
        <if test='monthDate!=null and monthDate!=""'>
          and smdi.date_month = #{monthDate}
        </if>
        <if test='doctorTypeId!=null and doctorTypeId!=""'>
            <if test='doctorTypeId=="Graduate"'>and smdi.doctor_Type_Id = 'Graduate'</if>
            <if test='doctorTypeId!="Graduate"'>and smdi.doctor_Type_Id != 'Graduate'</if>
        </if>
        )
    </select>

    <select id="getDoctorList" resultMap="com.pinde.sci.dao.base.ResDoctorMapper.BaseResultMap" parameterType="map">
        SELECT rd.* from
        res_doctor rd
        where rd.record_status = 'Y'
        and EXISTS (select null from Sys_Monthly_Doctor_Info smdi
        where smdi.DOCTOR_FLOW = rd.DOCTOR_FLOW
        and smdi.Doctor_Status_Id = '20'
        and smdi.Change_Type_Id = 'DoctorTrainingSpe'
        <if test='monthDate!=null and monthDate!=""'>
            and smdi.date_month = #{monthDate}
        </if>
        <if test='doctorTypeId!=null and doctorTypeId!=""'>
            <if test='doctorTypeId=="Graduate"'>and smdi.doctor_Type_Id = 'Graduate'</if>
            <if test='doctorTypeId!="Graduate"'>and smdi.doctor_Type_Id != 'Graduate'</if>
        </if>
        )
    </select>

    <select id="getRecruitList" resultMap="com.pinde.sci.dao.base.ResDoctorRecruitMapper.BaseResultMap" parameterType="map">
        SELECT rdr.* from
        res_doctor_recruit rdr
        where rdr.record_status = 'Y'
        and EXISTS (select null from Sys_Monthly_Doctor_Info smdi
        where smdi.RECRUIT_FLOW = rdr.RECRUIT_FLOW
        and smdi.Doctor_Status_Id = '20'
        and smdi.Change_Type_Id = 'DoctorTrainingSpe'
        <if test='monthDate!=null and monthDate!=""'>
            and smdi.date_month = #{monthDate}
        </if>
        <if test='doctorTypeId!=null and doctorTypeId!=""'>
            <if test='doctorTypeId=="Graduate"'>and smdi.doctor_Type_Id = 'Graduate'</if>
            <if test='doctorTypeId!="Graduate"'>and smdi.doctor_Type_Id != 'Graduate'</if>
        </if>
        )
    </select>

    <select id="getHospitalChart5Detail" resultType="java.util.Map" parameterType="java.util.Map">
        select sm.ORG_FLOW,sm.org_name,sm.sch_dept_flow,sm.sch_dept_name,
        (select count(0) from SYS_MONTHLY_DOC_CYCLE_INFO s where s.org_flow=sm.org_flow and s.sch_dept_flow = sm.sch_dept_flow
        <if test='doctorTypeIdList != null and doctorTypeIdList.size()>0'>
            and s.doctor_Type_Id in
            <foreach collection="doctorTypeIdList" item="doctorTypeId" open="(" separator="," close=")">
                #{doctorTypeId}
            </foreach>
        </if>
        <if test='monthDate!=null and monthDate!=""'>
            and s.date_month = #{monthDate}
            AND SUBSTR(s.SCH_START_DATE,0,7) = #{monthDate}
        </if>
        <if test='schDeptFlow!=null and schDeptFlow!=""'>
            and s.sch_Dept_Flow = #{schDeptFlow}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s.session_Number = #{sessionNumber}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s.TRAINING_SPE_ID = #{trainingSpeId}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s.TRAINING_Type_ID = #{trainingTypeId}
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
        where smd.record_status='Y' and smd.doctor_flow = s.doctor_flow and smd.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        ) inNUm,
        (select count(0) from SYS_MONTHLY_DOC_CYCLE_INFO s where s.org_flow=sm.org_flow and s.sch_dept_flow = sm.sch_dept_flow
        and s.SCH_STATUS='isSch'
        <if test='doctorTypeIdList != null and doctorTypeIdList.size()>0'>
            and s.doctor_Type_Id in
            <foreach collection="doctorTypeIdList" item="doctorTypeId" open="(" separator="," close=")">
                #{doctorTypeId}
            </foreach>
        </if>
        <if test='monthDate!=null and monthDate!=""'>
            and s.date_month = #{monthDate}
            AND SUBSTR(s.SCH_END_DATE,0,7) = #{monthDate}
        </if>
        <if test='schDeptFlow!=null and schDeptFlow!=""'>
            and s.sch_Dept_Flow = #{schDeptFlow}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s.session_Number = #{sessionNumber}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s.TRAINING_SPE_ID = #{trainingSpeId}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s.TRAINING_Type_ID = #{trainingTypeId}
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
        where smd.record_status='Y' and smd.doctor_flow = s.doctor_flow and smd.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        ) outNUm,
        (select count(0) from SYS_MONTHLY_DOC_CYCLE_INFO s where s.org_flow=sm.org_flow and s.sch_dept_flow = sm.sch_dept_flow
        and s.SCH_STATUS='isCurrent'
        <if test='doctorTypeIdList != null and doctorTypeIdList.size()>0'>
            and s.doctor_Type_Id in
            <foreach collection="doctorTypeIdList" item="doctorTypeId" open="(" separator="," close=")">
                #{doctorTypeId}
            </foreach>
        </if>
        <if test='monthDate!=null and monthDate!=""'>
            and s.date_month = #{monthDate}
            AND SUBSTR(s.SCH_END_DATE,0,7) = #{monthDate}
        </if>
        <if test='schDeptFlow!=null and schDeptFlow!=""'>
            and s.sch_Dept_Flow = #{schDeptFlow}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and s.session_Number = #{sessionNumber}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and s.TRAINING_SPE_ID = #{trainingSpeId}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and s.TRAINING_Type_ID = #{trainingTypeId}
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
        where smd.record_status='Y' and smd.doctor_flow = s.doctor_flow and smd.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        ) errorNUm
        from SYS_MONTHLY_DOC_CYCLE_INFO sm
        where
        sm.record_status='Y'
        <if test='doctorTypeIdList != null and doctorTypeIdList.size()>0'>
            and sm.doctor_Type_Id in
            <foreach collection="doctorTypeIdList" item="doctorTypeId" open="(" separator="," close=")">
                #{doctorTypeId}
            </foreach>
        </if>
        <if test='monthDate!=null and monthDate!=""'>
            and sm.date_month = #{monthDate}
        </if>
        AND (SUBSTR(sm.SCH_START_DATE, 0, 7) = #{monthDate} or SUBSTR(sm.SCH_END_DATE, 0, 7) = #{monthDate})
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and sm.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and sm.ORG_FLOW = #{orgFlow}
        </if>
        <if test='schDeptFlow!=null and schDeptFlow!=""'>
            and sm.sch_Dept_Flow = #{schDeptFlow}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and sm.session_Number = #{sessionNumber}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and sm.TRAINING_SPE_ID = #{trainingSpeId}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and sm.TRAINING_Type_ID = #{trainingTypeId}
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
        where smd.record_status='Y' and smd.doctor_flow = sm.doctor_flow and smd.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        group by sm.ORG_FLOW,sm.org_name,sm.sch_dept_flow,sm.sch_dept_name
    </select>

    <select id="getHospitalChart5DoctorDetail" resultType="java.util.Map" parameterType="java.util.Map">
        select DISTINCT sm.org_name,sm.sch_dept_name,sm.doctor_name,sm.session_number,
        sm.TRAINING_SPE_NAME,s.user_phone,sm.SCH_START_DATE,sm.SCH_END_DATE,sm.TEACHER_USER_NAME
        from
        SYS_MONTHLY_DOC_CYCLE_INFO sm
        left join SYS_MONTHLY_DOCTOR_INFO s on s.doctor_flow= sm.doctor_flow
        where sm.record_status='Y' and s.record_status='Y' and s.CHANGE_TYPE_ID = 'DoctorTrainingSpe'
        <if test='doctorTypeIdList != null and doctorTypeIdList.size()>0'>
            and sm.doctor_Type_Id in
            <foreach collection="doctorTypeIdList" item="doctorTypeId" open="(" separator="," close=")">
                #{doctorTypeId}
            </foreach>
        </if>
        <if test='monthDate!=null and monthDate!=""'>
            and sm.date_month = #{monthDate}
            and s.date_month = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and sm.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and sm.ORG_FLOW = #{orgFlow}
        </if>
        <if test='schDeptFlow!=null and schDeptFlow!=""'>
            and sm.sch_Dept_Flow = #{schDeptFlow}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and sm.session_Number = #{sessionNumber}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and sm.TRAINING_SPE_ID = #{trainingSpeId}
        </if>
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and sm.TRAINING_Type_ID = #{trainingTypeId}
        </if>
        <if test='schStatus==null or schStatus==""'>
            AND SUBSTR(sm.SCH_START_DATE,0,7) = #{monthDate}
        </if>
        <if test='schStatus!=null and schStatus!=""'>
            and sm.SCH_STATUS = #{schStatus}
            AND SUBSTR(sm.SCH_END_DATE,0,7) = #{monthDate}
        </if>
    </select>

    <select id="getHospitalChart6Detail" resultType="java.util.Map" parameterType="java.util.Map">
        select sm.org_name,sm.doctor_name,sm.session_number,sm.training_spe_name,sm.sch_dept_name,
        sm.SCH_START_DATE,sm.SCH_END_DATE,sm.TEACHER_USER_NAME,
        sm.HEAD_USER_NAME,case sm.IS_HAVE_GRADE when 'Y' then '是' else '否' end IS_HAVE_GRADE,sm.THEORY_SCORE,sm.SKILL_SCORE,sm.SKILL_NAME
        from
        SYS_MONTHLY_DOC_CYCLE_INFO sm
        where sm.record_status='Y'
        <if test='orgFlow!=null and orgFlow!=""'>
            and sm.ORG_FLOW = #{orgFlow}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and sm.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='schDeptFlow!=null and schDeptFlow!=""'>
            and sm.sch_Dept_Flow = #{schDeptFlow}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and sm.session_Number = #{sessionNumber}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and sm.TRAINING_SPE_ID = #{trainingSpeId}
        </if>
        <if test='doctorTypeIdList != null and doctorTypeIdList.size()>0'>
            and sm.doctor_Type_Id in
            <foreach collection="doctorTypeIdList" item="doctorTypeId" open="(" separator="," close=")">
                #{doctorTypeId}
            </foreach>
        </if>
        <if test='monthDate!=null and monthDate!=""'>
            and sm.date_month = #{monthDate}
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
        where smd.record_status='Y' and smd.doctor_flow = sm.doctor_flow and smd.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
    </select>

    <select id="getHospitalChart6Detail2" resultType="java.util.Map" parameterType="java.util.Map">
        select sm.org_name,sm.doctor_name,sm.session_number,sm.training_spe_name,sm.sch_dept_name,
        sm.SCH_START_DATE,sm.SCH_END_DATE,sm.TEACHER_USER_NAME,sm.EXAM_NUM,sm.EXAM_PASS
        from
        SYS_MONTHLY_DOC_CYCLE_INFO sm
        where sm.record_status='Y' and sm.exam_num>0
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and sm.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='monthDate!=null and monthDate!=""'>
            and sm.date_month = #{monthDate}
        </if>
        <if test='doctorTypeId!=null and doctorTypeId!=""'>
            <if test='doctorTypeId=="Graduate"'>and sm.doctor_Type_Id = 'Graduate'</if>
            <if test='doctorTypeId!="Graduate"'>and sm.doctor_Type_Id != 'Graduate'</if>
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
        where smd.record_status='Y' and smd.doctor_flow = sm.doctor_flow and smd.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
    </select>

    <select id="getHospitalChart7Detail" resultType="java.util.Map" parameterType="java.util.Map">
        select sm.org_name,sm.doctor_name,sm.session_number,sm.training_spe_name,sm.sch_dept_name,
        sm.SCH_START_DATE,sm.SCH_END_DATE,sm.TEACHER_USER_NAME,sm.HEAD_USER_NAME,sm.ACTIVITY_NUM,
        sm.REC_NUM,sm.AUDIT_NUM,sm.SCH_STATUS_NAME
        from
        SYS_MONTHLY_DOC_CYCLE_INFO sm
        where sm.record_status='Y'
        <if test='orgFlow!=null and orgFlow!=""'>
            and sm.ORG_FLOW = #{orgFlow}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and sm.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='schDeptFlow!=null and schDeptFlow!=""'>
            and sm.sch_Dept_Flow = #{schDeptFlow}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and sm.session_Number = #{sessionNumber}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and sm.TRAINING_SPE_ID = #{trainingSpeId}
        </if>
        <if test='doctorTypeIdList != null and doctorTypeIdList.size()>0'>
            and sm.doctor_Type_Id in
            <foreach collection="doctorTypeIdList" item="doctorTypeId" open="(" separator="," close=")">
                #{doctorTypeId}
            </foreach>
        </if>
        <if test='monthDate!=null and monthDate!=""'>
            and sm.date_month = #{monthDate}
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
        where smd.record_status='Y' and smd.doctor_flow = sm.doctor_flow and smd.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
    </select>

    <select id="getHospitalChart8Detail" resultType="java.util.Map" parameterType="java.util.Map">
        select  sm.org_name,sm.sch_dept_name,sm.teacher_user_name,su.user_code,avg(sm.TEACHER_SCORE) TEACHER_SCORE,
        sum(smt.ACTIVITY_NUM) ACTIVITY_NUM,count(DISTINCT sm.doctor_flow) doctor_num,sum(sm.REC_NUM) REC_NUM,sum(sm.AUDIT_NUM) AUDIT_NUM
        from
        SYS_MONTHLY_DOC_CYCLE_INFO sm
        left join sys_user su on sm.teacher_user_flow = su.user_flow
        left join SYS_MONTHLY_TEA_WORK_INFO smt on sm.teacher_user_flow = smt.TEACHER_USER_FLOW
        where sm.record_status='Y' and su.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and sm.date_month = #{monthDate}
            and smt.date_month = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and sm.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='schDeptFlow!=null and schDeptFlow!=""'>
            and sm.sch_Dept_Flow = #{schDeptFlow}
        </if>
        <if test='teacherUserName!=null and teacherUserName!=""'>
            and sm.teacher_user_name like CONCAT(CONCAT('%', #{teacherUserName}),'%')
        </if>
        and EXISTS (select null from SYS_MONTHLY_DOCTOR_INFO smd
        where smd.record_status='Y' and smd.doctor_flow = sm.doctor_flow and smd.CHANGE_TYPE_ID = 'DoctorTrainingSpe')
        group by sm.org_flow,sm.org_name,sm.sch_dept_flow,sch_dept_name,sm.teacher_user_flow,sm.teacher_user_name,su.user_code
    </select>

    <select id="getHospitalChart9Detail" resultType="java.util.Map" parameterType="java.util.Map">
        select sma.org_name,sma.DEPT_NAME ,sum(sma.ACTIVTIY_NUM) ACTIVTIY_NUM,sum(sma.JOIN_NUM) JOIN_NUM,
        nvl((select sum(nvl(s.ACTIVTIY_NUM,0)) from SYS_MONTHLY_ACTIVITY_INFO s
        where s.activity_type_id='1' and s.date_month = sma.date_month and s.org_flow = sma.org_flow and s.DEPT_FLOW=sma.DEPT_FLOW),0) jxcf,
        nvl((select sum(nvl(s.ACTIVTIY_NUM,0)) from SYS_MONTHLY_ACTIVITY_INFO s
        where s.activity_type_id='2' and s.date_month = sma.date_month and s.org_flow = sma.org_flow and s.DEPT_FLOW=sma.DEPT_FLOW),0) ynbl,
        nvl((select sum(nvl(s.ACTIVTIY_NUM,0)) from SYS_MONTHLY_ACTIVITY_INFO s
        where s.activity_type_id='3' and s.date_month = sma.date_month and s.org_flow = sma.org_flow and s.DEPT_FLOW=sma.DEPT_FLOW),0) wzbl,
        nvl((select sum(nvl(s.ACTIVTIY_NUM,0)) from SYS_MONTHLY_ACTIVITY_INFO s
        where s.activity_type_id='4' and s.date_month = sma.date_month and s.org_flow = sma.org_flow and s.DEPT_FLOW=sma.DEPT_FLOW),0) xjk,
        nvl((select sum(nvl(s.ACTIVTIY_NUM,0)) from SYS_MONTHLY_ACTIVITY_INFO s
        where s.activity_type_id='5' and s.date_month = sma.date_month and s.org_flow = sma.org_flow and s.DEPT_FLOW=sma.DEPT_FLOW),0) swbl
        from SYS_MONTHLY_ACTIVITY_INFO sma
        where sma.record_status='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and sma.date_month = #{monthDate}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and sma.ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='deptFlow!=null and deptFlow!=""'>
            and sma.dept_Flow = #{deptFlow}
        </if>
        group by sma.org_flow,sma.org_name ,sma.DEPT_FLOW,sma.DEPT_NAME,sma.date_month
        ORDER by ACTIVTIY_NUM desc
    </select>

    <select id="getHospitalDoctorsNum" resultType="java.util.Map" parameterType="java.util.Map">
      select org_flow,org_name,session_number
        ,(select count(0) from sys_monthly_doctor_info where doctor_type_id = 'Graduate' and org_flow = smdi.org_flow and session_number = smdi.session_number and RECORD_STATUS='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and date_Month = #{monthDate}
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and ORG_FLOW = #{orgFlow}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and session_Number = #{sessionNumber}
        </if>
        and doctor_status_id = '20'
        and CHANGE_TYPE_ID = 'DoctorTrainingSpe') a
        ,(select count(0) from sys_monthly_doctor_info where doctor_type_id != 'Graduate' and org_flow = smdi.org_flow and session_number = smdi.session_number and RECORD_STATUS='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and date_Month = #{monthDate}
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and ORG_FLOW = #{orgFlow}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and session_Number = #{sessionNumber}
        </if>
        and doctor_status_id = '20'
        and CHANGE_TYPE_ID = 'DoctorTrainingSpe') b
        ,(count(0)) c
        from sys_monthly_doctor_info smdi
        where RECORD_STATUS='Y'
        <if test='monthDate!=null and monthDate!=""'>
            and date_Month = #{monthDate}
        </if>
        <if test='orgFlow!=null and orgFlow!=""'>
            and ORG_FLOW = #{orgFlow}
        </if>
        <if test='allOrgFlow!=null and allOrgFlow.size>0'>
            and ORG_FLOW in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and session_Number = #{sessionNumber}
        </if>
        and CHANGE_TYPE_ID = 'DoctorTrainingSpe'
        and doctor_status_id = '20'
        GROUP BY org_flow,org_name,session_number ORDER BY org_flow,org_name,session_number
    </select>

    <resultMap id="docResultsMap" type="HashMap">
        <result property="userName" column="user_name" javaType="string"/>
        <result property="trainingTypeName" column="training_Type_name" javaType="string"/>
        <result property="trainingSpeName" column="training_spe_name" javaType="string"/>
        <result property="sessionNumber" column="session_number" javaType="string"/>
        <result property="graduationYear" column="graduation_year" javaType="string"/>
        <result property="doctorFlow" column="doctor_flow" javaType="string"/>
        <result property="orgName" column="org_name" javaType="string"/>
        <result property="userPhone" column="user_phone" javaType="string"/>
        <result property="idNo" column="id_no" javaType="string"/>
        <result property="orgFlow" column="org_flow" javaType="string"/>
    </resultMap>
    <!--学员出科（异常学员查询）yuh-->
    <select id="findDoctorOutOffice" parameterType="java.util.Map" resultMap="docResultsMap">
        SELECT  u.USER_NAME AS user_name, dr.TRAINING_TYPE_NAME AS training_Type_name, rdr.SPE_NAME AS training_spe_name, rdr.SESSION_NUMBER AS session_number, dr.DOCTOR_Flow AS doctor_flow
			, rdr.graduation_year AS graduation_year, u.org_name AS org_name,u.USER_PHONE AS user_phone,u.ID_NO As id_no,rdr.org_flow AS org_flow
		FROM RES_DOCTOR dr
		INNER JOIN SYS_USER u ON dr.DOCTOR_FLOW = u.USER_FLOW
			LEFT JOIN (
				SELECT a.*, ROW_NUMBER() OVER (PARTITION BY doctor_flow ORDER BY create_time DESC) AS rn
				FROM RES_DOCTOR_RECRUIT a
				WHERE AUDIT_STATUS_ID = 'Passed'
					AND RECORD_STATUS = 'Y'
			) rdr ON dr.DOCTOR_FLOW = rdr.DOCTOR_FLOW
		<!--AND rn = 1-->
		WHERE dr.RECORD_STATUS = 'Y'
			AND u.RECORD_STATUS = 'Y'
			AND rdr.record_status = 'Y'
        <if test='trainingTypeId!=null and trainingTypeId!=""'>
            and dr.TRAINING_TYPE_ID = #{trainingTypeId}
        </if>
        <if test="docTypeList!=null and docTypeList.size>0">
            AND dr.DOCTOR_TYPE_ID IN
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test="orgFlows!=null and orgFlows.size>0">
            AND rdr.ORG_FLOW IN
            <foreach collection="orgFlows" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test="orgFlow!=null and orgFlow!=''">
            AND rdr.ORG_FLOW =#{orgFlow}
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and rdr.SPE_ID = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and rdr.SESSION_NUMBER = #{sessionNumber}
        </if>
		ORDER BY dr.SESSION_NUMBER DESC, dr.TRAINING_Type_ID, dr.TRAINING_SPE_ID, u.user_flow
    </select>


    <!--根据专业、年级、人员类别（住院医生、在职专硕）条件获取在培学员信息-->
    <select id="getTraincountbySpeNameSessionNumberDocType" resultMap="com.pinde.sci.dao.jsres.JsResDoctorRecruitExtMapper.DoctorRecruit" parameterType="java.util.Map">
		SELECT dr.*, u.USER_FLOW, u.USER_CODE, u.USER_NAME, u.SEX_ID
        , u.SEX_NAME, u.USER_PHONE, u.USER_EMAIL, u.ID_NO, u.USER_BIRTHDAY
        , u.TITLE_ID, u.TITLE_NAME, u.DEGREE_ID, u.DEGREE_NAME, u.EDUCATION_ID
        , u.EDUCATION_NAME, u.POST_ID, u.POST_NAME, ed.ORG_FLOW AS edOrgFlow, ed.ORG_Name AS edOrgName
        , ed.doctor_type_name, ed.doctor_type_id
		FROM pdsci.RES_DOCTOR_RECRUIT dr
		LEFT JOIN pdsci.SYS_USER u ON dr.DOCTOR_FLOW = u.USER_FLOW
			LEFT JOIN RES_DOCTOR ed ON dr.DOCTOR_FLOW = ed.DOCTOR_FLOW
		WHERE dr.RECORD_STATUS = 'Y'
			AND u.RECORD_STATUS = 'Y'
			AND dr.org_flow IN (SELECT ORG_FLOW
				FROM PDSCI.SYS_ORG
				WHERE PDSCI.SYS_ORG.RECORD_STATUS = 'Y'
					AND dr.AUDIT_STATUS_ID != 'NotSubmit'
					<if test="orgFlow!=null and  orgFlow!=''">
                        AND dr.ORG_FLOW = #{orgFlow}
                    </if>
        <if test="universityDoctorFlows!=null ">
            and dr.doctor_flow in
            <trim suffixOverrides=" OR dr.doctor_flow IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR dr.doctor_flow IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
            <!--<foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
        </if>
                    <if test="allOrgFlow!=null ">
                        AND dr.ORG_FLOW  in
                        <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
                    </if>
                    <if test="docTypeList!=null ">
                        and ed.DOCTOR_TYPE_ID in
                        <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
                    </if>
					AND dr.TRAIN_YEAR IN ('OneYear', 'TwoYear', 'ThreeYear'))
			AND dr.AUDIT_STATUS_ID = 'Passed'
			AND dr.CAT_SPE_ID = 'DoctorTrainingSpe'
        <if test="speId!=null and  speId!=''">
            AND dr.SPE_ID = #{speId}
        </if>
        <if test="sessionNumber!=null and  sessionNumber!=''">
            and dr.SESSION_NUMBER= #{sessionNumber}
        </if>
			AND dr.doctor_Status_Id = '20'
		ORDER BY dr.session_number DESC, dr.org_flow, dr.spe_id, NLSSORT(u.USER_NAME, 'NLS_SORT = SCHINESE_PINYIN_M'), dr.doctor_flow, dr.CREATE_TIME DESC
    </select>

    <!--获取该基地当前年月app使用人数,登录app并且操作app轮转数据-->
    <select id="getAppUserSum" resultType="java.lang.String" parameterType="java.util.Map">

        with
        T_log as(
            select  USER_FLOW from SYS_LOG
            where 1=1
        <if test="orgFlow!=null and  orgFlow!=''">
            AND  ORG_FLOW=#{orgFlow}
        </if>
        <if test="allOrgFlow!=null ">
            AND  ORG_FLOW  in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        <if test="monthDate!=null and  monthDate!=''">
            <!-- 非定时任务使用 AND to_char(to_date(log_time,'yyyymmddhh24miss'),'yyyy-mm') =#{monthDate}-->
            and log_time  like concat(#{monthDate},'%')
        </if>
            AND Oper_Id = 'AppLogin'
            group by user_flow
        ),
        T_res as(
            select    MODIFY_USER_FLOW
            from    RES_REC
            where 1=1
        <if test="orgFlow!=null and  orgFlow!=''">
               AND  ORG_FLOW=#{orgFlow}
        </if>
        <if test="allOrgFlow!=null ">
            AND  ORG_FLOW  in
            <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        <if test="monthDate!=null and  monthDate!=''">
            and modify_time  like concat(#{monthDate},'%')
        <!--非定时任务使用 AND to_char(to_date(modify_time,'yyyymmddhh24miss'),'yyyy-mm') =#{monthDate}-->
    </if>
        group by   MODIFY_USER_FLOW
    )
    select
    aa.doctor_flow
    from RES_DOCTOR aa
    LEFT JOIN T_log ON aa.doctor_flow=T_log.USER_FLOW
    INNER JOIN T_res ON T_log.USER_FLOW=T_res.MODIFY_USER_FLOW
    where 1=1
    <if test="myDoctorTypeId!=null and  myDoctorTypeId!=''">
        AND aa.DOCTOR_TYPE_ID IN
        <foreach collection="myDoctorTypeId" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
    </if>
    <if test="universityDoctorFlows!=null">
        AND aa.doctor_flow IN
        <trim suffixOverrides=" OR aa.doctor_flow IN()">
            <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                <if test="index != 0">
                    <choose>
                        <when test="index % 1000 == 999">) OR aa.doctor_flow IN (</when>
                        <otherwise>,</otherwise>
                    </choose>
                </if>
                #{Id}
            </foreach>
        </trim>
        <!--<foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
    </if>
    <!--SELECT
    user_flow
    FROM
    (
    SELECT
    *
    FROM
    Sys_Log a LEFT JOIN RES_REC b ON a.USER_FLOW=b.MODIFY_USER_FLOW
    LEFT JOIN RES_DOCTOR c on a.USER_FLOW=c.doctor_flow
    WHERE
    a.Oper_Id = 'AppLogin'
    <if test="myDoctorTypeId!=null and  myDoctorTypeId!=''">
        and c.DOCTOR_TYPE_ID in
        <foreach collection="myDoctorTypeId" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
    </if>
    <if test="universityDoctorFlows!=null">
        and c.doctor_flow in
        <foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
    </if>

    <if test="monthDate!=null and  monthDate!=''">
        AND (
        SUBSTR (a.log_TIME, 0, 4) || '-' || SUBSTR (a.log_TIME, 5, 2)
        ) = #{monthDate}
    </if>
    <if test="orgFlow!=null and  orgFlow!=''">
        AND a.ORG_FLOW = #{orgFlow}
    </if>
    <if test="allOrgFlow!=null ">
        AND a.ORG_FLOW  in
        <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
    </if>
    <if test="allOrgFlow!=null ">
        AND b.ORG_FLOW  in
        <foreach collection="allOrgFlow" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
    </if>
    <if test="orgFlow!=null and  orgFlow!=''">
        AND b.ORG_FLOW = #{orgFlow}
    </if>

    <if test="monthDate!=null and  monthDate!=''">
        AND (
        SUBSTR (b.MODIFY_TIME, 0, 4) || '-' || SUBSTR (b.MODIFY_TIME, 5, 2)
        ) =#{monthDate}
    </if>

    ) A
    GROUP BY
    A .user_flow-->
    </select>
    <!--查找满足条件的学员-->
    <select id="findManzuTiaojianDoctor" parameterType="java.util.Map" resultType="com.pinde.sci.model.jsres.DoctorInfoParam">
        select a.doctor_flow as userFlow,
               a.spe_id as speId,
               a.spe_Name as speName,
               a.org_flow as orgFlow,
               a.SESSION_NUMBER as sessionNumber,
              b.DOCTOR_TYPE_ID as doctorTypeId
        FROM RES_DOCTOR_RECRUIT a
        LEFT JOIN RES_DOCTOR b ON a.DOCTOR_FLOW=b.DOCTOR_FLOW
        WHERE
        1=1
        <if test="orgFlow!=null and  orgFlow!=''">
            AND ( a.ORG_FLOW=#{orgFlow} OR b.ORG_FLOW=#{orgFlow} )
        </if>
        <if test="userFlow!=null and  userFlow!=''">
            AND ( a.DOCTOR_FLOW=#{userFlow} OR b.DOCTOR_FLOW=#{userFlow})
        </if>
        <if test="speId!=null and  speId!=''">
        AND a.SPE_id=#{speId}
        </if>
        <if test="sessionNumber!=null and  sessionNumber!=''">
        AND a.SESSION_NUMBER=#{sessionNumber}
        </if>
        <if test="docTypeList!=null ">
            AND b.DOCTOR_TYPE_ID in
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
    </select>

    <select id="findActivityInfoAndActivityResultByTiaojian" resultMap="myactivityMap"  parameterType="java.util.Map">
        with CTE as
            (
        SELECT INFO.*, SU.USER_NAME, D.DEPT_NAME, RESULT.EVAL_SCORE, F.FILE_NAME
        ,
        NVL (RESULT.SCAN_NUM, 0) AS SCAN_NUM,
        RESULT2.REGIEST_NUM
        FROM TEACHING_ACTIVITY_INFO INFO
        LEFT JOIN SYS_USER SU ON INFO.SPEAKER_FLOW = SU.USER_FLOW
        LEFT JOIN SYS_DEPT D ON D.DEPT_FLOW = INFO.DEPT_FLOW
        LEFT JOIN (
        SELECT ACTIVITY_FLOW, To_char(ROUND(SUM(EVAL_SCORE) / COUNT(EVAL_SCORE))) AS EVAL_SCORE, COUNT(1) AS SCAN_NUM
        FROM TEACHING_ACTIVITY_RESULT T
        WHERE T.RECORD_STATUS = 'Y'
        AND T.IS_SCAN = 'Y'
        AND T.IS_SCAN2 = 'Y'
        <if test='universityDoctorFlows!=null '>
            and T.USER_FLOW in
            <trim suffixOverrides=" OR T.USER_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR T.USER_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
            <!--<foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
        </if>
        GROUP BY ACTIVITY_FLOW
        ) RESULT ON RESULT.ACTIVITY_FLOW = INFO.ACTIVITY_FLOW
        LEFT JOIN (
        SELECT ACTIVITY_FLOW, COUNT(1) AS REGIEST_NUM
        FROM TEACHING_ACTIVITY_RESULT T
        WHERE T.RECORD_STATUS = 'Y'
        AND T.IS_REGIEST = 'Y'
        <if test='universityDoctorFlows!=null '>
            and T.USER_FLOW in
            <trim suffixOverrides=" OR T.USER_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR T.USER_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
           <!-- <foreach collection="universityDoctorFlows" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>-->
        </if>
        GROUP BY ACTIVITY_FLOW
        ) RESULT2 ON RESULT2.ACTIVITY_FLOW = INFO.ACTIVITY_FLOW
        LEFT JOIN PUB_FILE F ON INFO.FILE_FLOW = F.FILE_FLOW
        AND F.RECORD_STATUS = 'Y'
        WHERE INFO.RECORD_STATUS = 'Y'
        AND SU.RECORD_STATUS = 'Y'
        AND D.RECORD_STATUS = 'Y'
        <if test='orgFlow!=null and orgFlow!=""'>
            AND INFO.ORG_FLOW = #{orgFlow}
        </if>
        AND INFO.DEPT_FLOW IN (SELECT DEPT_FLOW
        FROM SYS_DEPT
        WHERE 1=1
        <if test='orgFlow!=null and orgFlow!=""'>
            AND	ORG_FLOW = #{orgFlow}
        </if>
        AND RECORD_STATUS = 'Y')
        AND activity_status = 'pass'<!--审核通过-->
        AND INFO.IS_EFFECTIVE='Y' <!--管理员认可-->
        and result.SCAN_NUM>0  <!--有效的-->
        ORDER BY START_TIME DESC, END_TIME DESC, RESULT.EVAL_SCORE DESC
)

        select CTE.*,res.*
        from CTE  LEFT JOIN TEACHING_ACTIVITY_RESULT res ON CTE.ACTIVITY_FLOW=res.ACTIVITY_FLOW

        LEFT JOIN RES_DOCTOR_RECRUIT a ON res.user_flow=a.doctor_flow

        LEFT JOIN RES_DOCTOR b ON a.DOCTOR_FLOW=b.DOCTOR_FLOW

        WHERE 1=1

        <if test="orgFlow!=null and  orgFlow!=''">
            AND ( a.ORG_FLOW=#{orgFlow} OR b.ORG_FLOW=#{orgFlow} )
        </if>
        <if test="speId!=null and  speId!=''">
            AND a.SPE_id=#{speId}
        </if>
        <if test="sessionNumber!=null and  sessionNumber!=''">
            AND a.SESSION_NUMBER=#{sessionNumber}
        </if>
        <if test="docTypeList!=null ">
            AND b.DOCTOR_TYPE_ID in
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>

        AND RES.IS_SCAN='Y' AND RES.IS_SCAN2='Y'
        and a.RECORD_status='Y' AND b.record_status='Y'
        and  to_char(to_date(RES.scan_time,'yyyymmddhh24miss'),'yyyymm') = #{monthDate}
        and  to_char(to_date(RES.scan_time2,'yyyymmddhh24miss'),'yyyymm') = #{monthDate}

    </select>

    <resultMap id="myactivityMap" type="com.pinde.sci.model.jsres.JiaoxueActiveAndResultParam">
        <id column="ACTIVITY_FLOW" property="activityFlow" jdbcType="VARCHAR" />
        <result column="ACTIVITY_NAME" property="activityName" jdbcType="VARCHAR" />
        <result column="DEPT_FLOW" property="deptFlow" jdbcType="VARCHAR" />
        <result column="ORG_FLOW" property="orgFlow" jdbcType="VARCHAR" />
        <result column="SPEAKER_FLOW" property="speakerFlow" jdbcType="VARCHAR" />
        <result column="SPEAKER_PHONE" property="speakerPhone" jdbcType="VARCHAR" />
        <result column="ACTIVITY_TYPE_ID" property="activityTypeId" jdbcType="VARCHAR" />
        <result column="ACTIVITY_TYPE_NAME" property="activityTypeName" jdbcType="VARCHAR" />
        <result column="START_TIME" property="startTime" jdbcType="VARCHAR" />
        <result column="END_TIME" property="endTime" jdbcType="VARCHAR" />
        <result column="ACTIVITY_ADDRESS" property="activityAddress" jdbcType="VARCHAR" />
        <result column="ACTIVITY_REMARK" property="activityRemark" jdbcType="VARCHAR" />
        <result column="FILE_FLOW" property="fileFlow" jdbcType="VARCHAR" />
        <result column="RECORD_STATUS" property="recordStatus" jdbcType="VARCHAR" />
        <result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
        <result column="CREATE_USER_FLOW" property="createUserFlow" jdbcType="VARCHAR" />
        <result column="MODIFY_TIME" property="modifyTime" jdbcType="VARCHAR" />
        <result column="MODIFY_USER_FLOW" property="modifyUserFlow" jdbcType="VARCHAR" />
        <result column="IS_EFFECTIVE" property="isEffective" jdbcType="VARCHAR" />
        <result column="REALITY_SPEAKER" property="realitySpeaker" jdbcType="VARCHAR" />
        <result column="ACTIVITY_STATUS" property="activityStatus" jdbcType="VARCHAR" />
        <result column="SUBMIT_ROLE" property="submitRole" jdbcType="VARCHAR" />
        <result column="AUDIT_ROLE" property="auditRole" jdbcType="VARCHAR" />
        <result column="OPINION" property="opinion" jdbcType="VARCHAR" />

        <result column="USER_NAME" property="userName" jdbcType="VARCHAR" />
        <result column="DEPT_NAME" property="deptName" jdbcType="VARCHAR" />
        <result column="FILE_NAME" property="fileName" jdbcType="VARCHAR" />
        <result column="EVAL_SCORE" property="evalScore" jdbcType="VARCHAR" />
        <result column="REGIEST_NUM" property="regiestNum" jdbcType="VARCHAR" />
        <result column="SCAN_NUM" property="scanNum" jdbcType="VARCHAR" />
        <collection property="resultList" ofType="com.pinde.sci.model.mo.TeachingActivityResult" >
            <id column="RESULT_FLOW" jdbcType="VARCHAR" property="resultFlow" />
            <result column="ACTIVITY_FLOW" jdbcType="VARCHAR" property="activityFlow" />
            <result column="USER_FLOW" jdbcType="VARCHAR" property="userFlow" />
            <result column="EVAL_SCORE" jdbcType="DECIMAL" property="evalScore" />
            <result column="RECORD_STATUS" jdbcType="VARCHAR" property="recordStatus" />
            <result column="CREATE_TIME" jdbcType="VARCHAR" property="createTime" />
            <result column="CREATE_USER_FLOW" jdbcType="VARCHAR" property="createUserFlow" />
            <result column="MODIFY_TIME" jdbcType="VARCHAR" property="modifyTime" />
            <result column="MODIFY_USER_FLOW" jdbcType="VARCHAR" property="modifyUserFlow" />
            <result column="IS_REGIEST" jdbcType="VARCHAR" property="isRegiest" />
            <result column="IS_SCAN" jdbcType="VARCHAR" property="isScan" />
            <result column="REGIEST_TIME" jdbcType="VARCHAR" property="regiestTime" />
            <result column="SCAN_TIME" jdbcType="VARCHAR" property="scanTime" />
            <result column="IS_EFFECTIVE" jdbcType="VARCHAR" property="isEffective" />
            <result column="IS_SCAN2" jdbcType="VARCHAR" property="isScan2" />
            <result column="SCAN_TIME2" jdbcType="VARCHAR" property="scanTime2" />
        </collection>
    </resultMap>
    <!--以下学员轮转异常统计-->
    <select id="searchCycleArrangeResults" resultMap="com.pinde.sci.dao.base.SchArrangeResultMapper.BaseResultMap">
        with KK as(
            SELECT DISTINCT u.USER_NAME AS user_name, u.user_flow, dr.TRAINING_SPE_NAME AS training_spe_name, dr.DOCTOR_Flow AS doctor_flow, dr.SESSION_NUMBER AS session_number
            , dr.TRAINING_YEARS AS training_years, dr.TRAINING_SPE_ID AS training_spe_id, dr.TRAINING_Type_ID
            FROM RES_DOCTOR dr
            INNER JOIN SYS_USER u ON dr.DOCTOR_FLOW = u.USER_FLOW
            LEFT JOIN RES_DOCTOR_RECRUIT rdr ON dr.DOCTOR_FLOW = rdr.DOCTOR_FLOW
            AND AUDIT_STATUS_ID = 'Passed'
            WHERE dr.RECORD_STATUS = 'Y'
            AND u.RECORD_STATUS = 'Y'
            AND rdr.record_status = 'Y'
            <if test='trainingSpeId!=null and trainingSpeId!=""'>
                and dr.TRAINING_SPE_ID = #{trainingSpeId}
            </if>
            <if test='sessionNumber!=null and sessionNumber!=""'>
                and dr.SESSION_NUMBER = #{sessionNumber}
            </if>
            <if test='docTypeList!=null'>
                and dr.DOCTOR_TYPE_ID in
                <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
            </if>
        AND dr.doctor_Status_Id = '20'
        AND rDR.cat_spe_Id='DoctorTrainingSpe'
            AND ( dr.org_flow = #{orgFlow})
            ORDER BY dr.SESSION_NUMBER DESC, dr.TRAINING_Type_ID, dr.TRAINING_SPE_ID, u.user_flow
        )
        SELECT ar.*
        FROM SCH_ARRANGE_RESULT ar, RES_DOCTOR dr, SYS_USER u,KK
        WHERE dr.RECORD_STATUS = 'Y'
        AND u.RECORD_STATUS = 'Y'
        AND ar.RECORD_STATUS = 'Y'
        AND dr.DOCTOR_FLOW = u.USER_FLOW
        AND dr.DOCTOR_FLOW = ar.DOCTOR_FLOW
        AND KK.DOCTOR_FLOW=dr.DOCTOR_FLOW
        <if test='startDate!=null and startDate!="" and endDate!=null and endDate!=""'>
            AND (
            ar.SCH_END_DATE >= #{startDate} AND
            ar.SCH_END_DATE <![CDATA[<=]]>  #{endDate})
        </if>
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and dr.TRAINING_SPE_ID = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and dr.SESSION_NUMBER = #{sessionNumber}
        </if>
        <if test='doctorFlow!=null and doctorFlow!=""'>
            and DR.DOCTOR_FLOW=#{doctorFlow}
        </if>
        AND (dr.ORG_FLOW = #{orgFlow})
        ORDER BY u.USER_NAME
    </select>
    <resultMap type="HashMap" id="docCycleMap">
        <result property="userName" column="user_name" javaType="string"/>
        <result property="trainingSpeName" column="training_spe_name" javaType="string"/>
        <result property="sessionNumber" column="session_number" javaType="string"/>
        <result property="trainingYears" column="training_years" javaType="string"/>
        <result property="doctorFlow" column="doctor_flow" javaType="string"/>
        <result property="orgFlow" column="orgFlow" javaType="string"/>
        <result property="userPhone" column="userPhone" javaType="string"/>
        <result property="sexName" column="sexName" javaType="string"/>
        <result property="tutorName" column="tutorName" javaType="string"/>
        <result property="doctorStatusName" column="doctorStatusName" javaType="string"/>
    </resultMap>
    <!--在陪学员人数-->
    <select id="searchDocCycleList" parameterType="java.util.Map" resultMap="docCycleMap">

        SELECT DISTINCT u.USER_NAME AS user_name, u.user_flow, dr.TRAINING_SPE_NAME AS training_spe_name, dr.DOCTOR_Flow AS doctor_flow, dr.SESSION_NUMBER AS session_number
        , dr.TRAINING_YEARS AS training_years, dr.TRAINING_SPE_ID AS training_spe_id, dr.TRAINING_Type_ID,
        dr.ORG_NAME as orgFlow,
        U.USER_PHONE as userPhone,
        U.SEX_NAME as sexName,
        dr.TUTOR_NAME as tutorName,
        dr.DOCTOR_STATUS_NAME as doctorStatusName
        FROM RES_DOCTOR dr
        INNER JOIN SYS_USER u ON dr.DOCTOR_FLOW = u.USER_FLOW
        LEFT JOIN RES_DOCTOR_RECRUIT rdr ON dr.DOCTOR_FLOW = rdr.DOCTOR_FLOW
        AND AUDIT_STATUS_ID = 'Passed'
        WHERE dr.RECORD_STATUS = 'Y'
        AND u.RECORD_STATUS = 'Y'
        AND rdr.record_status = 'Y'
        <if test='trainingSpeId!=null and trainingSpeId!=""'>
            and dr.TRAINING_SPE_ID = #{trainingSpeId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and dr.SESSION_NUMBER = #{sessionNumber}
        </if>
        <if test='docTypeList!=null'>
            and dr.DOCTOR_TYPE_ID in
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        <if test='doctorFlowList!=null'>
            and dr.doctor_flow in
            <foreach collection="doctorFlowList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        AND dr.doctor_Status_Id = '20'
        AND rDR.cat_spe_Id='DoctorTrainingSpe'
        AND ( dr.org_flow = #{orgFlow})
        ORDER BY dr.SESSION_NUMBER DESC, dr.TRAINING_Type_ID, dr.TRAINING_SPE_ID, u.user_flow
    </select>
    <select id="getCurrentMonthInExceptionCount" parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT count(*)
        FROM SCH_ARRANGE_RESULT
        WHERE RECORD_STATUS='Y'
        AND  doctor_flow=#{doctorFlow}
        AND (SCH_start_DATE >= #{startDate}
        and SCH_start_DATE<![CDATA[<=]]> #{endDate} )
    </select>
    <select id="getCurrentMonthInException" parameterType="java.lang.String" resultType="com.pinde.sci.model.mo.SchArrangeResult">
        SELECT
         RESULT_FLOW as resultFlow,
         ARRANGE_FLOW as arrangeFlow,
         DOCTOR_FLOW as doctorFlow,
         DOCTOR_NAME as doctorName,
         SCH_START_DATE as schStartDate,
         SCH_END_DATE as schEndDate,
         DEPT_FLOW as deptFlow,
         DEPT_NAME as deptName,
         SCH_DEPT_FLOW as schDeptFlow,
         SCH_DEPT_NAME as schDeptName,
         ORG_FLOW as orgFlow,
         ORG_NAME as orgName

        FROM SCH_ARRANGE_RESULT
        WHERE RECORD_STATUS='Y'
        AND  doctor_flow=#{doctorFlow}
    </select>
    <!--学员轮转数据月报-->
    <select id="findDoctorLunZhuanDataMonthReport" parameterType="java.util.Map" resultType="com.pinde.sci.model.jsres.DoctorLunZhuanDataMonthReport">
        select
          count(1) writeSum
        , count(case when a.audit_status_id='Edit' or a.audit_status_id='Submit' then  null  else a.audit_status_id end) dataAuditSum
        from res_rec a
        LEFT JOIN RES_DOCTOR doc ON DOC.DOCTOR_FLOW=a.OPER_USER_FLOW
        LEFT JOIN RES_DOCTOR_RECRUIT rec ON REC.doctor_flow=a.oper_user_flow
        AND rec.AUDIT_STATUS_ID = 'Passed'
        where
         a.RECORD_STATUS='Y'
        AND REC.record_status='Y'
        AND DOC.RECORD_STATUS='Y'
        <if test='speId!=null and speId!=""'>
          and doc.TRAINING_SPE_ID =#{speId}
        </if>
        <if test='sessionNumber!=null and sessionNumber!=""'>
            and doc.SESSION_NUMBER = #{sessionNumber}
        </if>
        <if test='docTypeList!=null'>
            AND DOC.DOCTOR_TYPE_ID in
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item,jdbcType=VARCHAR}</foreach>
        </if>
        AND doc.doctor_Status_Id = '20'
        AND REC.cat_spe_Id='DoctorTrainingSpe'
         AND  doc.org_flow = #{orgFlow}
          AND  rec.org_flow =  #{orgFlow}
         AND a.ORG_FLOW= #{orgFlow}
       <!--非定时任务使用 AND to_char(to_date(a.MODIFY_TIME,'yyyymmddhh24miss'),'yyyy-mm') =#{monthDate}-->
        AND a.MODIFY_TIME  like concat(#{monthDate},'%')
    </select>


    <select id="selectFindChangeSpe" parameterType="java.util.Map" resultType="com.pinde.sci.model.mo.PersonChangeEntity">
               WITH aaa AS (
            SELECT
                org_name,
                SUM (
                    CASE
                    WHEN policy_time LIKE CONCAT (#{monthDate}, '%') THEN
                        1
                    ELSE
                        0
                    END
                ) changeTimeNum
            FROM
                RES_DOCOTR_DELAY_TETURN
            WHERE
                RECORD_STATUS = 'Y'
            AND TYPE_ID = 'Delay'
            AND TRAINING_TYPE_ID = 'DoctorTrainingSpe'
            AND DOCTOR_TYPE_ID IN (
                'Company',
                'CompanyEntrust',
                'Social',
                'Graduate'
            )
            AND ORG_FLOW = #{orgFlow}
        <if test="universityDoctorFlows!=null ">
            and DOCTOR_FLOW in
            <trim suffixOverrides=" OR DOCTOR_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR DOCTOR_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
        </if>
            GROUP BY
                org_name
        ),
         bbb AS (
            SELECT
                D .org_name,
                SUM (
                    CASE
                    WHEN doh.modify_time LIKE CONCAT (#{monthDate}, '%') THEN
                        1
                    ELSE
                        0
                    END
                ) speChangeNum
            FROM
                RES_DOCTOR_ORG_HISTORY doh,
                RES_DOCTOR D
            WHERE
                doh.DOCTOR_FLOW = D .DOCTOR_FLOW
            AND doh.RECORD_STATUS = 'Y'
            AND D .RECORD_STATUS = 'Y'
            AND D .DOCTOR_TYPE_ID IN (
                'Company',
                'CompanyEntrust',
                'Social',
                'Graduate'
            )
            AND doh.CHANGE_TYPE_ID = 'SpeChange'
            AND doh.CHANGE_STATUS_ID IN (
                'GlobalAuditPass',
                'GlobalAuditunPass'
            )
            AND (
                doh.ORG_FLOW IN (
                    #{orgFlow}
                )
                OR doh.HISTORY_ORG_FLOW IN (
                    #{orgFlow}
                )
            )
            AND D .ORG_FLOW = #{orgFlow}
        <if test="universityDoctorFlows!=null ">
            and D.DOCTOR_FLOW in
            <trim suffixOverrides=" OR D.DOCTOR_FLOW IN()">
                <foreach collection="universityDoctorFlows" item="Id" index="index" open="(" close=")">
                    <if test="index != 0">
                        <choose>
                            <when test="index % 1000 == 999">) OR D.DOCTOR_FLOW IN (</when>
                            <otherwise>,</otherwise>
                        </choose>
                    </if>
                    #{Id}
                </foreach>
            </trim>
        </if>
            GROUP BY
                D .org_name
        )
        SELECT
            aaa.ORG_NAME as orgName,
            aaa.changeTimeNum  ,
            bbb.speChangeNum
        FROM
            aaa
        LEFT JOIN bbb ON aaa.ORG_NAME = bbb.ORG_NAME

    </select>

    <select id="searchDocCycleListNew" parameterType="java.util.Map" resultType="map">
        SELECT SD.DICT_ID,SD.DICT_NAME,TO_NUMBER(NVL(NOT_NUM,0)) as NOT_NUM, TO_NUMBER(NVL(NOT_TEST_NUM,0)) as NOT_EXAM_NUM
        FROM   SYS_DICT SD
        LEFT JOIN (
            select rdr.spe_id,count(rdr.spe_id) as not_num
            from  res_doctor_recruit rdr
            left join res_doctor rd on rdr.doctor_flow = rd.doctor_flow
            left join RES_DOCTOR_SCH_PROCESS rdsp on rdsp.user_flow = rdr.doctor_flow
            where rdsp.record_status = 'Y'
            and rdr.record_status = 'Y'
            and rd.record_status = 'Y'
            <if test="docTypeList!=null and docTypeList.size>0">
                AND rd.doctor_type_id IN
                <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item}</foreach>
            </if>
            and rdsp.SCH_END_DATE >= #{startDate}
            and rdsp.SCH_END_DATE <![CDATA[<]]> #{endDate}
            <if test="orgFlows!=null and orgFlows.size>0">
                AND rdsp.ORG_FLOW IN
                <foreach collection="orgFlows" open="(" separator="," close=")" item="item">#{item}</foreach>
            </if>
            <if test="orgFlow!=null and orgFlow!=''">
                AND RDSP.ORG_FLOW = #{orgFlow}
            </if>
            <if test="sessionNumber!=null and sessionNumber!=''">
                AND rdr.session_number = #{sessionNumber}
            </if>
            AND NOT EXISTS (SELECT 1
                FROM res_sch_process_express e
                WHERE e.process_flow = rdsp.process_flow
                AND e.record_status = 'Y'
                AND e.rec_type_id = 'AfterEvaluation'
            )
            group by rdr.spe_id
        ) A ON A.SPE_ID = SD.DICT_ID
        LEFT JOIN (
            select rdr.spe_id,count(rdr.spe_id) as not_test_num
            from  res_doctor_recruit rdr
            left join res_doctor rd on rdr.doctor_flow = rd.doctor_flow
            left join RES_DOCTOR_SCH_PROCESS rdsp on rdsp.user_flow = rdr.doctor_flow
            left join jsres_power_cfg rpc3 on 'jsres_doctor_exam_' || rdsp.user_flow = rpc3.cfg_code
            where rdsp.record_status = 'Y'
            and rdr.record_status = 'Y'
            and rd.record_status = 'Y'
            and rpc3.record_status = 'Y'
            and rpc3.cfg_value = 'Y'
            <if test="docTypeList!=null and docTypeList.size>0">
                AND rd.doctor_type_id IN
                <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item}</foreach>
            </if>
            and rdsp.SCH_END_DATE >= #{startDate}
            and rdsp.SCH_END_DATE <![CDATA[<]]> #{endDate}
            <if test="orgFlows!=null and orgFlows.size>0">
                AND rdsp.ORG_FLOW IN
                <foreach collection="orgFlows" open="(" separator="," close=")" item="item">#{item}</foreach>
            </if>
            <if test="orgFlow!=null and orgFlow!=''">
                AND RDSP.ORG_FLOW = #{orgFlow}
            </if>
            <if test="sessionNumber!=null and sessionNumber!=''">
                AND rdr.session_number = #{sessionNumber}
            </if>
            and not exists (
                select 1 from res_score
                where record_status = 'Y'
                and score_type_id = 'DeptScore'
                and rdsp.process_flow = process_flow
                and rdsp.user_flow = doctor_flow
            )
            group by rdr.spe_id
        ) B ON B.SPE_ID = SD.DICT_ID
        where sd.record_status = 'Y'
        and (sd.DICT_TYPE_ID = 'DoctorTrainingSpe'
        or sd.DICT_TYPE_ID = 'AssiGeneral')
        <if test="speId!=null and speId!=''">
            AND sd.dict_id = #{speId}
        </if>
        order by sd.dict_id
    </select>
    
    <select id="searchDocCKYCBySpeId" parameterType="java.util.Map" resultType="map">
        select rdr.spe_id,rdr.session_number,count(rdr.spe_id) as not_num
        from  res_doctor_recruit rdr
        left join res_doctor rd on rdr.doctor_flow = rd.doctor_flow
        left join RES_DOCTOR_SCH_PROCESS rdsp on rdsp.user_flow = rdr.doctor_flow
        where rdsp.record_status = 'Y'
        and rdr.record_status = 'Y'
        and rd.record_status = 'Y'
        <if test="docTypeList!=null and docTypeList.size>0">
            AND rd.doctor_type_id IN
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and rdsp.SCH_END_DATE >= #{startDate}
        and rdsp.SCH_END_DATE <![CDATA[<]]> #{endDate}
        <if test="orgFlows!=null and orgFlows.size>0">
            AND rdsp.ORG_FLOW IN
            <foreach collection="orgFlows" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test="orgFlow!=null and orgFlow!=''">
            AND RDSP.ORG_FLOW = #{orgFlow}
        </if>
        <if test="sessionNumber!=null and sessionNumber!=''">
            AND rdr.session_number = #{sessionNumber}
        </if>
        and rdr.spe_id = #{speId}
        AND NOT EXISTS (SELECT 1
            FROM res_sch_process_express e
            WHERE e.process_flow = rdsp.process_flow
            AND e.record_status = 'Y'
            AND e.rec_type_id = 'AfterEvaluation'
        )
        group by rdr.spe_id,rdr.session_number
        order by rdr.session_number
    </select>
    
    <select id="searchDocCKYCBySpeId2" parameterType="java.util.Map" resultType="map">
        select rdr.spe_id,rdr.session_number,count(rdr.spe_id) as not_test_num
        from  res_doctor_recruit rdr
        left join res_doctor rd on rdr.doctor_flow = rd.doctor_flow
        left join RES_DOCTOR_SCH_PROCESS rdsp on rdsp.user_flow = rdr.doctor_flow
        left join jsres_power_cfg rpc3 on 'jsres_doctor_exam_' || rdsp.user_flow = rpc3.cfg_code
        where rdsp.record_status = 'Y'
        and rdr.record_status = 'Y'
        and rd.record_status = 'Y'
        and rpc3.record_status = 'Y'
        and rpc3.cfg_value = 'Y'
        <if test="docTypeList!=null and docTypeList.size>0">
            AND rd.doctor_type_id IN
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and rdsp.SCH_END_DATE >= #{startDate}
        and rdsp.SCH_END_DATE <![CDATA[<]]> #{endDate}
        <if test="orgFlows!=null and orgFlows.size>0">
            AND rdsp.ORG_FLOW IN
            <foreach collection="orgFlows" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test="orgFlow!=null and orgFlow!=''">
            AND RDSP.ORG_FLOW = #{orgFlow}
        </if>
        <if test="sessionNumber!=null and sessionNumber!=''">
            AND rdr.session_number = #{sessionNumber}
        </if>
        and rdr.spe_id = #{speId}
        and not exists (
            select 1 from res_score
            where record_status = 'Y'
            and score_type_id = 'DeptScore'
            and rdsp.process_flow = process_flow
            and rdsp.user_flow = doctor_flow
        )
        group by rdr.spe_id,rdr.session_number
        order by rdr.session_number
    </select>

    <resultMap type="HashMap" id="notNumMap">
        <result property="doctorName" column="DOCTOR_NAME" javaType="string"/>
        <result property="sessionNumber" column="SESSION_NUMBER" javaType="string"/>
        <result property="trainingSpeName" column="TRAINING_SPE_NAME" javaType="string"/>
        <result property="schDeptName" column="SCH_DEPT_NAME" javaType="string"/>
        <result property="schStartDate" column="SCH_START_DATE" javaType="string"/>
        <result property="schEndDate" column="SCH_END_DATE" javaType="string"/>
        <result property="userPhone" column="USER_PHONE" javaType="string"/>
        <result property="sexName" column="SEX_NAME" javaType="string"/>
        <result property="trainingSpeId" column="TRAINING_SPE_ID" javaType="string"/>
        <result property="doctorFlow" column="USER_FLOW" javaType="string"/>
    </resultMap>
    <select id="searchNotNumListInfo" parameterType="java.util.Map" resultMap="notNumMap">
        select rdsp.org_flow,RDSP.USER_FLOW,RD.DOCTOR_NAME,RD.SESSION_NUMBER,
            RD.TRAINING_SPE_ID,RD.TRAINING_SPE_NAME,RDSP.SCH_DEPT_FLOW,
            RDSP.SCH_DEPT_NAME,RDSP.SCH_START_DATE,RDSP.SCH_END_DATE,
            SU.SEX_NAME,SU.USER_PHONE
        from RES_DOCTOR_SCH_PROCESS rdsp
        left join res_doctor rd on rdsp.user_flow = rd.doctor_flow
        LEFT JOIN SYS_USER SU ON RDSP.USER_FLOW = SU.USER_FLOW
        left join res_doctor_recruit rdr on rdsp.user_flow = rdr.doctor_flow
        where rdsp.record_status = 'Y'
        and rd.record_status = 'Y'
        AND SU.RECORD_STATUS = 'Y'
        and rdr.record_status = 'Y'
        <if test="docTypeList!=null and docTypeList.size>0">
            AND rd.doctor_type_id IN
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and rdsp.SCH_END_DATE >= #{startDate}
        and rdsp.SCH_END_DATE <![CDATA[<]]> #{endDate}
        AND NOT EXISTS (SELECT 1
            FROM res_sch_process_express e
            WHERE e.process_flow = rdsp.process_flow
            AND e.record_status = 'Y'
            AND e.rec_type_id = 'AfterEvaluation'
        )
        <if test="orgFlows!=null and orgFlows.size>0">
            AND rdsp.ORG_FLOW IN
            <foreach collection="orgFlows" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test="orgFlow2!=null and orgFlow2!=''">
            AND RDSP.ORG_FLOW = #{orgFlow2}
        </if>
        <if test="trainingSpeId!=null and trainingSpeId!=''">
            AND rdr.spe_id = #{trainingSpeId}
        </if>
        <if test="sessionNumber!=null and sessionNumber!=''">
            AND rdr.session_number = #{sessionNumber}
        </if>
        <if test="doctorFlows!=null and doctorFlows.size>0">
            AND rdsp.user_flow IN
            <foreach collection="doctorFlows" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
    </select>

    <select id="searchNotExamNumListInfo" parameterType="java.util.Map" resultMap="notNumMap">
        select rdsp.org_flow,RDSP.USER_FLOW,RD.DOCTOR_NAME,RD.SESSION_NUMBER,
            RD.TRAINING_SPE_ID,RD.TRAINING_SPE_NAME,RDSP.SCH_DEPT_FLOW,
            RDSP.SCH_DEPT_NAME,RDSP.SCH_START_DATE,RDSP.SCH_END_DATE,
            SU.SEX_NAME,SU.USER_PHONE
        from RES_DOCTOR_SCH_PROCESS rdsp
        left join res_doctor rd on rdsp.user_flow = rd.doctor_flow
        LEFT JOIN SYS_USER SU ON RDSP.USER_FLOW = SU.USER_FLOW
        left join res_doctor_recruit rdr on rdsp.user_flow = rdr.doctor_flow
        left join jsres_power_cfg rpc3 on 'jsres_doctor_exam_' || rdsp.user_flow = rpc3.cfg_code
        where rdsp.record_status = 'Y'
        and rd.record_status = 'Y'
        AND SU.RECORD_STATUS = 'Y'
        and rdr.record_status = 'Y'
        and rpc3.record_status = 'Y'
        and rpc3.cfg_value = 'Y'
        <if test="docTypeList!=null and docTypeList.size>0">
            AND rd.doctor_type_id IN
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and rdsp.SCH_END_DATE >= #{startDate}
        and rdsp.SCH_END_DATE <![CDATA[<]]> #{endDate}
        and not exists (
            select 1 from res_score
            where record_status = 'Y'
            and score_type_id = 'DeptScore'
            and rdsp.process_flow = process_flow
            and rdsp.user_flow = doctor_flow
        )
        <if test="orgFlows!=null and orgFlows.size>0">
            AND rdsp.ORG_FLOW IN
            <foreach collection="orgFlows" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test="orgFlow2!=null and orgFlow2!=''">
            AND RDSP.ORG_FLOW = #{orgFlow2}
        </if>
        <if test="trainingSpeId!=null and trainingSpeId!=''">
            AND rdr.spe_id = #{trainingSpeId}
        </if>
        <if test="sessionNumber!=null and sessionNumber!=''">
            AND rdr.session_number = #{sessionNumber}
        </if>
        <if test="doctorFlows!=null and doctorFlows.size>0">
            AND rdsp.user_flow IN
            <foreach collection="doctorFlows" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
    </select>

    <resultMap type="HashMap" id="docExceptionMap">
        <result property="id" column="ID" javaType="string"/>
        <result property="pid" column="PID" javaType="string"/>
        <result property="orgFlow" column="ORG_FLOW" javaType="string"/>
        <result property="orgCode" column="ORG_CODE" javaType="string"/>
        <result property="orgName" column="ORG_NAME" javaType="string"/>
        <result property="outException" column="NOT_NUM" javaType="string"/>
        <result property="outExamException" column="NOT_EXAM_NUM" javaType="string"/>
    </resultMap>
    <select id="searchDocCycleListOrg" parameterType="map" resultMap="docExceptionMap">
        SELECT SO.ORG_FLOW AS ID, SO.ORG_NAME,SO.ORG_CODE, TO_NUMBER(NVL(NOT_NUM, 0)) AS NOT_NUM, TO_NUMBER(NVL(NOT_TEST_NUM, 0)) AS NOT_EXAM_NUM,
        CASE
        WHEN EXISTS (SELECT 1 FROM RES_JOINT_ORG WHERE RECORD_STATUS = 'Y' AND JOINT_ORG_FLOW = SO.ORG_FLOW)
        THEN (SELECT MAX(ORG_FLOW) FROM RES_JOINT_ORG WHERE RECORD_STATUS = 'Y' AND JOINT_ORG_FLOW = SO.ORG_FLOW)
        ELSE NULL
        END AS PID
        FROM SYS_ORG SO
        LEFT JOIN (
            SELECT RDSP.ORG_FLOW, COUNT(RDSP.ORG_FLOW) AS not_num
            FROM res_doctor_recruit rdr
            LEFT JOIN res_doctor rd ON rdr.doctor_flow = rd.doctor_flow
            LEFT JOIN RES_DOCTOR_SCH_PROCESS rdsp ON rdsp.user_flow = rdr.doctor_flow
            WHERE rdsp.record_status = 'Y'
            AND rdr.record_status = 'Y'
            AND rd.record_status = 'Y'
            <if test="docTypeList!=null and docTypeList.size>0">
                AND rd.doctor_type_id IN
                <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item}</foreach>
            </if>
            and rdsp.SCH_END_DATE >= #{startDate}
            and rdsp.SCH_END_DATE <![CDATA[<]]> #{endDate}
            AND NOT EXISTS (SELECT 1
                FROM res_sch_process_express e
                WHERE e.process_flow = rdsp.process_flow
                AND e.record_status = 'Y'
                AND e.rec_type_id = 'AfterEvaluation')
            GROUP BY RDSP.ORG_FLOW
        ) A ON A.ORG_FLOW = SO.ORG_FLOW
        LEFT JOIN (
            SELECT RDSP.ORG_FLOW, COUNT(RDSP.ORG_FLOW) AS not_test_num
            FROM res_doctor_recruit rdr
            LEFT JOIN res_doctor rd ON rdr.doctor_flow = rd.doctor_flow
            LEFT JOIN RES_DOCTOR_SCH_PROCESS rdsp ON rdsp.user_flow = rdr.doctor_flow
            LEFT JOIN jsres_power_cfg rpc3 ON ('jsres_doctor_exam_' || rdsp.user_flow) = rpc3.cfg_code
            WHERE rdsp.record_status = 'Y'
            AND rdr.record_status = 'Y'
            AND rd.record_status = 'Y'
            AND rpc3.record_status = 'Y'
            AND rpc3.cfg_value = 'Y'
            <if test="docTypeList!=null and docTypeList.size>0">
                AND rd.doctor_type_id IN
                <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item}</foreach>
            </if>
            and rdsp.SCH_END_DATE >= #{startDate}
            and rdsp.SCH_END_DATE <![CDATA[<]]> #{endDate}
            AND NOT EXISTS (SELECT 1
                FROM res_score
                WHERE record_status = 'Y'
                AND score_type_id = 'DeptScore'
                AND rdsp.process_flow = process_flow
                AND rdsp.user_flow = doctor_flow)
            GROUP BY RDSP.ORG_FLOW
        ) B ON B.ORG_FLOW = SO.ORG_FLOW
        WHERE so.record_status = 'Y'
        AND so.org_type_id = 'Hospital'
        AND SO.ORG_PROV_ID = '320000'
        and so.org_code is not null
        ORDER BY so.org_code
    </select>

    <select id="searchDataStatistics" parameterType="map" resultMap="com.pinde.sci.dao.base.JsresDataStatisticsMapper.BaseResultMap">
        select * from jsres_data_statistics
        where record_status = 'Y'
        <if test="monthDate!=null and monthDate!=''">
            AND month_date = #{monthDate}
        </if>
    </select>

    <select id="searchVisitsList" parameterType="map" resultType="map">
        select
          (select count(1) from sys_log a
          left join sys_user_role b on a.user_flow = b.user_flow
          where b.role_flow = #{doctorRoleFlow} and b.record_status='Y' and a.record_status='Y'
          and a.oper_id in('LogIn','AppLogin') and a.create_time like CONCAT(#{monthDate2},'%')) as doctor_number ,
          (select count(1) from sys_log a
          left join sys_user_role b on a.user_flow = b.user_flow
          where b.role_flow in
            <foreach collection="teacherRoleFlows" open="(" separator="," close=")" item="item">#{item}</foreach>
          and b.record_status='Y' and a.record_status='Y'
          and a.oper_id in('LogIn','AppLogin') and a.create_time like CONCAT(#{monthDate2},'%') as teacher_number ,
         (select count(1) from sys_log a
          left join sys_user_role b on a.user_flow = b.user_flow
          where b.role_flow = #{orgRoleFlow} and b.record_status='Y' and a.record_status='Y'
          and a.oper_id in('LogIn','AppLogin') and a.create_time like CONCAT(#{monthDate2},'%')  as org_number
        from dual
    </select>

    <select id="searchMonthDataList" parameterType="map" resultMap="com.pinde.sci.dao.base.JsresMonthStatisticsMapper.BaseResultMap">
        select * from jsres_month_statistics
        where record_status = 'Y'
        <if test="monthDate!=null and monthDate!=''">
            AND month_date = #{monthDate}
        </if>
    </select>

</mapper>