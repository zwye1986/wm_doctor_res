<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pinde.sci.dao.res.ResInprocessInfoMemberExtMapper">
   <update id="deleteMemberNotInFlow">
       UPDATE  RES_INPROCESS_INFO_MEMBER
       SET RECORD_STATUS='N',MODIFY_TIME=to_char(sysdate,'YYYYMMDDHH24MISS')
       WHERE RECORD_STATUS='Y'
       AND INFO_RECORD_FLOW=#{recordFlow}
       <if test='memberFlows!=null and memberFlows.size()>0'>
           AND RECORD_FLOW NOT IN
           <foreach collection="memberFlows" close=")" item="flows" open="(" separator=",">
               #{flows}
           </foreach>
       </if>
   </update>
    <select id="readInfoList" resultMap="com.pinde.sci.dao.base.ResInprocessInfoMapper.ResultMapWithBLOBs">
        SELECT RII.* FROM SYS_DEPT D
        JOIN RES_INPROCESS_INFO RII
        ON D.DEPT_FLOW=RII.DEPT_FLOW
        AND D.ORG_FLOW=RII.ORG_FLOW
        WHERE D.RECORD_STATUS='Y'
        AND RII.RECORD_STATUS='Y'
        AND D.ORG_FLOW= #{orgFlow}
    </select>
    <select id="readInfoList4Global" resultMap="com.pinde.sci.dao.base.ResInprocessInfoMapper.ResultMapWithBLOBs">
        SELECT RII.* FROM SYS_DEPT D
        JOIN RES_INPROCESS_INFO RII
        ON D.DEPT_FLOW=RII.DEPT_FLOW
        AND D.ORG_FLOW=RII.ORG_FLOW
        WHERE D.RECORD_STATUS='Y'
        AND RII.RECORD_STATUS='Y'
        <if test="orgFlow!=null and orgFlow!=''">
            AND D.ORG_FLOW= #{orgFlow}
        </if>
        <if test="orgFlowList!=null and orgFlowList.size>0">
            and D.org_flow in
            <foreach collection="orgFlowList" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        <if test="deptFlow!=null and deptFlow!=''">
            AND D.DEPT_FLOW= #{deptFlow}
        </if>
        order by RII.ORG_FLOW,RII.DEPT_FLOW,RII.CREATE_TIME DESC
    </select>

</mapper>