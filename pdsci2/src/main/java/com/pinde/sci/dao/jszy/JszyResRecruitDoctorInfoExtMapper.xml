<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pinde.sci.dao.jszy.JszyResRecruitDoctorInfoExtMapper">
    <resultMap type="HashMap" id="zlxytjMap">
        <result  property="orgFlow" column="ORG_FLOW" javaType="string"/>
        <result property="speId" column="SPE_ID" javaType="string"/>
        <result property="secondSpeId" column="SECOND_SPE_ID" javaType="string"/>
        <result property="secondSpeName" column="SECOND_SPE_NAME" javaType="string"/>
        <result property="num" column="NUM" javaType="integer"/>
    </resultMap>
    <select id="zltjSecondSpe"  parameterType="java.util.Map" resultMap="zlxytjMap">
  SELECT T.ORG_FLOW,
       T.SPE_ID,
       T.SECOND_SPE_ID,
       NVL(T.SECOND_SPE_NAME, 'æ— ') AS SECOND_SPE_NAME,
       T.SESSION_NUMBER,
       COUNT(1) AS NUM
  FROM JSRES_RECRUIT_DOC_INFO T
  LEFT JOIN RES_DOCTOR RD ON T.DOCTOR_FLOW = RD.DOCTOR_FLOW
  LEFT JOIN SYS_USER U ON T.DOCTOR_FLOW = U.USER_FLOW
 WHERE T.RECORD_STATUS = 'Y'
   AND T.ORG_FLOW IN (SELECT ORG_FLOW
                          FROM PDSCI.SYS_ORG
                         WHERE PDSCI.SYS_ORG.RECORD_STATUS = 'Y'
                           AND ORG_PROV_ID = '320000')
   AND U.RECORD_STATUS = 'Y'
        <if test="docTypeList!=null and docTypeList.size>0">
            and rd.DOCTOR_TYPE_ID in
            <foreach collection="docTypeList" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
        and t.session_number is not null
        <if test="trainYears!=null and trainYears!=''">
            and t.train_Year in
            <foreach collection="trainYears" open="(" separator="," close=")" item="item">#{item}</foreach>
        </if>
   AND  T.SESSION_NUMBER =#{sessionNumber}
   AND T.ORG_FLOW = #{orgFlow}
   AND T.SPE_ID = #{speId}
 GROUP BY T.ORG_FLOW,
          T.SPE_ID,
          T.SECOND_SPE_ID,
          T.SECOND_SPE_NAME,
          T.SESSION_NUMBER
        ORDER BY T.SECOND_SPE_ID
    </select>
</mapper>
