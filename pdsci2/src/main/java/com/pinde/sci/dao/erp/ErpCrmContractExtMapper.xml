<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pinde.sci.dao.erp.ErpCrmContractExtMapper">
   <resultMap id="erpCrmContractExtMap" type="com.pinde.sci.model.erp.ErpCrmContractExt" extends="com.pinde.sci.dao.base.ErpCrmContractMapper.BaseResultMap" >
     <association property="customer" column="customer_flow" resultMap="com.pinde.sci.dao.base.ErpCrmCustomerMapper.BaseResultMap"></association>
   </resultMap>
    <resultMap id="erpCrmContractLicExtMap" type="com.pinde.sci.model.erp.ErpCrmContractLicExt" extends="com.pinde.sci.dao.base.ErpCrmContractMapper.BaseResultMap" >
        <association property="customer" column="customer_flow" resultMap="com.pinde.sci.dao.base.ErpCrmCustomerMapper.BaseResultMap"></association>
        <association property="licKey" column="LIC_FLOW" resultMap="com.pinde.sci.dao.base.ErpOaLicKeyMapper.BaseResultMap"></association>
    </resultMap>
   <select id="searchContractList" parameterType="java.util.Map" resultMap="erpCrmContractExtMap">
      select erco.*,
             ercu.customer_name
       from pdsci.erp_crm_contract erco
       left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
       where erco.record_status='Y' and ercu.record_status='Y'
       <if test='customer!=null'>
         <if test='customer.customerName!=null and customer.customerName!=""'>
       		<if test='isLike==1'>
                <bind name="customerName" value="'%'+customer.customerName+'%'"/>
                and (ercu.customer_name like #{customerName}
                or ercu.alias_name like #{customerName})
            </if>
            <if test='isLike==null or isLike==""'>
                and ercu.customer_name = #{customer.customerName}
            </if>
         </if>
         <if test='customer.customerProvId!=null and customer.customerProvId!=""'>
            and ercu.customer_prov_id = #{customer.customerProvId}
         </if>
         <if test='customer.customerCityId!=null and customer.customerCityId!=""'>
            and ercu.customer_city_id = #{customer.customerCityId}
         </if> 
         <if test='customer.customerAreaId!=null and customer.customerAreaId!=""'>
            and ercu.customer_area_id = #{customer.customerAreaId}
         </if>         
       </if>
       <if test='currUserFlow!=null and currUserFlow!=""'>
   			and ercu.CUSTOMER_PROV_ID in(
				select  PROV_ID
    			from pdsci.ERP_USER_REGION_POPEDOM
    			where USER_FLOW = #{currUserFlow}
	   			and RECORD_STATUS ='Y'
			)
   		</if>
   		<if test='bigRegionTypeIdList!=null'>
   			and ercu.CUSTOMER_PROV_ID in
		   <foreach item="item" index="index" collection="bigRegionTypeIdList" open="(" separator="," close=")">  
		  	#{item}  
		   </foreach>
   		</if>
        <if test='deptFlow!=null and deptFlow!=""'>
            and erco.sign_dept_flow=#{deptFlow}
       </if>
       <if test='contract!=null'>
         <if test='contract.contractNo!=null and contract.contractNo!=""'>
            <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
            and contract_no like #{contractNo}
         </if>
         <if test='contract.contractName!=null and contract.contractName!=""'>
           <bind name="contractName" value="'%'+contract.contractName+'%'"/>
            and contract_name like #{contractName}
         </if>
         <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
            and contract_Flow=#{contract.contractFlow}
         </if>
         <if test='contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
            and maintain_Due_Date=#{contract.contractFlow}
         </if>
         <if test='contract.signDate!=null and contract.signDate!=""'>
            and sign_Date=#{contract.signDate}
         </if>
         <if test='contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
            and contract_Category_Id=#{contract.contractCategoryId}
         </if>
          <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
            and contract_Type_Id=#{contract.contractTypeId}
         </if>
         <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
            and contract_Status_Id=#{contract.contractStatusId}
         </if>
          <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
            and sign_Dept_Flow=#{contract.signDeptFlow}
         </if>
         <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
            and sign_user_Flow=#{contract.signUserFlow}
         </if>
         <if test='owner==null or owner==""'>
             <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
                 and charge_user_Flow=#{contract.chargeUserFlow}
             </if>
             <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
                 and charge_user2_Flow=#{contract.chargeUser2Flow}
             </if>
         </if>
         <if test='owner!=null and owner!=""'>
             <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""and (contract.chargeUser2Flow==null or contract.chargeUser2Flow=="")'>
                 and charge_user_Flow=#{contract.chargeUserFlow}
             </if>
             <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!="" and (contract.chargeUserFlow==null or contract.chargeUserFlow=="")'>
                 and charge_user2_Flow=#{contract.chargeUser2Flow}
             </if>
             <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!="" and contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
                and (
                  charge_user2_Flow=#{contract.chargeUser2Flow}
                 or
                  charge_user_Flow=#{contract.chargeUserFlow}
                 )
             </if>
         </if>
         <if test='createDateStart!=null and createDateStart!=""'>
            and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
         </if>
         <if test='createDateEnd!=null and createDateEnd!=""'>
            and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
         </if>
         <if test='signDateStart!=null and signDateStart!=""'>
            and sign_date >= #{signDateStart}
         </if>
         <if test='signDateEnd!=null and signDateEnd!=""'>
            and sign_date <![CDATA[ <= ]]> #{signDateEnd}
         </if>
         <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
            and maintain_Due_Date >= #{maintainDueDateStart}
         </if>
         <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
            and maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
         </if>
         <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
            and contract_Due_Date >= #{contractDueDateStart}
         </if>
         <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
            and contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
         </if>
       </if>
       <if test='noSecond=="Y"'>
            and contract_Category_Id !='Second'
       </if>
       <if test='notCG=="Y"'>
           and  erco.contract_Category_Id !='Purchase'
       </if>
       <if test='maintainDue=="Y"'>
            and maintain_Due_Date <![CDATA[ < ]]> #{currDate}
       </if>
       <if test='refContractFlowList!=null'>
          and contract_flow in
		   <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">  
		  	#{item}  
		   </foreach>
       </if>
       <if test='orderByCase!=null and orderByCase!=""'>
           <if test="orderByCase=='CONTRACT_NO'">
               order by erco.CONTRACT_NO
           </if>
           <if test="orderByCase=='CONTRACT_ARCHIVES_NO'">
               order by erco.CONTRACT_ARCHIVES_NO
           </if>
           <if test="orderByCase=='CUSTOMER_NAME'">
               order by ercu.customer_name
           </if>
           <if test="orderByCase=='CONTRACT_NAME'">
               order by erco.CONTRACT_NAME
           </if>
           <if test="orderByCase=='CONTRACT_CATEGORY_NAME'">
               order by erco.CONTRACT_CATEGORY_NAME
           </if>
           <if test="orderByCase=='CONTRACT_TYPE_NAME'">
               order by erco.CONTRACT_TYPE_NAME
           </if>
           <if test="orderByCase=='SIGN_DEPT_NAME'">
               order by erco.SIGN_DEPT_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER_NAME'">
               order by erco.CHARGE_USER_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER2_NAME'">
               order by erco.CHARGE_USER2_NAME
           </if>
           <if test="orderByCase=='CONTRACT_STATUS_NAME'">
               order by erco.CONTRACT_STATUS_NAME
           </if>
           <if test="orderByCase=='SIGN_DATE'">
               order by erco.sign_date
           </if>
           <if test="orderByCase=='CREATE_TIME'">
               order by erco.create_time
           </if>
           <if test="orderByCase=='CONTRACT_DUE_DATE'">
               order by erco.CONTRACT_DUE_DATE
           </if>
           <if test="orderByCase=='MAINTAIN_DUE_DATE'">
               order by erco.MAINTAIN_DUE_DATE
           </if>
            <if test='orderAction!=null and orderAction!=""'>
                <if test="orderAction=='desc'">
                    desc
                </if>
                <if test="orderAction=='asc'">
                    asc
                </if>
           </if>
           <if test='orderByCase!=null and orderByCase !="" and (orderAction==null or orderAction=="")'>
               ,erco.CONTRACT_NO desc
           </if>
       </if>
       <if test='orderByCase==null or orderByCase ==""'>
           order by erco.sign_date desc,erco.create_time desc,erco.CONTRACT_NO desc
       </if>
   </select>
   <select id="getEmptyBuildInfoByFlow"  resultMap="com.pinde.sci.dao.base.ErpCrmProductBuildInfoMapper.BaseResultMap">
      select *
       from pdsci.ERP_CRM_PRODUCT_BUILD_INFO erco
       where record_status='Y'
       and rownum=1
       and (
           BUILDING_USER_NAME is not null
           and BUILDING_ADDRESS is not null
           and TRAVEL_DATE is not null
           and BUILDING_DATE is not null
           and ACCEPT_DATE is not null
           and ORDER_NO is not null
       )
       and contract_flow=#{contractFlow}
   </select>
    <resultMap id="erpCrmContractExtNewMap" type="com.pinde.sci.model.erp.ErpCrmContractExt" extends="com.pinde.sci.dao.base.ErpCrmContractMapper.BaseResultMap" >
        <association property="customer" column="customer_flow" resultMap="com.pinde.sci.dao.base.ErpCrmCustomerMapper.BaseResultMap"></association>
    </resultMap>
   <select id="searchErpContractListNew" parameterType="java.util.Map" resultMap="erpCrmContractExtNewMap">
      select erco.*,
             ercu.customer_name
       from pdsci.erp_crm_contract erco
       left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
       where erco.record_status='Y' and ercu.record_status='Y'
       <if test='customer!=null'>
         <if test='customer.customerName!=null and customer.customerName!=""'>
       		<if test='isLike==1'>
                <bind name="customerName" value="'%'+customer.customerName+'%'"/>
                and (ercu.customer_name like #{customerName}
                or ercu.alias_name like #{customerName})
            </if>
            <if test='isLike==null or isLike==""'>
                and ercu.customer_name = #{customer.customerName}
            </if>
         </if>
         <if test='customer.customerProvId!=null and customer.customerProvId!=""'>
            and ercu.customer_prov_id = #{customer.customerProvId}
         </if>
         <if test='customer.customerCityId!=null and customer.customerCityId!=""'>
            and ercu.customer_city_id = #{customer.customerCityId}
         </if>
         <if test='customer.customerAreaId!=null and customer.customerAreaId!=""'>
            and ercu.customer_area_id = #{customer.customerAreaId}
         </if>
       </if>
       <if test='currUserFlow!=null and currUserFlow!=""'>
   			and ercu.CUSTOMER_PROV_ID in(
				select  PROV_ID
    			from pdsci.ERP_USER_REGION_POPEDOM
    			where USER_FLOW = #{currUserFlow}
	   			and RECORD_STATUS ='Y'
			)
   		</if>
   		<if test='bigRegionTypeIdList!=null'>
   			and ercu.CUSTOMER_PROV_ID in
		   <foreach item="item" index="index" collection="bigRegionTypeIdList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
   		<if test='notInStatus!=null'>
   			and erco.contract_Status_Id not in
		   <foreach item="item" index="index" collection="notInStatus" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
        <if test='deptFlow!=null and deptFlow!=""'>
            and erco.sign_dept_flow=#{deptFlow}
       </if>
       <if test='contract!=null'>
         <if test='contract.contractNo!=null and contract.contractNo!=""'>
            <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
            and erco.contract_no like #{contractNo}
         </if>
         <if test='contract.contractName!=null and contract.contractName!=""'>
           <bind name="contractName" value="'%'+contract.contractName+'%'"/>
            and erco.contract_name like #{contractName}
         </if>
         <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
            and erco.contract_Flow=#{contract.contractFlow}
         </if>
         <if test='contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
            and erco.maintain_Due_Date=#{contract.contractFlow}
         </if>
         <if test='contract.signDate!=null and contract.signDate!=""'>
            and erco.sign_Date=#{contract.signDate}
         </if>
         <if test='contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
            and erco.contract_Category_Id=#{contract.contractCategoryId}
         </if>
          <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
            and erco.contract_Type_Id=#{contract.contractTypeId}
         </if>
         <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
            and erco.contract_Status_Id=#{contract.contractStatusId}
         </if>
          <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
            and erco.sign_Dept_Flow=#{contract.signDeptFlow}
         </if>
         <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
            and erco.sign_user_Flow=#{contract.signUserFlow}
         </if>
         <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
            and erco.charge_user_Flow=#{contract.chargeUserFlow}
         </if>
         <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
            and erco.charge_user2_Flow=#{contract.chargeUser2Flow}
         </if>
           <if test='createDateStart!=null and createDateStart!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
           </if>
           <if test='createDateEnd!=null and createDateEnd!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
           </if>
         <if test='signDateStart!=null and signDateStart!=""'>
            and erco.sign_date >= #{signDateStart}
         </if>
         <if test='signDateEnd!=null and signDateEnd!=""'>
            and erco.sign_date <![CDATA[ <= ]]> #{signDateEnd}
         </if>
         <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
            and erco.maintain_Due_Date >= #{maintainDueDateStart}
         </if>
         <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
            and erco.maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
         </if>
         <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
            and erco.contract_Due_Date >= #{contractDueDateStart}
         </if>
         <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
            and erco.contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
         </if>
       </if>
       <if test='notCG=="Y"'>
           and  erco.contract_Category_Id !='Purchase'
       </if>
       <if test='waitJH=="Y"'>
            and NOT exists (
               select 1
               from erp_crm_contract_pay_plan p
               where p.record_status='Y'
               and p.pay_fund=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where
                b.record_status='Y' and b.plan_flow=p.plan_flow and b.status_id='AuditPass' )
               and p.contract_flow=erco.contract_flow

           )
           AND erco.CONTRACT_FUND !=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_plan b where b.record_status='Y'  and b.contract_flow=erco.contract_flow)
       </if>
       <if test='waitKP=="Y"'>
            and exists (
               select 1
               from erp_crm_contract_pay_plan p
               where p.record_status='Y'
               and p.pay_fund!=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
               and b.status_id='AuditPass' and b.plan_flow=p.plan_flow )
               and p.contract_flow=erco.contract_flow
           )
           AND erco.CONTRACT_FUND !=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
           AND b.status_id = 'AuditPass'and   b.contract_flow=erco.contract_flow)
       </if>
       <if test='KXBH=="Y"'>
            and exists (
                   select 1
                   from erp_crm_contract_pay_balance p
                   where p.record_status='Y'
                   and p.status_id='AuditBack'
                   and p.contract_flow=erco.contract_flow
           )
       </if>
       <if test='waitAudit=="Y"'>
            and exists (
               select 1
               from erp_crm_contract_pay_balance p
               where p.record_status='Y'
                and p.status_id='Auditing'
               and p.contract_flow=erco.contract_flow
           )
       </if>
       <if test='maintainDue=="Y"'>
            and erco.maintain_Due_Date <![CDATA[ < ]]> #{currDate}
       </if>
       <if test='refContractFlowList!=null'>
          and erco.contract_flow in
		   <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
       </if>
       <if test='orderByCase!=null and orderByCase!=""'>
           <if test="orderByCase=='CONTRACT_NO'">
               order by erco.CONTRACT_NO
           </if>
           <if test="orderByCase=='CONTRACT_ARCHIVES_NO'">
               order by erco.CONTRACT_ARCHIVES_NO
           </if>
           <if test="orderByCase=='CUSTOMER_NAME'">
               order by ercu.customer_name
           </if>
           <if test="orderByCase=='CONTRACT_NAME'">
               order by erco.CONTRACT_NAME
           </if>
           <if test="orderByCase=='CONTRACT_CATEGORY_NAME'">
               order by erco.CONTRACT_CATEGORY_NAME
           </if>
           <if test="orderByCase=='CONTRACT_TYPE_NAME'">
               order by erco.CONTRACT_TYPE_NAME
           </if>
           <if test="orderByCase=='SIGN_DEPT_NAME'">
               order by erco.SIGN_DEPT_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER_NAME'">
               order by erco.CHARGE_USER_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER2_NAME'">
               order by erco.CHARGE_USER2_NAME
           </if>
           <if test="orderByCase=='CONTRACT_STATUS_NAME'">
               order by erco.CONTRACT_STATUS_NAME
           </if>
           <if test="orderByCase=='SIGN_DATE'">
               order by erco.sign_date
           </if>
           <if test="orderByCase=='CREATE_TIME'">
               order by erco.create_time
           </if>
           <if test="orderByCase=='CONTRACT_DUE_DATE'">
               order by erco.CONTRACT_DUE_DATE
           </if>
           <if test="orderByCase=='MAINTAIN_DUE_DATE'">
               order by erco.MAINTAIN_DUE_DATE
           </if>
            <if test='orderAction!=null and orderAction!=""'>
                <if test="orderAction=='desc'">
                    desc
                </if>
                <if test="orderAction=='asc'">
                    asc
                </if>
           </if>
           <if test='orderByCase!=null and orderByCase !="" and (orderAction==null or orderAction=="")'>
               ,erco.CONTRACT_NO desc
           </if>
       </if>
       <if test='orderByCase==null or orderByCase ==""'>
           order by erco.sign_date desc,erco.create_time desc,erco.CONTRACT_NO desc
       </if>
   </select>
   <select id="searchErpContractList2" parameterType="java.util.Map" resultMap="com.pinde.sci.dao.base.ErpCrmContractMapper.BaseResultMap">
      select erco.*
       from pdsci.erp_crm_contract erco
       where erco.record_status='Y'
   		<if test='notInStatus!=null'>
   			and erco.contract_Status_Id not in
		   <foreach item="item" index="index" collection="notInStatus" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
       <if test='contract!=null'>
         <if test='contract.contractName!=null and contract.contractName!=""'>
            and erco.contract_name  like '%${contract.contractName}%'
         </if>
         <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
            and erco.contract_Flow=#{contract.contractFlow}
         </if>
         <if test='contract.contractNo!=null and contract.contractNo!=""'>
            and erco.contract_no=#{contract.contractNo}
         </if>
          <if test='contract.customerFlow!=null and contract.customerFlow!=""'>
            and erco.customer_Flow=#{contract.customerFlow}
         </if>
           <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""and (contract.chargeUser2Flow==null or contract.chargeUser2Flow=="")'>
               and charge_user_Flow=#{contract.chargeUserFlow}
           </if>
           <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!="" and (contract.chargeUserFlow==null or contract.chargeUserFlow=="")'>
               and charge_user2_Flow=#{contract.chargeUser2Flow}
           </if>
           <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!="" and contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
               and (
               charge_user2_Flow=#{contract.chargeUser2Flow}
               or
               charge_user_Flow=#{contract.chargeUserFlow}
               )
           </if>
       </if>
           order by erco.sign_date desc
   </select>
   <select id="searchErpContractListNewMap" parameterType="java.util.Map" resultMap="cwysFundMap">
      select nvl(sum(erco.contract_fund),0) all_fund
       from pdsci.erp_crm_contract erco
       left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
       where erco.record_status='Y' and ercu.record_status='Y'
       <if test='customer!=null'>
         <if test='customer.customerName!=null and customer.customerName!=""'>
       		<if test='isLike==1'>
                <bind name="customerName" value="'%'+customer.customerName+'%'"/>
                and (ercu.customer_name like #{customerName}
                or ercu.alias_name like #{customerName})
            </if>
            <if test='isLike==null or isLike==""'>
                and ercu.customer_name = #{customer.customerName}
            </if>
         </if>
         <if test='customer.customerProvId!=null and customer.customerProvId!=""'>
            and ercu.customer_prov_id = #{customer.customerProvId}
         </if>
         <if test='customer.customerCityId!=null and customer.customerCityId!=""'>
            and ercu.customer_city_id = #{customer.customerCityId}
         </if>
         <if test='customer.customerAreaId!=null and customer.customerAreaId!=""'>
            and ercu.customer_area_id = #{customer.customerAreaId}
         </if>
       </if>
       <if test='currUserFlow!=null and currUserFlow!=""'>
   			and ercu.CUSTOMER_PROV_ID in(
				select  PROV_ID
    			from pdsci.ERP_USER_REGION_POPEDOM
    			where USER_FLOW = #{currUserFlow}
	   			and RECORD_STATUS ='Y'
			)
   		</if>
   		<if test='bigRegionTypeIdList!=null'>
   			and ercu.CUSTOMER_PROV_ID in
		   <foreach item="item" index="index" collection="bigRegionTypeIdList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
   		<if test='notInStatus!=null'>
   			and erco.contract_Status_Id not in
		   <foreach item="item" index="index" collection="notInStatus" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
        <if test='deptFlow!=null and deptFlow!=""'>
            and erco.sign_dept_flow=#{deptFlow}
       </if>
       <if test='contract!=null'>
         <if test='contract.contractNo!=null and contract.contractNo!=""'>
            <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
            and erco.contract_no like #{contractNo}
         </if>
         <if test='contract.contractName!=null and contract.contractName!=""'>
           <bind name="contractName" value="'%'+contract.contractName+'%'"/>
            and erco.contract_name like #{contractName}
         </if>
         <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
            and erco.contract_Flow=#{contract.contractFlow}
         </if>
         <if test='contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
            and erco.maintain_Due_Date=#{contract.contractFlow}
         </if>
         <if test='contract.signDate!=null and contract.signDate!=""'>
            and erco.sign_Date=#{contract.signDate}
         </if>
         <if test='contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
            and erco.contract_Category_Id=#{contract.contractCategoryId}
         </if>
          <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
            and erco.contract_Type_Id=#{contract.contractTypeId}
         </if>
         <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
            and erco.contract_Status_Id=#{contract.contractStatusId}
         </if>
          <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
            and erco.sign_Dept_Flow=#{contract.signDeptFlow}
         </if>
         <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
            and erco.sign_user_Flow=#{contract.signUserFlow}
         </if>
         <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
            and erco.charge_user_Flow=#{contract.chargeUserFlow}
         </if>
         <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
            and erco.charge_user2_Flow=#{contract.chargeUser2Flow}
         </if>
           <if test='createDateStart!=null and createDateStart!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
           </if>
           <if test='createDateEnd!=null and createDateEnd!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
           </if>
         <if test='signDateStart!=null and signDateStart!=""'>
            and erco.sign_date >= #{signDateStart}
         </if>
         <if test='signDateEnd!=null and signDateEnd!=""'>
            and erco.sign_date <![CDATA[ <= ]]> #{signDateEnd}
         </if>
         <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
            and erco.maintain_Due_Date >= #{maintainDueDateStart}
         </if>
         <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
            and erco.maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
         </if>
         <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
            and erco.contract_Due_Date >= #{contractDueDateStart}
         </if>
         <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
            and erco.contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
         </if>
       </if>
       <if test='notCG=="Y"'>
           and  erco.contract_Category_Id !='Purchase'
       </if>
       <if test='waitJH=="Y"'>
            and NOT exists (
               select 1
               from erp_crm_contract_pay_plan p
               where p.record_status='Y'
               and p.pay_fund=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where
                b.record_status='Y' and b.plan_flow=p.plan_flow and b.status_id='AuditPass' )
               and p.contract_flow=erco.contract_flow

           )
           AND erco.CONTRACT_FUND !=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_plan b where b.record_status='Y'  and b.contract_flow=erco.contract_flow)
       </if>
       <if test='waitKP=="Y"'>
            and exists (
               select 1
               from erp_crm_contract_pay_plan p
               where p.record_status='Y'
               and p.pay_fund!=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
               and b.status_id='AuditPass' and b.plan_flow=p.plan_flow )
               and p.contract_flow=erco.contract_flow
           )
           AND erco.CONTRACT_FUND !=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
           AND b.status_id = 'AuditPass'and   b.contract_flow=erco.contract_flow)
       </if>
       <if test='KXBH=="Y"'>
            and exists (
                   select 1
                   from erp_crm_contract_pay_balance p
                   where p.record_status='Y'
                   and p.status_id='AuditBack'
                   and p.contract_flow=erco.contract_flow
           )
       </if>
       <if test='waitAudit=="Y"'>
            and exists (
               select 1
               from erp_crm_contract_pay_balance p
               where p.record_status='Y'
                and p.status_id='Auditing'
               and p.contract_flow=erco.contract_flow
           )
       </if>
       <if test='maintainDue=="Y"'>
            and erco.maintain_Due_Date <![CDATA[ < ]]> #{currDate}
       </if>
       <if test='refContractFlowList!=null'>
          and erco.contract_flow in
		   <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
       </if>
   </select>
    <resultMap id="auditMap" type="hashmap">
        <result column="all_num" jdbcType="INTEGER" property="num" />
        <result column="all_Fund" jdbcType="INTEGER" property="allFund" />
    </resultMap>
   <select id="waitPayAuditMap" parameterType="java.util.Map" resultMap="auditMap">
      select nvl(sum(p.PAY_FUND),0) all_fund,nvl(count(1),0) all_num
       from pdsci.erp_crm_contract erco
       left join erp_crm_contract_pay_balance p
        on p.contract_flow=erco.contract_flow
       where erco.record_status='Y'
       and p.record_status='Y'
       and p.status_id='Auditing'
   </select>
   <select id="waitBillAuditMap" parameterType="java.util.Map" resultMap="auditMap">
      select nvl(sum(p.BILL_FUND),0) all_fund,nvl(count(1),0) all_num
       from pdsci.erp_crm_contract erco
       left join erp_crm_contract_bill_balance p
        on p.contract_flow=erco.contract_flow
       where erco.record_status='Y'
       and p.record_status='Y'
       and p.status_id='Auditing'
   </select>
   <select id="searchErpContractListBillNew" parameterType="java.util.Map" resultMap="erpCrmContractExtNewMap">
      select erco.*,
             ercu.customer_name
       from pdsci.erp_crm_contract erco
       left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
       where erco.record_status='Y' and ercu.record_status='Y'
       <if test='customer!=null'>
         <if test='customer.customerName!=null and customer.customerName!=""'>
       		<if test='isLike==1'>
                <bind name="customerName" value="'%'+customer.customerName+'%'"/>
                and (ercu.customer_name like #{customerName}
                or ercu.alias_name like #{customerName})
            </if>
            <if test='isLike==null or isLike==""'>
                and ercu.customer_name = #{customer.customerName}
            </if>
         </if>
         <if test='customer.customerProvId!=null and customer.customerProvId!=""'>
            and ercu.customer_prov_id = #{customer.customerProvId}
         </if>
         <if test='customer.customerCityId!=null and customer.customerCityId!=""'>
            and ercu.customer_city_id = #{customer.customerCityId}
         </if>
         <if test='customer.customerAreaId!=null and customer.customerAreaId!=""'>
            and ercu.customer_area_id = #{customer.customerAreaId}
         </if>
       </if>
       <if test='currUserFlow!=null and currUserFlow!=""'>
   			and ercu.CUSTOMER_PROV_ID in(
				select  PROV_ID
    			from pdsci.ERP_USER_REGION_POPEDOM
    			where USER_FLOW = #{currUserFlow}
	   			and RECORD_STATUS ='Y'
			)
   		</if>
   		<if test='bigRegionTypeIdList!=null'>
   			and ercu.CUSTOMER_PROV_ID in
		   <foreach item="item" index="index" collection="bigRegionTypeIdList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
   		<if test='notInStatus!=null'>
   			and erco.contract_Status_Id not in
		   <foreach item="item" index="index" collection="notInStatus" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
        <if test='deptFlow!=null and deptFlow!=""'>
            and erco.sign_dept_flow=#{deptFlow}
       </if>
       <if test='contract!=null'>
         <if test='contract.contractNo!=null and contract.contractNo!=""'>
            <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
            and erco.contract_no like #{contractNo}
         </if>
         <if test='contract.contractName!=null and contract.contractName!=""'>
           <bind name="contractName" value="'%'+contract.contractName+'%'"/>
            and erco.contract_name like #{contractName}
         </if>
         <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
            and erco.contract_Flow=#{contract.contractFlow}
         </if>
         <if test='contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
            and erco.maintain_Due_Date=#{contract.contractFlow}
         </if>
         <if test='contract.signDate!=null and contract.signDate!=""'>
            and erco.sign_Date=#{contract.signDate}
         </if>
         <if test='contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
            and erco.contract_Category_Id=#{contract.contractCategoryId}
         </if>
          <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
            and erco.contract_Type_Id=#{contract.contractTypeId}
         </if>
         <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
            and erco.contract_Status_Id=#{contract.contractStatusId}
         </if>
          <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
            and erco.sign_Dept_Flow=#{contract.signDeptFlow}
         </if>
         <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
            and erco.sign_user_Flow=#{contract.signUserFlow}
         </if>
         <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
            and erco.charge_user_Flow=#{contract.chargeUserFlow}
         </if>
         <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
            and erco.charge_user2_Flow=#{contract.chargeUser2Flow}
         </if>
           <if test='createDateStart!=null and createDateStart!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
           </if>
           <if test='createDateEnd!=null and createDateEnd!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
           </if>
         <if test='signDateStart!=null and signDateStart!=""'>
            and erco.sign_date >= #{signDateStart}
         </if>
         <if test='signDateEnd!=null and signDateEnd!=""'>
            and erco.sign_date <![CDATA[ <= ]]> #{signDateEnd}
         </if>
         <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
            and erco.maintain_Due_Date >= #{maintainDueDateStart}
         </if>
         <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
            and erco.maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
         </if>
         <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
            and erco.contract_Due_Date >= #{contractDueDateStart}
         </if>
         <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
            and erco.contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
         </if>
       </if>
       <if test='notCG=="Y"'>
           and  erco.contract_Category_Id !='Purchase'
       </if>
       <if test='waitJH=="Y"'>
            and NOT exists (
               select 1
               from erp_crm_contract_bill_plan p
               where p.record_status='Y'
               and p.BILL_PAY_FUND=(select nvl(sum(b.BILL_FUND),0) from erp_crm_contract_bill_balance b where
                b.record_status='Y' and b.BILL_plan_flow=p.BILL_plan_flow and b.status_id='AuditPass' )
               and p.contract_flow=erco.contract_flow

           )
           AND erco.CONTRACT_FUND !=(select nvl(sum(b.bill_pay_fund),0) from erp_crm_contract_BILL_plan b where b.record_status='Y'  and b.contract_flow=erco.contract_flow)
       </if>
       <if test='waitKP=="Y"'>
            and exists (
               select 1
               from erp_crm_contract_BILL_plan p
               where p.record_status='Y'
               and p.BILL_PAY_FUND!=(select nvl(sum(b.BILL_fund),0) from erp_crm_contract_BILL_balance b where b.record_status='Y'
               and b.status_id='AuditPass' and b.BILL_plan_flow=p.BILL_plan_flow )
               and p.contract_flow=erco.contract_flow
           )
           AND erco.CONTRACT_FUND !=(select nvl(sum(b.BILL_fund),0) from erp_crm_contract_BILL_balance b where b.record_status='Y'
           AND b.status_id = 'AuditPass'and   b.contract_flow=erco.contract_flow)
       </if>
       <if test='KPBH=="Y"'>
            and exists (
               select 1
               from erp_crm_contract_BILL_balance p
               where p.record_status='Y'
                and p.status_id='AuditBack'
               and p.contract_flow=erco.contract_flow
           )
       </if>
       <if test='waitAudit=="Y"'>
            and exists (
               select 1
               from erp_crm_contract_BILL_balance p
               where p.record_status='Y'
                and p.status_id='Auditing'
               and p.contract_flow=erco.contract_flow
           )
       </if>
       <if test='waitTracke=="Y"'>
            and exists (
               select 1
               from erp_crm_contract_BILL_balance p
               where p.record_status='Y'
                and p.status_id='AuditPass'
                and BILL_TRACKE_NUMBER is null
               and p.contract_flow=erco.contract_flow
           )
       </if>
       <if test='maintainDue=="Y"'>
            and erco.maintain_Due_Date <![CDATA[ < ]]> #{currDate}
       </if>
       <if test='refContractFlowList!=null'>
          and erco.contract_flow in
		   <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
       </if>
       <if test='orderByCase!=null and orderByCase!=""'>
           <if test="orderByCase=='CONTRACT_NO'">
               order by erco.CONTRACT_NO
           </if>
           <if test="orderByCase=='CONTRACT_ARCHIVES_NO'">
               order by erco.CONTRACT_ARCHIVES_NO
           </if>
           <if test="orderByCase=='CUSTOMER_NAME'">
               order by ercu.customer_name
           </if>
           <if test="orderByCase=='CONTRACT_NAME'">
               order by erco.CONTRACT_NAME
           </if>
           <if test="orderByCase=='CONTRACT_CATEGORY_NAME'">
               order by erco.CONTRACT_CATEGORY_NAME
           </if>
           <if test="orderByCase=='CONTRACT_TYPE_NAME'">
               order by erco.CONTRACT_TYPE_NAME
           </if>
           <if test="orderByCase=='SIGN_DEPT_NAME'">
               order by erco.SIGN_DEPT_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER_NAME'">
               order by erco.CHARGE_USER_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER2_NAME'">
               order by erco.CHARGE_USER2_NAME
           </if>
           <if test="orderByCase=='CONTRACT_STATUS_NAME'">
               order by erco.CONTRACT_STATUS_NAME
           </if>
           <if test="orderByCase=='SIGN_DATE'">
               order by erco.sign_date
           </if>
           <if test="orderByCase=='CREATE_TIME'">
               order by erco.create_time
           </if>
           <if test="orderByCase=='CONTRACT_DUE_DATE'">
               order by erco.CONTRACT_DUE_DATE
           </if>
           <if test="orderByCase=='MAINTAIN_DUE_DATE'">
               order by erco.MAINTAIN_DUE_DATE
           </if>
            <if test='orderAction!=null and orderAction!=""'>
                <if test="orderAction=='desc'">
                    desc
                </if>
                <if test="orderAction=='asc'">
                    asc
                </if>
           </if>
           <if test='orderByCase!=null and orderByCase !="" and (orderAction==null or orderAction=="")'>
               ,erco.CONTRACT_NO desc
           </if>
       </if>
       <if test='orderByCase==null or orderByCase ==""'>
           order by erco.sign_date desc,erco.create_time desc,erco.CONTRACT_NO desc
       </if>
   </select>
   <resultMap id="yszcxMap" type="hashmap">
       <result column="CONTRACT_FLOW" jdbcType="VARCHAR" property="contractFlow" />
       <result column="CUSTOMER_FLOW" jdbcType="VARCHAR" property="customerFlow" />
       <result column="CONTRACT_NO" jdbcType="VARCHAR" property="contractNo" />
       <result column="CONTRACT_NAME" jdbcType="VARCHAR" property="contractName" />
       <result column="CONTRACT_CATEGORY_ID" jdbcType="VARCHAR" property="contractCategoryId" />
       <result column="CONTRACT_CATEGORY_NAME" jdbcType="VARCHAR" property="contractCategoryName" />
       <result column="CONTRACT_TYPE_ID" jdbcType="VARCHAR" property="contractTypeId" />
       <result column="CONTRACT_TYPE_NAME" jdbcType="VARCHAR" property="contractTypeName" />
       <result column="SIGN_DATE" jdbcType="VARCHAR" property="signDate" />
       <result column="SIGN_DEPT_FLOW" jdbcType="VARCHAR" property="signDeptFlow" />
       <result column="SIGN_DEPT_NAME" jdbcType="VARCHAR" property="signDeptName" />
       <result column="SIGN_USER_FLOW" jdbcType="VARCHAR" property="signUserFlow" />
       <result column="SIGN_USER_NAME" jdbcType="VARCHAR" property="signUserName" />
       <result column="CONTRACT_DUE_DATE" jdbcType="VARCHAR" property="contractDueDate" />
       <result column="MAINTAIN_DUE_DATE" jdbcType="VARCHAR" property="maintainDueDate" />
       <result column="CONTRACT_FUND" jdbcType="DECIMAL" property="contractFund" />
       <result column="CONTRACT_FILE_FLOW" jdbcType="VARCHAR" property="contractFileFlow" />
       <result column="CONTRACT_STATUS_ID" jdbcType="VARCHAR" property="contractStatusId" />
       <result column="CONTRACT_STATUS_NAME" jdbcType="VARCHAR" property="contractStatusName" />
       <result column="RECORD_STATUS" jdbcType="VARCHAR" property="recordStatus" />
       <result column="CREATE_TIME" jdbcType="VARCHAR" property="createTime" />
       <result column="CREATE_USER_FLOW" jdbcType="VARCHAR" property="createUserFlow" />
       <result column="MODIFY_TIME" jdbcType="VARCHAR" property="modifyTime" />
       <result column="MODIFY_USER_FLOW" jdbcType="VARCHAR" property="modifyUserFlow" />
       <result column="SUB_COUNT" jdbcType="DECIMAL" property="subCount" />
       <result column="CONTRACT_OWN_ID" jdbcType="VARCHAR" property="contractOwnId" />
       <result column="CONTRACT_OWN_NAME" jdbcType="VARCHAR" property="contractOwnName" />
       <result column="CHARGE_USER_FLOW" jdbcType="VARCHAR" property="chargeUserFlow" />
       <result column="CHARGE_USER_NAME" jdbcType="VARCHAR" property="chargeUserName" />
       <result column="CUSTOMER_DEPT" jdbcType="VARCHAR" property="customerDept" />
       <result column="CONSUMER_FLOW" jdbcType="VARCHAR" property="consumerFlow" />
       <result column="CONSUMER_NAME" jdbcType="VARCHAR" property="consumerName" />
       <result column="CONTRACT_ARCHIVES_NO" jdbcType="VARCHAR" property="contractArchivesNo" />
       <result column="FEED_BACK_TIME" jdbcType="VARCHAR" property="feedBackTime" />
       <result column="FEED_BACK_USER_FLOW" jdbcType="VARCHAR" property="feedBackUserFlow" />
       <result column="FEED_BACK_USER_NAME" jdbcType="VARCHAR" property="feedBackUserName" />
       <result column="FEED_BACK_CONTENT" jdbcType="VARCHAR" property="feedBackContent" />
       <result column="CHARGE_USER2_FLOW" jdbcType="VARCHAR" property="chargeUser2Flow" />
       <result column="CHARGE_USER2_NAME" jdbcType="VARCHAR" property="chargeUser2Name" />
       <result column="PLAN_ACCEPT_DATE" jdbcType="VARCHAR" property="planAcceptDate" />
       <result column="MAINTAIN_COUNT" jdbcType="VARCHAR" property="maintainCount" />
       <result column="NEXT_MAINTAIN_DATE" jdbcType="VARCHAR" property="nextMaintainDate" />
       <result column="AUDIT_USER_FLOW" jdbcType="VARCHAR" property="auditUserFlow" />
       <result column="AUDIT_USER_NAME" jdbcType="VARCHAR" property="auditUserName" />
       <result column="AUDIT_REASON" jdbcType="VARCHAR" property="auditReason" />
       <result column="customer_name" jdbcType="VARCHAR" property="customerName" />
       <result column="pay_fund" jdbcType="INTEGER" property="payFund" />
       <result column="bill_fund" jdbcType="INTEGER" property="billFund" />
       <result column="PLAN_DATE" jdbcType="INTEGER" property="planDate" />
   </resultMap>
   <select id="yszcx" parameterType="java.util.Map" resultMap="yszcxMap">
       select erco.*,
       ercu.customer_name,
       (select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
       and b.status_id='AuditPass'
       and b.contract_flow=erco.contract_flow) pay_fund,
       (
       select min(PLAN_DATE)
       from erp_crm_contract_pay_plan p
       where p.record_status='Y'
       and p.PAY_FUND!=(select nvl(sum(b.pay_FUND),0) from erp_crm_contract_pay_balance b where
       b.record_status='Y' and b.plan_flow=p.plan_flow and b.status_id='AuditPass' )
       and p.contract_flow=erco.contract_flow
       ) PLAN_DATE
       from pdsci.erp_crm_contract erco
       left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
       where erco.record_status='Y' and ercu.record_status='Y'
       <if test='customer!=null'>
         <if test='customer.customerName!=null and customer.customerName!=""'>
       		<if test='isLike==1'>
                <bind name="customerName" value="'%'+customer.customerName+'%'"/>
                and (ercu.customer_name like #{customerName}
                or ercu.alias_name like #{customerName})
            </if>
            <if test='isLike==null or isLike==""'>
                and ercu.customer_name = #{customer.customerName}
            </if>
         </if>
         <if test='customer.customerFlow!=null and customer.customerFlow!=""'>
            and ercu.customer_flow = #{customer.customerFlow}
         </if>
         <if test='customer.customerProvId!=null and customer.customerProvId!=""'>
            and ercu.customer_prov_id = #{customer.customerProvId}
         </if>
         <if test='customer.customerCityId!=null and customer.customerCityId!=""'>
            and ercu.customer_city_id = #{customer.customerCityId}
         </if>
         <if test='customer.customerAreaId!=null and customer.customerAreaId!=""'>
            and ercu.customer_area_id = #{customer.customerAreaId}
         </if>
       </if>
       <if test='currUserFlow!=null and currUserFlow!=""'>
   			and ercu.CUSTOMER_PROV_ID in(
				select  PROV_ID
    			from pdsci.ERP_USER_REGION_POPEDOM
    			where USER_FLOW = #{currUserFlow}
	   			and RECORD_STATUS ='Y'
			)
   		</if>
   		<if test='bigRegionTypeIdList!=null'>
   			and ercu.CUSTOMER_PROV_ID in
		   <foreach item="item" index="index" collection="bigRegionTypeIdList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
   		<if test='notInStatus!=null'>
   			and erco.contract_Status_Id not in
		   <foreach item="item" index="index" collection="notInStatus" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
   		<if test='notInType!=null'>
   			and erco.contract_Category_Id not in
		   <foreach item="item" index="index" collection="notInType" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
        <if test='deptFlow!=null and deptFlow!=""'>
            and erco.sign_dept_flow=#{deptFlow}
       </if>
       <if test='contract!=null'>
         <if test='contract.contractNo!=null and contract.contractNo!=""'>
            <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
            and erco.contract_no like #{contractNo}
         </if>
         <if test='contract.contractName!=null and contract.contractName!=""'>
           <bind name="contractName" value="'%'+contract.contractName+'%'"/>
            and erco.contract_name like #{contractName}
         </if>
         <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
            and erco.contract_Flow=#{contract.contractFlow}
         </if>
         <if test='contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
            and erco.maintain_Due_Date=#{contract.contractFlow}
         </if>
         <if test='contract.signDate!=null and contract.signDate!=""'>
            and erco.sign_Date=#{contract.signDate}
         </if>
         <if test='contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
            and erco.contract_Category_Id=#{contract.contractCategoryId}
         </if>
          <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
            and erco.contract_Type_Id=#{contract.contractTypeId}
         </if>
         <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
            and erco.contract_Status_Id=#{contract.contractStatusId}
         </if>
          <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
            and erco.sign_Dept_Flow=#{contract.signDeptFlow}
         </if>
         <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
            and erco.sign_user_Flow=#{contract.signUserFlow}
         </if>
         <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
            and erco.charge_user_Flow=#{contract.chargeUserFlow}
         </if>
         <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
            and erco.charge_user2_Flow=#{contract.chargeUser2Flow}
         </if>
           <if test='createDateStart!=null and createDateStart!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
           </if>
           <if test='createDateEnd!=null and createDateEnd!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
           </if>
         <if test='signDateStart!=null and signDateStart!=""'>
            and erco.sign_date >= #{signDateStart}
         </if>
         <if test='signDateEnd!=null and signDateEnd!=""'>
            and erco.sign_date <![CDATA[ <= ]]> #{signDateEnd}
         </if>
         <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
            and erco.maintain_Due_Date >= #{maintainDueDateStart}
         </if>
         <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
            and erco.maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
         </if>
         <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
            and erco.contract_Due_Date >= #{contractDueDateStart}
         </if>
         <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
            and erco.contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
         </if>
       </if>
       <if test='notCG=="Y"'>
           and  erco.contract_Category_Id !='Purchase'
       </if>
       <if test='yqht=="Y"'>
            and exists (
               select 1
               from erp_crm_contract_pay_plan p
               where p.record_status='Y'
               and p.PAY_FUND!=(select nvl(sum(b.pay_FUND),0) from erp_crm_contract_pay_balance b where
                b.record_status='Y' and b.plan_flow=p.plan_flow and b.status_id='AuditPass' )
               and p.contract_flow=erco.contract_flow
           )
           AND erco.CONTRACT_FUND !=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
               and b.status_id='AuditPass'
               and b.contract_flow=erco.contract_flow)
       </if>
       <if test='maintainDue=="Y"'>
            and erco.maintain_Due_Date <![CDATA[ < ]]> #{currDate}
       </if>
       <if test='refContractFlowList!=null'>
          and erco.contract_flow in
		   <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
       </if>
       <if test='orderByCase!=null and orderByCase!=""'>
           <if test="orderByCase=='CONTRACT_NO'">
               order by erco.CONTRACT_NO
           </if>
           <if test="orderByCase=='CONTRACT_ARCHIVES_NO'">
               order by erco.CONTRACT_ARCHIVES_NO
           </if>
           <if test="orderByCase=='CUSTOMER_NAME'">
               order by ercu.customer_name
           </if>
           <if test="orderByCase=='CONTRACT_NAME'">
               order by erco.CONTRACT_NAME
           </if>
           <if test="orderByCase=='CONTRACT_CATEGORY_NAME'">
               order by erco.CONTRACT_CATEGORY_NAME
           </if>
           <if test="orderByCase=='CONTRACT_TYPE_NAME'">
               order by erco.CONTRACT_TYPE_NAME
           </if>
           <if test="orderByCase=='SIGN_DEPT_NAME'">
               order by erco.SIGN_DEPT_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER_NAME'">
               order by erco.CHARGE_USER_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER2_NAME'">
               order by erco.CHARGE_USER2_NAME
           </if>
           <if test="orderByCase=='CONTRACT_STATUS_NAME'">
               order by erco.CONTRACT_STATUS_NAME
           </if>
           <if test="orderByCase=='SIGN_DATE'">
               order by erco.sign_date
           </if>
           <if test="orderByCase=='CREATE_TIME'">
               order by erco.create_time
           </if>
           <if test="orderByCase=='CONTRACT_DUE_DATE'">
               order by erco.CONTRACT_DUE_DATE
           </if>
           <if test="orderByCase=='MAINTAIN_DUE_DATE'">
               order by erco.MAINTAIN_DUE_DATE
           </if>
            <if test='orderAction!=null and orderAction!=""'>
                <if test="orderAction=='desc'">
                    desc
                </if>
                <if test="orderAction=='asc'">
                    asc
                </if>
           </if>
           <if test='orderByCase!=null and orderByCase !="" and (orderAction==null or orderAction=="")'>
               ,erco.CONTRACT_NO desc
           </if>
       </if>
       <if test='orderByCase==null or orderByCase ==""'>
           order by erco.sign_date desc,erco.create_time desc,erco.CONTRACT_NO desc
       </if>
   </select>
    <resultMap id="cwysFundMap" type="hashmap">
        <result column="all_CWFund" jdbcType="INTEGER" property="allCWFund" />
        <result column="all_Fund" jdbcType="INTEGER" property="allFund" />
    </resultMap>
   <select id="cwysFund" parameterType="java.util.Map" resultMap="cwysFundMap">
       select nvl(sum(contract_fund-pay_fund),0) all_Fund,nvl(sum(bill_fund-pay_fund),0) all_CWFund from (
           select
            erco.contract_fund,
           (select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
           and b.status_id='AuditPass'
           and b.contract_flow=erco.contract_flow) pay_fund,
           (select nvl(sum(b.bill_fund),0) from erp_crm_contract_bill_balance b where b.record_status='Y'
           and b.status_id='AuditPass'
           and b.contract_flow=erco.contract_flow) bill_fund
           from pdsci.erp_crm_contract erco
           left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
           where erco.record_status='Y' and ercu.record_status='Y'
           <if test='customer!=null'>
             <if test='customer.customerName!=null and customer.customerName!=""'>
                <if test='isLike==1'>
                    <bind name="customerName" value="'%'+customer.customerName+'%'"/>
                    and (ercu.customer_name like #{customerName}
                    or ercu.alias_name like #{customerName})
                </if>
                <if test='isLike==null or isLike==""'>
                    and ercu.customer_name = #{customer.customerName}
                </if>
             </if>
             <if test='customer.customerProvId!=null and customer.customerProvId!=""'>
                and ercu.customer_prov_id = #{customer.customerProvId}
             </if>
             <if test='customer.customerCityId!=null and customer.customerCityId!=""'>
                and ercu.customer_city_id = #{customer.customerCityId}
             </if>
             <if test='customer.customerAreaId!=null and customer.customerAreaId!=""'>
                and ercu.customer_area_id = #{customer.customerAreaId}
             </if>
           </if>
           <if test='currUserFlow!=null and currUserFlow!=""'>
                and ercu.CUSTOMER_PROV_ID in(
                    select  PROV_ID
                    from pdsci.ERP_USER_REGION_POPEDOM
                    where USER_FLOW = #{currUserFlow}
                    and RECORD_STATUS ='Y'
                )
            </if>
            <if test='bigRegionTypeIdList!=null'>
                and ercu.CUSTOMER_PROV_ID in
               <foreach item="item" index="index" collection="bigRegionTypeIdList" open="(" separator="," close=")">
                #{item}
               </foreach>
            </if>
            <if test='notInStatus!=null'>
                and erco.contract_Status_Id not in
               <foreach item="item" index="index" collection="notInStatus" open="(" separator="," close=")">
                #{item}
               </foreach>
            </if>
            <if test='deptFlow!=null and deptFlow!=""'>
                and erco.sign_dept_flow=#{deptFlow}
           </if>
           <if test='notInType!=null'>
               and erco.contract_Category_Id not in
               <foreach item="item" index="index" collection="notInType" open="(" separator="," close=")">
                   #{item}
               </foreach>
           </if>
           <if test='contract!=null'>
             <if test='contract.contractNo!=null and contract.contractNo!=""'>
                <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
                and erco.contract_no like #{contractNo}
             </if>
             <if test='contract.contractName!=null and contract.contractName!=""'>
               <bind name="contractName" value="'%'+contract.contractName+'%'"/>
                and erco.contract_name like #{contractName}
             </if>
             <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
                and erco.contract_Flow=#{contract.contractFlow}
             </if>
             <if test='contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
                and erco.maintain_Due_Date=#{contract.contractFlow}
             </if>
             <if test='contract.signDate!=null and contract.signDate!=""'>
                and erco.sign_Date=#{contract.signDate}
             </if>
             <if test='contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
                and erco.contract_Category_Id=#{contract.contractCategoryId}
             </if>
              <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
                and erco.contract_Type_Id=#{contract.contractTypeId}
             </if>
             <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
                and erco.contract_Status_Id=#{contract.contractStatusId}
             </if>
              <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
                and erco.sign_Dept_Flow=#{contract.signDeptFlow}
             </if>
             <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
                and erco.sign_user_Flow=#{contract.signUserFlow}
             </if>
             <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
                and erco.charge_user_Flow=#{contract.chargeUserFlow}
             </if>
             <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
                and erco.charge_user2_Flow=#{contract.chargeUser2Flow}
             </if>
               <if test='createDateStart!=null and createDateStart!=""'>
                   and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
               </if>
               <if test='createDateEnd!=null and createDateEnd!=""'>
                   and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
               </if>
             <if test='signDateStart!=null and signDateStart!=""'>
                and erco.sign_date >= #{signDateStart}
             </if>
             <if test='signDateEnd!=null and signDateEnd!=""'>
                and erco.sign_date <![CDATA[ <= ]]> #{signDateEnd}
             </if>
             <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
                and erco.maintain_Due_Date >= #{maintainDueDateStart}
             </if>
             <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
                and erco.maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
             </if>
             <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
                and erco.contract_Due_Date >= #{contractDueDateStart}
             </if>
             <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
                and erco.contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
             </if>
           </if>
           <if test='notCG=="Y"'>
               and  erco.contract_Category_Id !='Purchase'
           </if>
           <if test='yqht=="Y"'>
                and exists (
                   select 1
                   from erp_crm_contract_pay_plan p
                   where p.record_status='Y'
                   and p.PAY_FUND!=(select nvl(sum(b.pay_FUND),0) from erp_crm_contract_pay_balance b where
                    b.record_status='Y' and b.plan_flow=p.plan_flow and b.status_id='AuditPass' )
                   and p.contract_flow=erco.contract_flow
               )
               AND erco.CONTRACT_FUND !=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
                   and b.status_id='AuditPass'
                   and b.contract_flow=erco.contract_flow)
           </if>
           <if test='maintainDue=="Y"'>
                and erco.maintain_Due_Date <![CDATA[ < ]]> #{currDate}
           </if>
           <if test='refContractFlowList!=null'>
              and erco.contract_flow in
               <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">
                #{item}
               </foreach>
           </if>
       )a
   </select>
   <select id="wh" parameterType="java.util.Map" resultMap="yszcxMap">
       select erco.*,
       ercu.customer_name
       from pdsci.erp_crm_contract erco
       left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
       where erco.record_status='Y' and ercu.record_status='Y'
       <if test='customer!=null'>
         <if test='customer.customerName!=null and customer.customerName!=""'>
       		<if test='isLike==1'>
                <bind name="customerName" value="'%'+customer.customerName+'%'"/>
                and (ercu.customer_name like #{customerName}
                or ercu.alias_name like #{customerName})
            </if>
            <if test='isLike==null or isLike==""'>
                and ercu.customer_name = #{customer.customerName}
            </if>
         </if>
         <if test='customer.customerProvId!=null and customer.customerProvId!=""'>
            and ercu.customer_prov_id = #{customer.customerProvId}
         </if>
         <if test='customer.customerCityId!=null and customer.customerCityId!=""'>
            and ercu.customer_city_id = #{customer.customerCityId}
         </if>
         <if test='customer.customerAreaId!=null and customer.customerAreaId!=""'>
            and ercu.customer_area_id = #{customer.customerAreaId}
         </if>
       </if>
       <if test='currUserFlow!=null and currUserFlow!=""'>
   			and ercu.CUSTOMER_PROV_ID in(
				select  PROV_ID
    			from pdsci.ERP_USER_REGION_POPEDOM
    			where USER_FLOW = #{currUserFlow}
	   			and RECORD_STATUS ='Y'
			)
   		</if>
   		<if test='bigRegionTypeIdList!=null'>
   			and ercu.CUSTOMER_PROV_ID in
		   <foreach item="item" index="index" collection="bigRegionTypeIdList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
   		<if test='notInStatus!=null'>
   			and erco.contract_Status_Id not in
		   <foreach item="item" index="index" collection="notInStatus" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
        <if test='deptFlow!=null and deptFlow!=""'>
            and erco.sign_dept_flow=#{deptFlow}
       </if>
       <if test='contract!=null'>
         <if test='contract.contractNo!=null and contract.contractNo!=""'>
            <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
            and erco.contract_no like #{contractNo}
         </if>
         <if test='contract.contractName!=null and contract.contractName!=""'>
           <bind name="contractName" value="'%'+contract.contractName+'%'"/>
            and erco.contract_name like #{contractName}
         </if>
         <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
            and erco.contract_Flow=#{contract.contractFlow}
         </if>
         <if test='contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
            and erco.maintain_Due_Date=#{contract.contractFlow}
         </if>
         <if test='contract.signDate!=null and contract.signDate!=""'>
            and erco.sign_Date=#{contract.signDate}
         </if>
         <if test='contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
            and erco.contract_Category_Id=#{contract.contractCategoryId}
         </if>
          <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
            and erco.contract_Type_Id=#{contract.contractTypeId}
         </if>
         <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
            and erco.contract_Status_Id=#{contract.contractStatusId}
         </if>
          <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
            and erco.sign_Dept_Flow=#{contract.signDeptFlow}
         </if>
         <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
            and erco.sign_user_Flow=#{contract.signUserFlow}
         </if>
         <if test='contract.createUserFlow!=null and contract.createUserFlow!=""'>
            and (erco.create_user_Flow=#{contract.createUserFlow} or erco.charge_user_flow=#{contract.createUserFlow} or erco.charge_user2_flow=#{contract.createUserFlow} )
         </if>
           <if test='owner==null or owner==""'>
               <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
                   and charge_user_Flow=#{contract.chargeUserFlow}
               </if>
               <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
                   and charge_user2_Flow=#{contract.chargeUser2Flow}
               </if>
           </if>
           <if test='owner!=null and owner!=""'>
               <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""and (contract.chargeUser2Flow==null or contract.chargeUser2Flow=="")'>
                   and charge_user_Flow=#{contract.chargeUserFlow}
               </if>
               <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!="" and (contract.chargeUserFlow==null or contract.chargeUserFlow=="")'>
                   and charge_user2_Flow=#{contract.chargeUser2Flow}
               </if>
               <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!="" and contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
                   and (
                   charge_user2_Flow=#{contract.chargeUser2Flow}
                   or
                   charge_user_Flow=#{contract.chargeUserFlow}
                   )
               </if>
           </if>
           <if test='createDateStart!=null and createDateStart!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
           </if>
           <if test='createDateEnd!=null and createDateEnd!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
           </if>
         <if test='signDateStart!=null and signDateStart!=""'>
            and erco.sign_date >= #{signDateStart}
         </if>
         <if test='signDateEnd!=null and signDateEnd!=""'>
            and erco.sign_date <![CDATA[ <= ]]> #{signDateEnd}
         </if>
         <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
            and erco.maintain_Due_Date >= #{maintainDueDateStart}
         </if>
         <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
            and erco.maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
         </if>
         <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
            and erco.contract_Due_Date >= #{contractDueDateStart}
         </if>
         <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
            and erco.contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
         </if>
       </if>
       <if test='waitAudit=="Y"'>
            and erco.contract_status_id ='Auditing'
       </if>
       <if test='refContractFlowList!=null'>
          and erco.contract_flow in
		   <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
       </if>
       <if test='orderByCase!=null and orderByCase!=""'>
           <if test="orderByCase=='CONTRACT_NO'">
               order by erco.CONTRACT_NO
           </if>
           <if test="orderByCase=='CONTRACT_ARCHIVES_NO'">
               order by erco.CONTRACT_ARCHIVES_NO
           </if>
           <if test="orderByCase=='CUSTOMER_NAME'">
               order by ercu.customer_name
           </if>
           <if test="orderByCase=='CONTRACT_NAME'">
               order by erco.CONTRACT_NAME
           </if>
           <if test="orderByCase=='CONTRACT_CATEGORY_NAME'">
               order by erco.CONTRACT_CATEGORY_NAME
           </if>
           <if test="orderByCase=='CONTRACT_TYPE_NAME'">
               order by erco.CONTRACT_TYPE_NAME
           </if>
           <if test="orderByCase=='SIGN_DEPT_NAME'">
               order by erco.SIGN_DEPT_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER_NAME'">
               order by erco.CHARGE_USER_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER2_NAME'">
               order by erco.CHARGE_USER2_NAME
           </if>
           <if test="orderByCase=='CONTRACT_STATUS_NAME'">
               order by erco.CONTRACT_STATUS_NAME
           </if>
           <if test="orderByCase=='SIGN_DATE'">
               order by erco.sign_date
           </if>
           <if test="orderByCase=='CREATE_TIME'">
               order by erco.create_time
           </if>
           <if test="orderByCase=='CONTRACT_DUE_DATE'">
               order by erco.CONTRACT_DUE_DATE
           </if>
           <if test="orderByCase=='MAINTAIN_DUE_DATE'">
               order by erco.MAINTAIN_DUE_DATE
           </if>
            <if test='orderAction!=null and orderAction!=""'>
                <if test="orderAction=='desc'">
                    desc
                </if>
                <if test="orderAction=='asc'">
                    asc
                </if>
           </if>
           <if test='orderByCase!=null and orderByCase !="" and (orderAction==null or orderAction=="")'>
               ,erco.CONTRACT_NO desc
           </if>
       </if>
       <if test='orderByCase==null or orderByCase ==""'>
           order by erco.sign_date desc,erco.create_time desc,erco.CONTRACT_NO desc
       </if>
   </select>
   <select id="zxcx" parameterType="java.util.Map" resultMap="yszcxMap">
       select * from (
       select erco.*,
       ercu.customer_name,
       case when MAINTAIN_DUE_DATE is null then 'six'
       else
       case
       when MONTHS_BETWEEN(to_date( to_char(sysdate,'yyyy-mm-dd'),'yyyy-MM-dd'),to_date(MAINTAIN_DUE_DATE,'yyyy-MM-dd'))
       <![CDATA[ <= ]]>1 then 'one'
       when MONTHS_BETWEEN(to_date( to_char(sysdate,'yyyy-mm-dd'),'yyyy-MM-dd'),to_date(MAINTAIN_DUE_DATE,'yyyy-MM-dd'))
       <![CDATA[ <= ]]>3
       and MONTHS_BETWEEN(to_date(
       to_char(sysdate,'yyyy-mm-dd'),'yyyy-MM-dd'),to_date(MAINTAIN_DUE_DATE,'yyyy-MM-dd'))>1 then 'two'
       when MONTHS_BETWEEN(to_date( to_char(sysdate,'yyyy-mm-dd'),'yyyy-MM-dd'),to_date(MAINTAIN_DUE_DATE,'yyyy-MM-dd'))
       <![CDATA[ <= ]]>6
       and MONTHS_BETWEEN(to_date(
       to_char(sysdate,'yyyy-mm-dd'),'yyyy-MM-dd'),to_date(MAINTAIN_DUE_DATE,'yyyy-MM-dd'))>3 then 'three'
       when MONTHS_BETWEEN(to_date(
       to_char(sysdate,'yyyy-mm-dd'),'yyyy-MM-dd'),to_date(MAINTAIN_DUE_DATE,'yyyy-MM-dd'))>6 then 'six'
       else
       ''
       end
       end tbsj
       from pdsci.erp_crm_contract erco
       left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
       where erco.record_status='Y' and ercu.record_status='Y'
       <if test='customer!=null'>
         <if test='customer.customerName!=null and customer.customerName!=""'>and (ercu.customer_name like
             #{customerName}<if test='isLike==1'>
                <bind name="customerName" value="'%'+customer.customerName+'%'"/>or ercu.alias_name like #{
                   customerName})
             </if>
            <if test='
               isLike==null or isLike==""'>
                and
                ercu.customer_name = #{customer.customerName}
            </if
            >
         </if>
         <if test='
               customer.customerProvId!=null and customer.customerProvId!=""'>
             and ercu.customer_prov_id = #{
           customer.customerProvId}
         </if>
         <if test='
               customer.customerCityId!=null and customer.customerCityId!=""'>
             and ercu.
             customer_city_id = #{customer.customerCityId}
         </if>
         <if test='
               customer.customerAreaId!=null and customer.customerAreaId!=""'>
            and ercu.customer_area_id = #{customer.customerAreaId}
         </if>
       </if>
       <if test='
           currUserFlow!=null and currUserFlow!=""'>
           and ercu.
           CUSTOMER_PROV_ID in(
           select PROV_ID
           from pdsci.
           ERP_USER_REGION_POPEDOM
           where USER_FLOW = #{currUserFlow}
           and
           RECORD_STATUS ='Y'
           )
       </if>
   		<if test='bigRegionTypeIdList!=null'>
   			and ercu.CUSTOMER_PROV_ID in
		   <foreach item="item
               " index
                   ="index"
                    collection="bigRegionTypeIdList" open="("
                    separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
   		<if test='notInStatus!=null'>
            and erco.contract_Status_Id
            not in
            <foreach item=
                             "item"
                     index="index" collection="notInStatus" open="("
                     separator="," close=")">
		  	#{item}
		   </foreach>
   		</if>
        <if test
                    ='deptFlow!=null and deptFlow!=""'>
            and erco.
            sign_dept_flow=#{deptFlow}
        </if>
       <if test='contract!=null'
       >
         <if test='
           contract.contractNo!=null and contract.contractNo!=""'>
            <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
             and erco.contract_no like
             #{contractNo}
         </if>
         <if test='contract.contractName!=null and contract.contractName!=""'>
           <bind name="contractName" value="'%'+contract.contractName+'%'"/>
            and erco.contract_name like #{contractName}
         </if>
         <if test='
           contract.contractFlow!=null and contract.contractFlow!=""'>
            and erco.contract_Flow=#{contract.contractFlow}
         </if>
         <if test='
           contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
             and erco.maintain_Due_Date=#{contract.contractFlow}
         </if>
         <if test='
           contract.signDate!=null and contract.signDate!=""'>
            and erco.sign_Date=#{contract.signDate}
         </if>
         <if test='
           contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
             and erco.contract_Category_Id=#{contract.contractCategoryId}
         </if>
          <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
              and erco.
              contract_Type_Id=#{contract.contractTypeId}
          </if>
         <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
             and erco.contract_Status_Id=#{contract.contractStatusId}
         </if>
          <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
              and erco.sign_Dept_Flow=#{contract.signDeptFlow}
          </if>
         <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
             and erco.
             sign_user_Flow=#{contract.signUserFlow}
         </if>
         <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
             and erco.charge_user_Flow=#{
               contract.chargeUserFlow}
         </if>
         <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
             and erco.
             charge_user2_Flow=#{contract.chargeUser2Flow}
         </if>
           <if test='createDateStart!=null and createDateStart!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
           </if>
           <if test='createDateEnd!=null and createDateEnd!=""'>
               and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
           </if>
         <if test='signDateStart!=null and signDateStart!=""'>
             and
             erco.sign_date >= #{signDateStart}
         </if>
         <if test='signDateEnd!=null and signDateEnd!=""'>
            and erco.sign_date <![CDATA[ <= ]]> #{signDateEnd}
         </if>
         <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
            and erco.maintain_Due_Date >= #{maintainDueDateStart}
         </if>
         <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
            and erco.maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
         </if>
         <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
            and erco.contract_Due_Date >= #{contractDueDateStart}
         </if>
         <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
            and erco.contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
         </if>
       </if>
       <if test='notCG=="Y"'>
           and  erco.contract_Category_Id !='Purchase'
       </if>
       <if test='dqtb=="zcht"'>
          and CONTRACT_DUE_DATE <![CDATA[ >= ]]> #{currDate}
          and MAINTAIN_DUE_DATE <![CDATA[ >= ]]> #{currDate}
       </if>
       <if test='dqtb=="htdqwtb"'>
           and CONTRACT_DUE_DATE <![CDATA[ < ]]> #{currDate}
           and MAINTAIN_DUE_DATE <![CDATA[ >= ]]> #{currDate}
       </if>
       <if test='dqtb=="htdqytb"'>
           and CONTRACT_DUE_DATE <![CDATA[ < ]]> #{currDate}
           and MAINTAIN_DUE_DATE <![CDATA[ < ]]> #{
               currDate}
       </if>
       <if test='dqtb=="htwdqwtb"'>
           and CONTRACT_DUE_DATE <![CDATA[ >= ]]> #{currDate}
           and MAINTAIN_DUE_DATE <![CDATA[ < ]]> #{currDate}
       </if>
       <if test='maintainDue=="Y"'>
            and erco.maintain_Due_Date <![CDATA[ < ]]> #{currDate}
       </if>
       <if test='refContractFlowList!=null'>
          and erco.contract_flow in
		   <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">
		  	#{item}
		   </foreach>
       </if>
       <if test='orderByCase!=null and orderByCase!=""'>
           <if test="orderByCase=='CONTRACT_NO'">
               order by erco.CONTRACT_NO
           </if>
           <if test="orderByCase=='CONTRACT_ARCHIVES_NO'">
               order by erco.CONTRACT_ARCHIVES_NO
           </if>
           <if test="orderByCase=='CUSTOMER_NAME'">
               order by ercu.customer_name
           </if>
           <if test="orderByCase=='CONTRACT_NAME'">
               order by erco.CONTRACT_NAME
           </if>
           <if test="orderByCase=='CONTRACT_CATEGORY_NAME'">
               order by erco.CONTRACT_CATEGORY_NAME
           </if>
           <if test="orderByCase=='CONTRACT_TYPE_NAME'">
               order by erco.CONTRACT_TYPE_NAME
           </if>
           <if test="orderByCase=='SIGN_DEPT_NAME'">
               order by erco.SIGN_DEPT_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER_NAME'">
               order by erco.CHARGE_USER_NAME
           </if>
           <if test="orderByCase=='CHARGE_USER2_NAME'">
               order by erco.CHARGE_USER2_NAME
           </if>
           <if test="orderByCase=='CONTRACT_STATUS_NAME'">
               order by erco.CONTRACT_STATUS_NAME
           </if>
           <if test="
               orderByCase=='SIGN_DATE'">
               order by erco.
               sign_date
           </if>
           <if test="
               orderByCase=='CREATE_TIME'">
               order by erco.create_time
           </if>
           <if test="orderByCase=='CONTRACT_DUE_DATE'">
               order by erco.CONTRACT_DUE_DATE
           </if>
           <if test="orderByCase=='MAINTAIN_DUE_DATE'">
               order by erco.MAINTAIN_DUE_DATE
           </if>
            <if test='orderAction!=null and orderAction!=""'>
                <if test="orderAction=='desc'">
                    desc
                </if>
                <if test="orderAction=='asc'">
                    asc
                </if>
           </if>
           <if test='orderByCase!=null and orderByCase !="" and (orderAction==null or orderAction=="")'>
               ,erco.CONTRACT_NO desc
           </if>
       </if>
       <if test='orderByCase==null or orderByCase ==""'>
           order by erco.sign_date desc,erco.create_time desc,erco.CONTRACT_NO desc
       </if>
       ) a
       where 1=1
       <if test='tbsj!=null and tbsj.size>0'>
           and a.tbsj in
           <foreach item="item" index="index" collection="tbsj" open="(" separator="," close=")">
               #{item}
           </foreach>
       </if>
   </select>
    <select id="cwyscx" parameterType="java.util.Map" resultMap="yszcxMap">
        select erco.*,
        ercu.customer_name,
        (select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
        and b.status_id='AuditPass'
        and b.contract_flow=erco.contract_flow) pay_fund,
        (select nvl(sum(b.bill_fund),0) from erp_crm_contract_bill_balance b where b.record_status='Y'
        and b.status_id='AuditPass'
        and b.contract_flow=erco.contract_flow) bill_fund
        from pdsci.erp_crm_contract erco
        left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
        where erco.record_status='Y' and ercu.record_status='Y'
        <if test='customer!=null'>
            <if test='customer.customerName!=null and customer.customerName!=""'>
                <if test='isLike==1'>
                    <bind name="customerName" value="'%'+customer.customerName+'%'"/>
                    and (ercu.customer_name like #{customerName}
                    or ercu.alias_name like #{customerName})
                </if>
                <if test='isLike==null or isLike==""'>
                    and ercu.customer_name = #{customer.customerName}
                </if>
            </if>
            <if test='customer.customerProvId!=null and customer.customerProvId!=""'>
                and ercu.customer_prov_id = #{customer.customerProvId}
            </if>
            <if test='customer.customerCityId!=null and customer.customerCityId!=""'>
                and ercu.customer_city_id = #{customer.customerCityId}
            </if>
            <if test='customer.customerAreaId!=null and customer.customerAreaId!=""'>
                and ercu.customer_area_id = #{customer.customerAreaId}
            </if>
        </if>
        <if test='currUserFlow!=null and currUserFlow!=""'>
            and ercu.CUSTOMER_PROV_ID in(
            select  PROV_ID
            from pdsci.ERP_USER_REGION_POPEDOM
            where USER_FLOW = #{currUserFlow}
            and RECORD_STATUS ='Y'
            )
        </if>
        <if test='bigRegionTypeIdList!=null'>
            and ercu.CUSTOMER_PROV_ID in
            <foreach item="item" index="index" collection="bigRegionTypeIdList" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test='notInStatus!=null'>
            and erco.contract_Status_Id not in
            <foreach item="item" index="index" collection="notInStatus" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test='notInType!=null'>
            and erco.contract_Category_Id not in
            <foreach item="item" index="index" collection="notInType" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test='deptFlow!=null and deptFlow!=""'>
            and erco.sign_dept_flow=#{deptFlow}
        </if>
        <if test='contract!=null'>
            <if test='contract.contractNo!=null and contract.contractNo!=""'>
                <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
                and erco.contract_no like #{contractNo}
            </if>
            <if test='contract.contractName!=null and contract.contractName!=""'>
                <bind name="contractName" value="'%'+contract.contractName+'%'"/>
                and erco.contract_name like #{contractName}
            </if>
            <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
                and erco.contract_Flow=#{contract.contractFlow}
            </if>
            <if test='contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
                and erco.maintain_Due_Date=#{contract.contractFlow}
            </if>
            <if test='contract.signDate!=null and contract.signDate!=""'>
                and erco.sign_Date=#{contract.signDate}
            </if>
            <if test='contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
                and erco.contract_Category_Id=#{contract.contractCategoryId}
            </if>
            <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
                and erco.contract_Type_Id=#{contract.contractTypeId}
            </if>
            <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
                and erco.contract_Status_Id=#{contract.contractStatusId}
            </if>
            <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
                and erco.sign_Dept_Flow=#{contract.signDeptFlow}
            </if>
            <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
                and erco.sign_user_Flow=#{contract.signUserFlow}
            </if>
            <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
                and erco.charge_user_Flow=#{contract.chargeUserFlow}
            </if>
            <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
                and erco.charge_user2_Flow=#{contract.chargeUser2Flow}
            </if>
            <if test='createDateStart!=null and createDateStart!=""'>
                and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
            </if>
            <if test='createDateEnd!=null and createDateEnd!=""'>
                and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
            </if>
            <if test='signDateStart!=null and signDateStart!=""'>
                and erco.sign_date >= #{signDateStart}
            </if>
            <if test='signDateEnd!=null and signDateEnd!=""'>
                and erco.sign_date <![CDATA[ <= ]]> #{signDateEnd}
            </if>
            <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
                and erco.maintain_Due_Date >= #{maintainDueDateStart}
            </if>
            <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
                and erco.maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
            </if>
            <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
                and erco.contract_Due_Date >= #{contractDueDateStart}
            </if>
            <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
                and erco.contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
            </if>
        </if>
        <if test='notCG=="Y"'>
            and  erco.contract_Category_Id !='Purchase'
        </if>
        <if test='yqht=="Y"'>
            and exists (
            select 1
            from erp_crm_contract_pay_plan p
            where p.record_status='Y'
            and p.PAY_FUND!=(select nvl(sum(b.pay_FUND),0) from erp_crm_contract_pay_balance b where
            b.record_status='Y' and b.plan_flow=p.plan_flow and b.status_id='AuditPass' )
            and p.contract_flow=erco.contract_flow
            )
            AND erco.CONTRACT_FUND !=(select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
            and b.status_id='AuditPass'
            and b.contract_flow=erco.contract_flow)
        </if>
        <if test='maintainDue=="Y"'>
            and erco.maintain_Due_Date <![CDATA[ < ]]> #{currDate}
        </if>
        <if test='refContractFlowList!=null'>
            and erco.contract_flow in
            <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test='orderByCase!=null and orderByCase!=""'>
            <if test="orderByCase=='CONTRACT_NO'">
                order by erco.CONTRACT_NO
            </if>
            <if test="orderByCase=='CONTRACT_ARCHIVES_NO'">
                order by erco.CONTRACT_ARCHIVES_NO
            </if>
            <if test="orderByCase=='CUSTOMER_NAME'">
                order by ercu.customer_name
            </if>
            <if test="orderByCase=='CONTRACT_NAME'">
                order by erco.CONTRACT_NAME
            </if>
            <if test="orderByCase=='CONTRACT_CATEGORY_NAME'">
                order by erco.CONTRACT_CATEGORY_NAME
            </if>
            <if test="orderByCase=='CONTRACT_TYPE_NAME'">
                order by erco.CONTRACT_TYPE_NAME
            </if>
            <if test="orderByCase=='SIGN_DEPT_NAME'">
                order by erco.SIGN_DEPT_NAME
            </if>
            <if test="orderByCase=='CHARGE_USER_NAME'">
                order by erco.CHARGE_USER_NAME
            </if>
            <if test="orderByCase=='CHARGE_USER2_NAME'">
                order by erco.CHARGE_USER2_NAME
            </if>
            <if test="orderByCase=='CONTRACT_STATUS_NAME'">
                order by erco.CONTRACT_STATUS_NAME
            </if>
            <if test="orderByCase=='SIGN_DATE'">
                order by erco.sign_date
            </if>
            <if test="orderByCase=='CREATE_TIME'">
                order by erco.create_time
            </if>
            <if test="orderByCase=='CONTRACT_DUE_DATE'">
                order by erco.CONTRACT_DUE_DATE
            </if>
            <if test="orderByCase=='MAINTAIN_DUE_DATE'">
                order by erco.MAINTAIN_DUE_DATE
            </if>
            <if test='orderAction!=null and orderAction!=""'>
                <if test="orderAction=='desc'">
                    desc
                </if>
                <if test="orderAction=='asc'">
                    asc
                </if>
            </if>
            <if test='orderByCase!=null and orderByCase !="" and (orderAction==null or orderAction=="")'>
                ,erco.CONTRACT_NO desc
            </if>
        </if>
        <if test='orderByCase==null or orderByCase ==""'>
            order by erco.sign_date desc,erco.create_time desc,erco.CONTRACT_NO desc
        </if>
    </select>
    <resultMap id="dkcxMap" type="hashmap">
        <result column="CONTRACT_FLOW" jdbcType="VARCHAR" property="contractFlow" />
        <result column="CUSTOMER_FLOW" jdbcType="VARCHAR" property="customerFlow" />
        <result column="CONTRACT_NO" jdbcType="VARCHAR" property="contractNo" />
        <result column="CONTRACT_NAME" jdbcType="VARCHAR" property="contractName" />
        <result column="CONTRACT_CATEGORY_ID" jdbcType="VARCHAR" property="contractCategoryId" />
        <result column="CONTRACT_CATEGORY_NAME" jdbcType="VARCHAR" property="contractCategoryName" />
        <result column="CONTRACT_TYPE_ID" jdbcType="VARCHAR" property="contractTypeId" />
        <result column="CONTRACT_TYPE_NAME" jdbcType="VARCHAR" property="contractTypeName" />
        <result column="SIGN_DATE" jdbcType="VARCHAR" property="signDate" />
        <result column="SIGN_DEPT_FLOW" jdbcType="VARCHAR" property="signDeptFlow" />
        <result column="SIGN_DEPT_NAME" jdbcType="VARCHAR" property="signDeptName" />
        <result column="SIGN_USER_FLOW" jdbcType="VARCHAR" property="signUserFlow" />
        <result column="SIGN_USER_NAME" jdbcType="VARCHAR" property="signUserName" />
        <result column="CONTRACT_DUE_DATE" jdbcType="VARCHAR" property="contractDueDate" />
        <result column="MAINTAIN_DUE_DATE" jdbcType="VARCHAR" property="maintainDueDate" />
        <result column="CONTRACT_FUND" jdbcType="DECIMAL" property="contractFund" />
        <result column="CONTRACT_FILE_FLOW" jdbcType="VARCHAR" property="contractFileFlow" />
        <result column="CONTRACT_STATUS_ID" jdbcType="VARCHAR" property="contractStatusId" />
        <result column="CONTRACT_STATUS_NAME" jdbcType="VARCHAR" property="contractStatusName" />
        <result column="RECORD_STATUS" jdbcType="VARCHAR" property="recordStatus" />
        <result column="CREATE_TIME" jdbcType="VARCHAR" property="createTime" />
        <result column="CREATE_USER_FLOW" jdbcType="VARCHAR" property="createUserFlow" />
        <result column="MODIFY_TIME" jdbcType="VARCHAR" property="modifyTime" />
        <result column="MODIFY_USER_FLOW" jdbcType="VARCHAR" property="modifyUserFlow" />
        <result column="SUB_COUNT" jdbcType="DECIMAL" property="subCount" />
        <result column="CONTRACT_OWN_ID" jdbcType="VARCHAR" property="contractOwnId" />
        <result column="CONTRACT_OWN_NAME" jdbcType="VARCHAR" property="contractOwnName" />
        <result column="CHARGE_USER_FLOW" jdbcType="VARCHAR" property="chargeUserFlow" />
        <result column="CHARGE_USER_NAME" jdbcType="VARCHAR" property="chargeUserName" />
        <result column="CUSTOMER_DEPT" jdbcType="VARCHAR" property="customerDept" />
        <result column="CONSUMER_FLOW" jdbcType="VARCHAR" property="consumerFlow" />
        <result column="CONSUMER_NAME" jdbcType="VARCHAR" property="consumerName" />
        <result column="CONTRACT_ARCHIVES_NO" jdbcType="VARCHAR" property="contractArchivesNo" />
        <result column="FEED_BACK_TIME" jdbcType="VARCHAR" property="feedBackTime" />
        <result column="FEED_BACK_USER_FLOW" jdbcType="VARCHAR" property="feedBackUserFlow" />
        <result column="FEED_BACK_USER_NAME" jdbcType="VARCHAR" property="feedBackUserName" />
        <result column="FEED_BACK_CONTENT" jdbcType="VARCHAR" property="feedBackContent" />
        <result column="CHARGE_USER2_FLOW" jdbcType="VARCHAR" property="chargeUser2Flow" />
        <result column="CHARGE_USER2_NAME" jdbcType="VARCHAR" property="chargeUser2Name" />
        <result column="PLAN_ACCEPT_DATE" jdbcType="VARCHAR" property="planAcceptDate" />
        <result column="MAINTAIN_COUNT" jdbcType="VARCHAR" property="maintainCount" />
        <result column="NEXT_MAINTAIN_DATE" jdbcType="VARCHAR" property="nextMaintainDate" />
        <result column="AUDIT_USER_FLOW" jdbcType="VARCHAR" property="auditUserFlow" />
        <result column="AUDIT_USER_NAME" jdbcType="VARCHAR" property="auditUserName" />
        <result column="AUDIT_REASON" jdbcType="VARCHAR" property="auditReason" />
        <result column="customer_name" jdbcType="VARCHAR" property="customerName" />
        <result column="pay_fund" jdbcType="INTEGER" property="payFund" />
        <result column="bill_fund" jdbcType="INTEGER" property="billFund" />
        <result column="PLAN_DATE" jdbcType="VARCHAR" property="planDate" />
        <result column="PLAN_PAY_FUND" jdbcType="INTEGER" property="planPayFund" />
        <result column="PAY_DATE" jdbcType="VARCHAR" property="payDate" />
        <result column="BILL_PAY_FUND" jdbcType="INTEGER" property="billPayFund" />
        <result column="yuqi" jdbcType="VARCHAR" property="yuqi" />
    </resultMap>
    <select id="dkcx" parameterType="java.util.Map" resultMap="dkcxMap">
        select * from (
        select erco.*,
        ercu.customer_name,
        (select nvl(sum(b.pay_fund),0) from erp_crm_contract_pay_balance b where b.record_status='Y'
        and b.status_id='AuditPass'
        and b.contract_flow=erco.contract_flow) pay_fund,
        (select nvl(sum(b.bill_fund),0) from erp_crm_contract_bill_balance b where b.record_status='Y'
        and b.status_id='AuditPass'
        and b.contract_flow=erco.contract_flow) bill_fund,
        PP.PLAN_DATE,
        PP.PAY_FUND PLAN_PAY_FUND,
        PB.PAY_DATE,
        PB.PAY_FUND BILL_PAY_FUND,
        PB.BILL_APPLY_USER_NAME,
        CASE
        WHEN PB.PAY_DATE IS NULL THEN
        ''
        else
        case
        when MONTHS_BETWEEN(to_date(PB.PAY_DATE, 'yyyy-MM-dd'),
        to_date(PP.PLAN_DATE, 'yyyy-MM-dd')) <![CDATA[ < ]]> 2 then
        'two'
        when MONTHS_BETWEEN(to_date(PB.PAY_DATE, 'yyyy-MM-dd'),
        to_date(PP.PLAN_DATE, 'yyyy-MM-dd')) >= 2 and
        MONTHS_BETWEEN(to_date(PB.PAY_DATE, 'yyyy-MM-dd'),
        to_date(PP.PLAN_DATE, 'yyyy-MM-dd')) <![CDATA[ <]]> 4 then
        'four'
        when MONTHS_BETWEEN(to_date(PB.PAY_DATE, 'yyyy-MM-dd'),
        to_date(PP.PLAN_DATE, 'yyyy-MM-dd')) >= 4 and
        MONTHS_BETWEEN(to_date(PB.PAY_DATE, 'yyyy-MM-dd'),
        to_date(PP.PLAN_DATE, 'yyyy-MM-dd')) <![CDATA[ <= ]]> 6 then
        'six'
        when MONTHS_BETWEEN(to_date(PB.PAY_DATE, 'yyyy-MM-dd'),
        to_date(PP.PLAN_DATE, 'yyyy-MM-dd')) > 6 and
        MONTHS_BETWEEN(to_date(PB.PAY_DATE, 'yyyy-MM-dd'),
        to_date(PP.PLAN_DATE, 'yyyy-MM-dd')) <![CDATA[ <= ]]> 12 then
        'twelve'
        when MONTHS_BETWEEN(to_date(PB.PAY_DATE, 'yyyy-MM-dd'),
        to_date(PP.PLAN_DATE, 'yyyy-MM-dd')) > 12 then
        'twelveMore'
        else
        ''
        end
        end yuqi
        from pdsci.erp_crm_contract erco
        left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
        LEFT JOIN ERP_CRM_CONTRACT_PAY_PLAN PP
        ON PP.CONTRACT_FLOW = ERCO.CONTRACT_FLOW
        AND PP.RECORD_STATUS = 'Y'
        LEFT JOIN ERP_CRM_CONTRACT_PAY_BALANCE PB
        ON PB.CONTRACT_FLOW = ERCO.CONTRACT_FLOW
        AND PB.STATUS_ID = 'AuditPass'
        AND PP.PLAN_FLOW = PB.PLAN_FLOW
        AND PB.RECORD_STATUS = 'Y'
        where erco.record_status='Y' and ercu.record_status='Y'
        <if test='customer!=null'>
            <if test='customer.customerName!=null and customer.customerName!=""'>
                <if test='isLike==1'>
                    <bind name="customerName" value="'%'+customer.customerName+'%'"/>
                    and (ercu.customer_name like #{customerName}
                    or ercu.alias_name like #{customerName})
                </if>
                <if test='isLike==null or isLike==""'>
                    and ercu.customer_name = #{customer.customerName}
                </if>
            </if>
            <if test='customer.customerProvId!=null and customer.customerProvId!=""'>
                and ercu.customer_prov_id = #{customer.customerProvId}
            </if>
            <if test='customer.customerCityId!=null and customer.customerCityId!=""'>
                and ercu.customer_city_id = #{customer.customerCityId}
            </if>
            <if test='customer.customerAreaId!=null and customer.customerAreaId!=""'>
                and ercu.customer_area_id = #{customer.customerAreaId}
            </if>
        </if>
        <if test='currUserFlow!=null and currUserFlow!=""'>
            and ercu.CUSTOMER_PROV_ID in(
            select PROV_ID
            from pdsci.ERP_USER_REGION_POPEDOM
            where USER_FLOW = #{currUserFlow}
            and RECORD_STATUS ='Y'
            )
        </if>
        <if test='bigRegionTypeIdList!=null'>
            and ercu.CUSTOMER_PROV_ID in
            <foreach item="item" index="index" collection="bigRegionTypeIdList" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test='notInStatus!=null'>
            and erco.contract_Status_Id not in
            <foreach item="item" index="index" collection="notInStatus" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test='deptFlow!=null and deptFlow!=""'>
            and erco.sign_dept_flow=#{deptFlow}
        </if>
        <if test='contract!=null'>
            <if test='contract.contractNo!=null and contract.contractNo!=""'>
                <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
                and erco.contract_no like #{contractNo}
            </if>
            <if test='contract.contractName!=null and contract.contractName!=""'>
                <bind name="contractName" value="'%'+contract.contractName+'%'"/>
                and erco.contract_name like #{contractName}
            </if>
            <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
                and erco.contract_Flow=#{contract.contractFlow}
            </if>
            <if test='contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
                and erco.maintain_Due_Date=#{contract.contractFlow}
            </if>
            <if test='contract.signDate!=null and contract.signDate!=""'>
                and erco.sign_Date=#{contract.signDate}
            </if>
            <if test='contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
                and erco.contract_Category_Id=#{contract.contractCategoryId}
            </if>
            <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
                and erco.contract_Type_Id=#{contract.contractTypeId}
            </if>
            <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
                and erco.contract_Status_Id=#{contract.contractStatusId}
            </if>
            <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
                and erco.sign_Dept_Flow=#{contract.signDeptFlow}
            </if>
            <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
                and erco.sign_user_Flow=#{contract.signUserFlow}
            </if>
            <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
                and erco.charge_user_Flow=#{contract.chargeUserFlow}
            </if>
            <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
                and erco.charge_user2_Flow=#{contract.chargeUser2Flow}
            </if>
            <if test='createDateStart!=null and createDateStart!=""'>
                and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
            </if>
            <if test='createDateEnd!=null and createDateEnd!=""'>
                and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
            </if>
            <if test='signDateStart!=null and signDateStart!=""'>
                and erco.sign_date >= #{signDateStart}
            </if>
            <if test='signDateEnd!=null and signDateEnd!=""'>
                and erco.sign_date <![CDATA[ <= ]]> #{signDateEnd}
            </if>
            <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
                and erco.maintain_Due_Date >= #{maintainDueDateStart}
            </if>
            <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
                and erco.maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
            </if>
            <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
                and erco.contract_Due_Date >= #{contractDueDateStart}
            </if>
            <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
                and erco.contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
            </if>
        </if>
        <if test='notCG=="Y"'>
            and  erco.contract_Category_Id !='Purchase'
        </if>
        <if test='payStartDate!=null and payStartDate!=""'>
            and PB.PAY_DATE <![CDATA[ >=]]> #{payStartDate}
        </if>
        <if test='payEndDate!=null and payEndDate!=""'>
            and PB.PAY_DATE <![CDATA[ <= ]]> #{payEndDate}
        </if>
        <if test='maintainDue=="Y"'>
            and erco.maintain_Due_Date <![CDATA[ < ]]> #{currDate}
        </if>
        <if test='refContractFlowList!=null'>
            and erco.contract_flow in
            <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test='orderByCase!=null and orderByCase!=""'>
            <if test="orderByCase=='CONTRACT_NO'">
                order by erco.CONTRACT_NO
            </if>
            <if test="orderByCase=='CONTRACT_ARCHIVES_NO'">
                order by erco.contract_no desc,erco.CONTRACT_ARCHIVES_NO
            </if>
            <if test="orderByCase=='CUSTOMER_NAME'">
                order by erco.contract_no desc,ercu.customer_name
            </if>
            <if test="orderByCase=='CONTRACT_NAME'">
                order by erco.contract_no desc,erco.CONTRACT_NAME
            </if>
            <if test="orderByCase=='CONTRACT_CATEGORY_NAME'">
                order by erco.contract_no desc,erco.CONTRACT_CATEGORY_NAME
            </if>
            <if test="orderByCase=='CONTRACT_TYPE_NAME'">
                order by erco.contract_no desc,erco.CONTRACT_TYPE_NAME
            </if>
            <if test="orderByCase=='SIGN_DEPT_NAME'">
                order by erco.contract_no desc,erco.SIGN_DEPT_NAME
            </if>
            <if test="orderByCase=='CHARGE_USER_NAME'">
                order by erco.contract_no desc,erco.CHARGE_USER_NAME
            </if>
            <if test="orderByCase=='CHARGE_USER2_NAME'">
                order by erco.contract_no desc,erco.CHARGE_USER2_NAME
            </if>
            <if test="orderByCase=='CONTRACT_STATUS_NAME'">
                order by erco.contract_no desc,erco.CONTRACT_STATUS_NAME
            </if>
            <if test="orderByCase=='SIGN_DATE'">
                order by erco.contract_no desc,erco.sign_date
            </if>
            <if test="orderByCase=='CREATE_TIME'">
                order by erco.contract_no desc,erco.create_time
            </if>
            <if test="orderByCase=='CONTRACT_DUE_DATE'">
                order by erco.contract_no desc,erco.CONTRACT_DUE_DATE
            </if>
            <if test="orderByCase=='MAINTAIN_DUE_DATE'">
                order by erco.contract_no desc,erco.MAINTAIN_DUE_DATE
            </if>
            <if test='orderAction!=null and orderAction!=""'>
                <if test="orderAction=='desc'">
                    desc
                </if>
                <if test="orderAction=='asc'">
                    asc
                </if>
            </if>
            <if test='orderByCase!=null and orderByCase !="" and (orderAction==null or orderAction=="")'>
                ,erco.CONTRACT_NO desc
            </if>
        </if>
        <if test='orderByCase==null or orderByCase ==""'>
            order by erco.sign_date desc,erco.create_time desc,erco.CONTRACT_NO desc
        </if>
        )a
        <if test='yuqi!=null and yuqi !=""'>
            where a.yuqi =#{yuqi}
        </if>

    </select>
    <select id="searchAllMoney" parameterType="java.util.Map"  resultType="java.math.BigDecimal">
        select nvl(sum(erco.CONTRACT_FUND),0) money
        from pdsci.erp_crm_contract erco
        left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
        where erco.record_status='Y' and ercu.record_status='Y'
        <if test='customer!=null'>
            <if test='customer.customerName!=null and customer.customerName!=""'>
                <bind name="customerName" value="'%'+customer.customerName+'%'"/>
                and (ercu.customer_name like #{customerName}
                or ercu.alias_name like #{customerName})
            </if>
            <if test='customer.customerProvId!=null and customer.customerProvId!=""'>
                and ercu.customer_prov_id = #{customer.customerProvId}
            </if>
            <if test='customer.customerCityId!=null and customer.customerCityId!=""'>
                and ercu.customer_city_id = #{customer.customerCityId}
            </if>
            <if test='customer.customerAreaId!=null and customer.customerAreaId!=""'>
                and ercu.customer_area_id = #{customer.customerAreaId}
            </if>
        </if>
        <if test='currUserFlow!=null and currUserFlow!=""'>
            and ercu.CUSTOMER_PROV_ID in(
            select  PROV_ID
            from pdsci.ERP_USER_REGION_POPEDOM
            where USER_FLOW = #{currUserFlow}
            and RECORD_STATUS ='Y'
            )
        </if>
        <if test='bigRegionTypeIdList!=null'>
            and ercu.CUSTOMER_PROV_ID in
            <foreach item="item" index="index" collection="bigRegionTypeIdList" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test='deptFlow!=null and deptFlow!=""'>
            and erco.sign_dept_flow=#{deptFlow}
        </if>
        <if test='contract!=null'>
            <if test='contract.contractNo!=null and contract.contractNo!=""'>
                <bind name="contractNo" value="'%'+contract.contractNo+'%'"/>
                and contract_no like #{contractNo}
            </if>
            <if test='contract.contractName!=null and contract.contractName!=""'>
                <bind name="contractName" value="'%'+contract.contractName+'%'"/>
                and contract_name like #{contractName}
            </if>
            <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
                and contract_Flow=#{contract.contractFlow}
            </if>
            <if test='contract.maintainDueDate!=null and contract.maintainDueDate!=""'>
                and maintain_Due_Date=#{contract.contractFlow}
            </if>
            <if test='contract.signDate!=null and contract.signDate!=""'>
                and sign_Date=#{contract.signDate}
            </if>
            <if test='contract.contractCategoryId!=null and contract.contractCategoryId!=""'>
                and contract_Category_Id=#{contract.contractCategoryId}
            </if>
            <if test='contract.contractTypeId!=null and contract.contractTypeId!=""'>
                and contract_Type_Id=#{contract.contractTypeId}
            </if>
            <if test='contract.contractStatusId!=null and contract.contractStatusId!=""'>
                and contract_Status_Id=#{contract.contractStatusId}
            </if>
            <if test='contract.signDeptFlow!=null and contract.signDeptFlow!=""'>
                and sign_Dept_Flow=#{contract.signDeptFlow}
            </if>
            <if test='contract.signUserFlow!=null and contract.signUserFlow!=""'>
                and sign_user_Flow=#{contract.signUserFlow}
            </if>
         <if test='owner==null or owner==""'>
             <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
                 and charge_user_Flow=#{contract.chargeUserFlow}
             </if>
             <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!=""'>
                 and charge_user2_Flow=#{contract.chargeUser2Flow}
             </if>
         </if>
         <if test='owner!=null and owner!=""'>
             <if test='contract.chargeUserFlow!=null and contract.chargeUserFlow!=""and (contract.chargeUser2Flow==null or contract.chargeUser2Flow=="")'>
                 and charge_user_Flow=#{contract.chargeUserFlow}
             </if>
             <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!="" and (contract.chargeUserFlow==null or contract.chargeUserFlow=="")'>
                 and charge_user2_Flow=#{contract.chargeUser2Flow}
             </if>
             <if test='contract.chargeUser2Flow!=null and contract.chargeUser2Flow!="" and contract.chargeUserFlow!=null and contract.chargeUserFlow!=""'>
                and (
                  charge_user2_Flow=#{contract.chargeUser2Flow}
                 or
                  charge_user_Flow=#{contract.chargeUserFlow}
                 )
             </if>
         </if>
            <if test='createDateStart!=null and createDateStart!=""'>
                and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') >= #{createDateStart}
            </if>
            <if test='createDateEnd!=null and createDateEnd!=""'>
                and to_char(to_date(erco.CREATE_TIME,'yyyymmddhh24miss'),'yyyy-mm-dd') <![CDATA[ <= ]]> #{createDateEnd}
            </if>
            <if test='signDateStart!=null and signDateStart!=""'>
                and sign_date >= #{signDateStart}
            </if>
            <if test='signDateEnd!=null and signDateEnd!=""'>
                and sign_date <![CDATA[ <= ]]> #{signDateEnd}
            </if>
            <if test='maintainDueDateStart!=null and maintainDueDateStart!=""'>
                and maintain_Due_Date >= #{maintainDueDateStart}
            </if>
            <if test='maintainDueDateEnd!=null and maintainDueDateEnd!=""'>
                and maintain_Due_Date <![CDATA[ <= ]]> #{maintainDueDateEnd}
            </if>
            <if test='contractDueDateStart!=null and contractDueDateStart!=""'>
                and contract_Due_Date >= #{contractDueDateStart}
            </if>
            <if test='contractDueDateEnd!=null and contractDueDateEnd!=""'>
                and contract_Due_Date <![CDATA[ <= ]]> #{contractDueDateEnd}
            </if>
        </if>
        <if test='noSecond=="Y"'>
            and contract_Category_Id !='Second'
        </if>
        <if test='notCG=="Y"'>
            and  erco.contract_Category_Id !='Purchase'
        </if>
        <if test='maintainDue=="Y"'>
            and maintain_Due_Date <![CDATA[ < ]]> #{currDate}
        </if>
        <if test='refContractFlowList!=null'>
            and contract_flow in
            <foreach item="item" index="index" collection="refContractFlowList" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        order by erco.sign_date desc,erco.create_time desc
    </select>
   <select id="searchContracts" parameterType="java.util.Map" resultMap="erpCrmContractExtMap">
      select erco.*,ercu.customer_name
       from pdsci.erp_crm_contract erco
       left join pdsci.erp_crm_customer ercu on ercu.customer_flow=erco.customer_flow
       where erco.record_status='Y' and ercu.record_status='Y'
         <if test='contract!=null'>
            <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
              and erco.contract_flow=#{contract.contractFlow}
            </if>
         </if>
       	 <if test='signDeptFlow!=null and signDeptFlow!=""'>
            and SIGN_DEPT_FLOW = #{signDeptFlow}
         </if>
       	 <if test='startDate!=null and startDate!=""'>
            and maintain_Due_Date >= #{startDate}
         </if>
         <if test='endDate!=null and endDate!=""'>
            and maintain_Due_Date <![CDATA[ <= ]]> #{endDate}
         </if>
         <if test='Implementing!=null and Implementing!=""'>
           and contract_status_id in('Auditing','Implement','Terminate')
         </if>
        order by erco.MAINTAIN_DUE_DATE,erco.CREATE_TIME
   </select>
   <select id="searchContractLics" parameterType="java.util.Map" resultMap="erpCrmContractLicExtMap">
      select erco.*,ercu.customer_name,lic.lic_flow,lic.work_station_name,lic.issue_date,lic.vaild_date,lic.develop_language,lic.apply_dept_name,lic.apply_user_name
       from pdsci.erp_crm_contract erco
       LEFT JOIN pdsci.erp_crm_customer ercu ON ercu.customer_flow = erco.customer_flow
       left join ERP_OA_LIC_KEY lic
       on erco.contract_flow=lic.contract_flow
       WHERE erco.record_status = 'Y'
       AND ercu.record_status = 'Y'
       and lic.record_status='Y'
         <if test='contract!=null'>
            <if test='contract.contractFlow!=null and contract.contractFlow!=""'>
              and erco.contract_flow=#{contract.contractFlow}
            </if>
         </if>
       	 <if test='signDeptFlow!=null and signDeptFlow!=""'>
            and SIGN_DEPT_FLOW = #{signDeptFlow}
         </if>
       	 <if test='startDate!=null and startDate!=""'>
            and lic.vaild_date >= #{startDate}
         </if>
         <if test='endDate!=null and endDate!=""'>
            and lic.vaild_date <![CDATA[ <= ]]> #{endDate}
         </if>
         <if test='Implementing!=null and Implementing!=""'>
           and contract_status_id in('Auditing','Implement','Terminate')
         </if>
        order by erco.MAINTAIN_DUE_DATE,erco.CREATE_TIME
   </select>
    <select id="searchCustomerList" parameterType="java.util.Map" resultMap="com.pinde.sci.dao.base.ErpCrmContractMapper.BaseResultMap">
        select erco.*
        from pdsci.erp_crm_contract erco
        where erco.record_status='Y'
        order by erco.MAINTAIN_DUE_DATE,erco.CREATE_TIME
    </select>
   <select id="countContractFundNumber" parameterType="java.util.Map" resultType="java.math.BigDecimal">
        select nvl(sum(contract_fund),0) from pdsci.erp_crm_contract
          where record_status='Y'
          <if test='contract!=null'>
          <if test='contract.signDate!=null and contract.signDate!=""'>
                 <bind name="signDate" value="'%'+contract.signDate+'%'"/>
                 and sign_date like #{signDate}
          </if>
          </if>
   </select>
</mapper>