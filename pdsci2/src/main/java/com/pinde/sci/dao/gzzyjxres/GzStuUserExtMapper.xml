<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pinde.sci.dao.gzzyjxres.GzStuUserExtMapper" >
    <select id="countAdmitedStuUsers" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(0) from
        (SELECT SU.USER_FLOW, SU.USER_NAME, SU.ID_NO, SUR.RESUME_FLOW, SUR.STU_BAT_ID
			, SUR.STU_BAT_NAME, SUR.SCHOOL_SPE_NAME, SUR.STU_TIME_NAME, SUR.SPE_ID, SUR.SPE_NAME
			, SUR.STU_STATUS_ID, SUR.STU_STATUS_NAME, SUR.TEACHER_FLOW, SUR.TEACHER_NAME, SUR.IS_GRADUATION
			, SUR.GRADUATION_DATE, SUR.IS_PUBLISH, SUR.RESUME_INFO, SUR.ISSUE_CERTIFICATE, SUR.IS_BACK
			, SAP.AUDIT_CONTENT, SB.BATCH_REG_DATE
		FROM STU_USER_RESUME SUR
		INNER JOIN SYS_USER SU ON SUR.USER_FLOW = SU.USER_FLOW
		LEFT JOIN STU_AUDIT_PROCESS SAP ON SUR.RESUME_FLOW = SAP.RESUME_FLOW
			LEFT JOIN STU_BATCH SB ON SUR.STU_BAT_ID = SB.BATCH_FLOW
		WHERE SU.RECORD_STATUS = 'Y'
			AND SUR.RECORD_STATUS = 'Y'
			AND SUR.STU_STATUS_ID IN ('Admited', 'Graduation', 'DelayGraduation')
			AND SUR.IS_PUBLISH = 'Y'
            <if test='year!=null and year!=""'>
                <bind name="date1" value="year+'-01-01'"/>
                AND sb.BATCH_REG_DATE >= #{date1}
            </if>
            <if test='year!=null and year!=""'>
                <bind name="date2" value="year+'-12-31'"/>
                AND #{date2}>= sb.BATCH_REG_DATE
            </if>
        )
    </select>
</mapper>