
(function($){$.fn.fixedTable=function(opts){var options=$.extend({},$.fn.fixedTable.defaults,opts);var mainid="#"+options.outerId;var tbl=this;var layout=buildLayout(tbl,opts);var w=options.width-options.fixedColumnWidth;if(w<=0){w=options.width;}
$(".fixedContainer",layout).width(w);$(".fixedContainer ."+options.classHeader,layout).css({width:(w)+"px","float":"left","overflow":"hidden"});$(".fixedContainer .fixedTable",layout).css({"float":"left",width:(w+16)+"px","overflow":"auto"});$(".fixedContainer",layout).css({width:w-1,"float":"left"});$(".fixedContainer ."+options.classFooter,layout).css({width:(w)+"px","float":"left","overflow":"hidden"});$("."+options.classColumn+" > .fixedTable",layout).css({"width":options.fixedColumnWidth,"overflow":"hidden","border-collapse":$(tbl).css("border-collapse"),"padding":"0"});$("."+options.classColumn,layout).width(options.fixedColumnWidth);$("."+options.classColumn,layout).height(options.height);$("."+options.classColumn+" ."+options.classHeader+" table tbody tr td",layout).width(options.fixedColumnWidth);$("."+options.classColumn+" ."+options.classFooter+" table tbody tr td",layout).width(options.fixedColumnWidth);var fh=$(".fixedContainer > ."+options.classHeader+" > table",layout);var ft=$(".fixedContainer > .fixedTable > table",layout);var ff=$(".fixedContainer > ."+options.classFooter+" > table",layout);var maxWidth=fh.width();if(ft.length>0&&ft.width()>maxWidth){maxWidth=ft.width();}
if(ff.length>0&&ff.width()>maxWidth){maxWidth=ff.width();}
if(fh.length){fh.width(maxWidth);}
if(ft.length){ft.width(maxWidth);}
if(ff.length){ff.width(maxWidth);}
$("."+options.classColumn+" > ."+options.classHeader+" > table > tbody > tr:first > td",layout).each(function(pos){var tblCell=$("."+options.classColumn+" > .fixedTable > table > tbody > tr:first > td:eq("+pos+")",layout);var tblFoot=$("."+options.classColumn+" > ."+options.classFooter+" > table > tbody > tr:first > td:eq("+pos+")",layout);var maxWidth=$(this).width();if(tblCell.width()>maxWidth){maxWidth=tblCell.width();}
if(tblFoot.length&&tblFoot.width()>maxWidth){maxWidth=tblFoot.width();}
$(this).width(maxWidth);$(tblCell).width(maxWidth);if(tblFoot.length){$(tblFoot).width(maxWidth);}});var h=options.height-parseInt($(".fixedContainer > ."+options.classHeader,layout).height())-parseInt($(".fixedContainer > ."+options.classFooter,layout).height());if(h<0){h=options.height;}
$(".fixedContainer > .fixedTable",layout).height(h);$("."+options.classColumn+" > .fixedTable",layout).height(h);var h=$(".fixedContainer > .fixedTable",layout)[0].offsetHeight-16;$("."+options.classColumn+" > .fixedTable",layout).height(h);$(".fixedContainer > .fixedTable",layout).scroll(function(){handleScroll(mainid,options);});adjustSizes(options);return tbl;}
function buildLayout(src,options){var area=$("<div class=\"fixedArea\"></div>").appendTo($(src).parent());var fc=$("<div class=\""+options.classColumn+"\" style=\"float: left;\"></div>").appendTo(area);var fch=$("<div class=\""+options.classHeader+"\"></div>").appendTo(fc);var fct=$("<div class=\"fixedTable\"></div>").appendTo(fc);var fcf=$("<div class=\""+options.classFooter+"\"></div>").appendTo(fc);var fcn=$("<div class=\"fixedContainer\"></div>").appendTo(area);var fcnh=$("<div class=\""+options.classHeader+"\"></div>").appendTo(fcn);var fcnt=$("<div class=\"fixedTable\"></div>").appendTo(fcn);var fcnf=$("<div class=\""+options.classFooter+"\"></div>").appendTo(fcn);if(options.fixedColumns>0&&!isNaN(options.fixedColumns)){buildFixedColumns(src,"thead",options.fixedColumns,fch);buildFixedColumns(src,"tbody",options.fixedColumns,fct);buildFixedColumns(src,"tfoot",options.fixedColumns,fcf);}
buildFixedTable(src,"thead",fcnh);buildFixedTable(src,"tfoot",fcnf);fcnt.append(src);return area;}
function buildFixedColumns(src,section,cols,target){if($(section,src).length){var colHead=$("<table></table>").appendTo(target);var cellType="td";if(section.toLowerCase()=="thead"||section.toLowerCase()=="tfoot"){cellType="th";}
$(section+" tr",src).each(function(){var tr=$("<tr></tr>").appendTo(colHead);$(cellType+":lt("+cols+")",this).each(function(){$("<td title="+$.trim($(this).attr('title'))+">"+$(this).html()+"</td>").addClass(this.className).attr("id",this.id).appendTo(tr);$(this).remove();});});}}
function buildFixedTable(src,section,target){if($(section,src).length){var th=$("<table></table>").appendTo(target);var tr=null;var cellType="td";if(section.toLowerCase()=="thead"||section.toLowerCase()=="tfoot"){cellType="th";}
$(section+" tr",src).each(function(){var tr=$("<tr></tr>").appendTo(th);$(cellType,this).each(function(){$("<td title="+$.trim($(this).attr('title'))+">"+$(this).html()+"</td>").appendTo(tr);});});$(section,src).remove();}}
function handleScroll(mainid,options){var tblarea=$(mainid+" .fixedContainer > .fixedTable");var x=tblarea[0].scrollLeft;var y=tblarea[0].scrollTop;$(mainid+" ."+options.classColumn+" > .fixedTable")[0].scrollTop=y;$(mainid+" .fixedContainer > ."+options.classHeader)[0].scrollLeft=x;$(mainid+" .fixedContainer > ."+options.classFooter)[0].scrollLeft=x;}
function adjustSizes(options){var Id=options.outerId;var maintbheight=options.height;var backcolor=options.Contentbackcolor;var hovercolor=options.Contenthovercolor;var fixedColumnbackcolor=options.fixedColumnbackcolor;var fixedColumnhovercolor=options.fixedColumnhovercolor;$("#"+Id+" ."+options.classColumn+" .fixedTable table tbody tr").each(function(i){var maxh=0;var fixedh=$(this).height();var contenth=$("#"+Id+" .fixedContainer .fixedTable table tbody tr").eq(i).height();if(contenth>fixedh){maxh=contenth;}
else{maxh=fixedh;}
$(this).children("td").height(maxh);$("#"+Id+" .fixedContainer .fixedTable table tbody tr").eq(i).children("td").height(maxh);});var htbale=$("#"+Id+" .fixedContainer ."+options.classHeader+" table");var ttable=$("#"+Id+" .fixedContainer .fixedTable table");var ccount=$("#"+Id+" .fixedContainer ."+options.classHeader+" table tr:first td").size();var widthArray=new Array();var totall=0;$("#"+Id+" .fixedContainer ."+options.classHeader+" table tr:first td").each(function(pos){var cwidth=$(this).width();$("#"+Id+" .fixedContainer .fixedTable table tbody td").each(function(i){if(i%ccount==pos){if($(this).width()>cwidth){cwidth=$(this).width();}}});widthArray[pos]=cwidth;totall+=(cwidth+2);});$("#"+Id+" .fixedContainer ."+options.classHeader+" table").width(totall+100);$("#"+Id+" .fixedContainer .fixedTable table").width(totall+100);$("#"+Id+" .fixedContainer ."+options.classFooter+" table").width(totall+100);for(i=0;i<widthArray.length;i++){$("#"+Id+" .fixedContainer ."+options.classHeader+" table tr td").each(function(j){if(j%ccount==i){$(this).attr("width",widthArray[i]+"px");}});$("#"+Id+" .fixedContainer .fixedTable table tr td").each(function(j){if(j%ccount==i){$(this).attr("width",widthArray[i]+"px");}});$("#"+Id+" .fixedContainer ."+options.classFooter+" table tr td").each(function(j){if(j%ccount==i){$(this).attr("width",widthArray[i]+"px");}});}
$("#"+Id+" ."+options.classColumn+" .fixedTable table tr").each(function(i){$(this).mouseover(function(){$(this).children("td").css({"background-color":fixedColumnhovercolor});var obj=$("#"+Id+" .fixedContainer .fixedTable table tr").eq(i);obj.children("td").css({"background-color":hovercolor});obj.children("td").children("pre").css({"background-color":hovercolor});});$(this).mouseout(function(){$(this).children("td").css({"background-color":fixedColumnbackcolor});var obj=$("#"+Id+" .fixedContainer .fixedTable table tr").eq(i);obj.children("td").css({"background-color":backcolor});obj.children("td").children("pre").css({"background-color":backcolor});});});$("#"+Id+" .fixedContainer .fixedTable table tr").each(function(i){$(this).mouseover(function(){$(this).children("td").css({"background-color":hovercolor});$(this).children("td").children("pre").css({"background-color":hovercolor});var obj=$("#"+Id+" ."+options.classColumn+" .fixedTable table tr").eq(i);obj.children("td").css({"background-color":fixedColumnhovercolor});});$(this).mouseout(function(){$(this).children("td").css({"background-color":backcolor});$(this).children("td").children("pre").css({"background-color":backcolor});var obj=$("#"+Id+" ."+options.classColumn+" .fixedTable table tr").eq(i);obj.children("td").css({"background-color":fixedColumnbackcolor});});});var contenttbH=$("#"+Id+" .fixedContainer .fixedTable table").height();if(contenttbH<maintbheight){$("#"+Id+" ."+options.classColumn+" .fixedTable").height(contenttbH+20);$("#"+Id+" .fixedContainer .fixedTable").height(contenttbH+20);$("#"+Id+" .fixedContainer ."+options.classHeader).width($("#"+Id+" .fixedContainer ."+options.classHeader).width()+16);$("#"+Id+" .fixedContainer ."+options.classFooter).width($("#"+Id+" .fixedContainer ."+options.classHeader).width());}
else{$("#"+Id+" ."+options.classColumn+" > ."+options.classFooter).css({"position":"relative","top":16});}}})(jQuery);