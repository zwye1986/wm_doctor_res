/*!
 * cxSelect 1.3.2
 * http://code.ciaoca.com/
 * https://github.com/ciaoca/cxSelect
 * E-mail: ciaoca@gmail.com
 * Released under the MIT license
 * Date: 2013-05-15
 */
!function(t){t.fn.cxSelect=function(e){var s={settings:t.extend({},t.cxSelect.defaults,e),dom:{box:this}};s.init=function(){var e=this;if(e.dom.box.length&&e.settings.selects.length){e.selectArray=[],e.selectSum=e.settings.selects.length;for(var s=0;s<e.selectSum&&e.dom.box.find("select."+e.settings.selects[s]);s++)e.selectArray.push(e.dom.box.find("select."+e.settings.selects[s]));e.selectSum=e.selectArray.length,e.selectSum&&("string"==typeof e.settings.url?t.getJSON(e.settings.url,function(t){e.dataJson=t,e.buildContent()}):"object"==typeof e.settings.url&&(e.dataJson=e.settings.url,e.buildContent()))}},s.isArray=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},s.getIndex=function(t){return this.settings.required?t:t-1},s.getNewOptions=function(e,s){if(e){var i=this.settings.firstTitle,n=this.settings.firstValue,r=e.data("firstTitle"),l=e.data("firstValue"),o="";return("string"==typeof r||"number"==typeof r||"boolean"==typeof r)&&(i=r.toString()),("string"==typeof l||"number"==typeof l||"boolean"==typeof l)&&(n=l.toString()),this.settings.required||(o='<option value="'+n+'">'+i+"</option>"),t.each(s,function(t,e){o+="string"==typeof e.v||"number"==typeof e.v||"boolean"==typeof e.v?'<option value="'+e.v+'">'+e.n+"</option>":'<option value="'+e.n+'">'+e.n+"</option>"}),o}},s.buildContent=function(){var t=this;t.dom.box.on("change","select",function(){t.selectChange(this.className)});var e=t.getNewOptions(t.selectArray[0],t.dataJson);t.selectArray[0].html(e).prop("disabled",!1).trigger("change"),t.setDefaultValue()},s.setDefaultValue=function(t){t=t||0;var e,s=this;t>=s.selectSum||!s.selectArray[t]||(e=s.selectArray[t].data("value"),("string"==typeof e||"number"==typeof e||"boolean"==typeof e)&&(e=e.toString(),setTimeout(function(){s.selectArray[t].val(e).trigger("change"),s.settings.disabled&&s.selectArray[t].prop("disabled",!0),t++,s.setDefaultValue(t)},1)))},s.selectChange=function(t){t=t.replace(/ /g,","),t=","+t+",";for(var e,s,i,n,r=[],l=0;l<this.selectSum;l++)r.push(this.getIndex(this.selectArray[l].get(0).selectedIndex)),"number"==typeof e&&l>e&&(this.selectArray[l].empty().prop("disabled",!0),"none"===this.settings.nodata?this.selectArray[l].css("display","none"):"hidden"===this.settings.nodata&&this.selectArray[l].css("visibility","hidden")),t.indexOf(","+this.settings.selects[l]+",")>-1&&(e=l);s=e+1,i=this.dataJson;for(var l=0;s>l;l++){if("undefined"==typeof i[r[l]]||this.isArray(i[r[l]].s)===!1||!i[r[l]].s.length)return;i=i[r[l]].s}this.selectArray[s]&&(n=this.getNewOptions(this.selectArray[s],i),this.selectArray[s].html(n).prop("disabled",!1).css({display:"",visibility:""}).trigger("change"))},s.init()},t.cxSelect={defaults:{selects:[],url:null,nodata:null,required:!1,firstTitle:"请选择",firstValue:"0",disabled:!1}}}(jQuery);